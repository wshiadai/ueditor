(function(){UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu;window.UE=baidu.editor={};UE.plugins={};UE.commands={};UE.instants={};UE.I18N={};UE.version="1.2.5.0";var dom=UE.dom={};var browser=UE.browser=function(){var agent=navigator.userAgent.toLowerCase(),opera=window.opera,browser={ie:!!window.ActiveXObject,opera:(!!opera&&opera.version),webkit:(agent.indexOf(" applewebkit/")>-1),mac:(agent.indexOf("macintosh")>-1),quirks:(document.compatMode=="BackCompat")};browser.gecko=(navigator.product=="Gecko"&&!browser.webkit&&!browser.opera);var version=0;if(browser.ie){version=parseFloat(agent.match(/msie (\d+)/)[1]);browser.ie9Compat=document.documentMode==9;browser.ie8=!!document.documentMode;browser.ie8Compat=document.documentMode==8;browser.ie7Compat=((version==7&&!document.documentMode)||document.documentMode==7);browser.ie6Compat=(version<7||browser.quirks);}if(browser.gecko){var geckoRelease=agent.match(/rv:([\d\.]+)/);if(geckoRelease){geckoRelease=geckoRelease[1].split(".");version=geckoRelease[0]*10000+(geckoRelease[1]||0)*100+(geckoRelease[2]||0)*1;}}if(/chrome\/(\d+\.\d)/i.test(agent)){browser.chrome=+RegExp["\x241"];}if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(agent)&&!/chrome/i.test(agent)){browser.safari=+(RegExp["\x241"]||RegExp["\x242"]);}if(browser.opera){version=parseFloat(opera.version());}if(browser.webkit){version=parseFloat(agent.match(/ applewebkit\/(\d+)/)[1]);}browser.version=version;browser.isCompatible=!browser.mobile&&((browser.ie&&version>=6)||(browser.gecko&&version>=10801)||(browser.opera&&version>=9.5)||(browser.air&&version>=1)||(browser.webkit&&version>=522)||false);return browser;}();var ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera;var utils=UE.utils={each:function(obj,iterator,context){if(obj==null){return;}if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===false){return false;}}}else{for(var key in obj){if(obj.hasOwnProperty(key)){if(iterator.call(context,obj[key],key,obj)===false){return false;}}}}},makeInstance:function(obj){var noop=new Function();noop.prototype=obj;obj=new noop;noop.prototype=null;return obj;},extend:function(t,s,b){if(s){for(var k in s){if(!b||!t.hasOwnProperty(k)){t[k]=s[k];}}}return t;},extend2:function(t){var a=arguments;for(var i=1;i<a.length;i++){var x=a[i];for(var k in x){if(!t.hasOwnProperty(k)){t[k]=x[k];}}}return t;},inherits:function(subClass,superClass){var oldP=subClass.prototype,newP=utils.makeInstance(superClass.prototype);utils.extend(newP,oldP,true);subClass.prototype=newP;return(newP.constructor=subClass);},bind:function(fn,context){return function(){return fn.apply(context,arguments);};},defer:function(fn,delay,exclusion){var timerID;return function(){if(exclusion){clearTimeout(timerID);}timerID=setTimeout(fn,delay);};},indexOf:function(array,item,start){var index=-1;start=this.isNumber(start)?start:0;this.each(array,function(v,i){if(i>=start&&v===item){index=i;return false;}});return index;},removeItem:function(array,item){for(var i=0,l=array.length;i<l;i++){if(array[i]===item){array.splice(i,1);i--;}}},trim:function(str){return str.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"");},listToMap:function(list){if(!list){return{};}list=utils.isArray(list)?list:list.split(",");for(var i=0,ci,obj={};ci=list[i++];){obj[ci.toUpperCase()]=obj[ci]=1;}return obj;},unhtml:function(str,reg){return str?str.replace(reg||/[&<">](?:(amp|lt|quot|gt);)?/g,function(a,b){if(b){return a;}else{return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;"}[a];}}):"";},html:function(str){return str?str.replace(/&((g|l|quo)t|amp);/g,function(m){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">"}[m];}):"";},cssStyleToDomStyle:function(){var test=document.createElement("div").style,cache={"float":test.cssFloat!=undefined?"cssFloat":test.styleFloat!=undefined?"styleFloat":"float"};return function(cssName){return cache[cssName]||(cache[cssName]=cssName.toLowerCase().replace(/-./g,function(match){return match.charAt(1).toUpperCase();}));};}(),loadFile:function(){var tmpList=[];function getItem(doc,obj){try{for(var i=0,ci;ci=tmpList[i++];){if(ci.doc===doc&&ci.url==(obj.src||obj.href)){return ci;}}}catch(e){return null;}}return function(doc,obj,fn){var item=getItem(doc,obj);if(item){if(item.ready){fn&&fn();}else{item.funs.push(fn);}return;}tmpList.push({doc:doc,url:obj.src||obj.href,funs:[fn]});if(!doc.body){var html=[];for(var p in obj){if(p=="tag"){continue;}html.push(p+'="'+obj[p]+'"');}doc.write("<"+obj.tag+" "+html.join(" ")+" ></"+obj.tag+">");return;}if(obj.id&&doc.getElementById(obj.id)){return;}var element=doc.createElement(obj.tag);delete obj.tag;for(var p in obj){element.setAttribute(p,obj[p]);}element.onload=element.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){item=getItem(doc,obj);if(item.funs.length>0){item.ready=1;for(var fi;fi=item.funs.pop();){fi();}}element.onload=element.onreadystatechange=null;}};element.onerror=function(){throw Error("The load "+(obj.href||obj.src)+" fails,check the url settings of file ueditor.config.js ");};doc.getElementsByTagName("head")[0].appendChild(element);};}(),isEmptyObject:function(obj){if(obj==null){return true;}if(this.isArray(obj)||this.isString(obj)){return obj.length===0;}for(var key in obj){if(obj.hasOwnProperty(key)){return false;}}return true;},fixColor:function(name,value){if(/color/i.test(name)&&/rgba?/.test(value)){var array=value.split(",");if(array.length>3){return"";}value="#";for(var i=0,color;color=array[i++];){color=parseInt(color.replace(/[^\d]/gi,""),10).toString(16);value+=color.length==1?"0"+color:color;}value=value.toUpperCase();}return value;},optCss:function(val){var padding,margin,border;val=val.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(str,key,name,val){if(val.split(" ").length==1){switch(key){case"padding":!padding&&(padding={});padding[name]=val;return"";case"margin":!margin&&(margin={});margin[name]=val;return"";case"border":return val=="initial"?"":str;}}return str;});function opt(obj,name){if(!obj){return"";}var t=obj.top,b=obj.bottom,l=obj.left,r=obj.right,val="";if(!t||!l||!b||!r){for(var p in obj){val+=";"+name+"-"+p+":"+obj[p]+";";}}else{val+=";"+name+":"+(t==b&&b==l&&l==r?t:t==b&&l==r?(t+" "+l):l==r?(t+" "+l+" "+b):(t+" "+r+" "+b+" "+l))+";";}return val;}val+=opt(padding,"padding")+opt(margin,"margin");return val.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(a,b){return b?b+";;":";";});},clone:function(source,target){var tmp;target=target||{};for(var i in source){if(source.hasOwnProperty(i)){tmp=source[i];if(typeof tmp=="object"){target[i]=utils.isArray(tmp)?[]:{};utils.clone(source[i],target[i]);}else{target[i]=tmp;}}}return target;},transUnitToPx:function(val){if(!/(pt|cm)/.test(val)){return val;}var unit;val.replace(/([\d.]+)(\w+)/,function(str,v,u){val=v;unit=u;});switch(unit){case"cm":val=parseFloat(val)*25;break;case"pt":val=Math.round(parseFloat(val)*96/72);}return val+(val?"px":"");},domReady:function(){var fnArr=[];function doReady(doc){doc.isReady=true;for(var ci;ci=fnArr.pop();ci()){}}return function(onready,win){win=win||window;var doc=win.document;onready&&fnArr.push(onready);if(doc.readyState==="complete"){doReady(doc);}else{doc.isReady&&doReady(doc);if(browser.ie){(function(){if(doc.isReady){return;}try{doc.documentElement.doScroll("left");}catch(error){setTimeout(arguments.callee,0);return;}doReady(doc);})();win.attachEvent("onload",function(){doReady(doc);});}else{doc.addEventListener("DOMContentLoaded",function(){doc.removeEventListener("DOMContentLoaded",arguments.callee,false);doReady(doc);},false);win.addEventListener("load",function(){doReady(doc);},false);}}};}(),cssRule:browser.ie?function(key,style,doc){var indexList,index;doc=doc||document;if(doc.indexList){indexList=doc.indexList;}else{indexList=doc.indexList={};}var sheetStyle;if(!indexList[key]){if(style===undefined){return"";}sheetStyle=doc.createStyleSheet("",index=doc.styleSheets.length);indexList[key]=index;}else{sheetStyle=doc.styleSheets[indexList[key]];}if(style===undefined){return sheetStyle.cssText;}sheetStyle.cssText=style||"";}:function(key,style,doc){doc=doc||document;var head=doc.getElementsByTagName("head")[0],node;if(!(node=doc.getElementById(key))){if(style===undefined){return"";}node=doc.createElement("style");node.id=key;head.appendChild(node);}if(style===undefined){return node.innerHTML;}if(style!==""){node.innerHTML=style;}else{head.removeChild(node);}},sort:function(array,compareFn){compareFn=compareFn||function(item1,item2){return item1.localeCompare(item2);};for(var i=0,len=array.length;i<len;i++){for(var j=i,length=array.length;j<length;j++){if(compareFn(array[i],array[j])>0){var t=array[i];array[i]=array[j];array[j]=t;}}}return array;}};utils.each(["String","Function","Array","Number","RegExp","Object"],function(v){UE.utils["is"+v]=function(obj){return Object.prototype.toString.apply(obj)=="[object "+v+"]";};});utils.stringify=(function(){var escapeMap={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function encodeString(source){if(/["\\\x00-\x1f]/.test(source)){source=source.replace(/["\\\x00-\x1f]/g,function(match){var c=escapeMap[match];if(c){return c;}c=match.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16);});}return'"'+source+'"';}function encodeArray(source){var result=["["],l=source.length,preComma,i,item;for(i=0;i<l;i++){item=source[i];switch(typeof item){case"undefined":case"function":case"unknown":break;default:if(preComma){result.push(",");}result.push(utils.stringify(item));preComma=1;}}result.push("]");return result.join("");}function pad(source){return source<10?"0"+source:source;}function encodeDate(source){return'"'+source.getFullYear()+"-"+pad(source.getMonth()+1)+"-"+pad(source.getDate())+"T"+pad(source.getHours())+":"+pad(source.getMinutes())+":"+pad(source.getSeconds())+'"';}return function(value){switch(typeof value){case"undefined":return"undefined";case"number":return isFinite(value)?String(value):"null";case"string":return encodeString(value);case"boolean":return String(value);default:if(value===null){return"null";}else{if(utils.isArray(value)){return encodeArray(value);}else{if(value instanceof Date){return encodeDate(value);}else{var result=["{"],encode=utils.stringify,preComma,item;for(var key in value){if(Object.prototype.hasOwnProperty.call(value,key)){item=value[key];switch(typeof item){case"undefined":case"unknown":case"function":break;default:if(preComma){result.push(",");}preComma=1;result.push(encode(key)+":"+encode(item));}}}result.push("}");return result.join("");}}}}};})();var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(types,listener){types=utils.trim(types).split(" ");for(var i=0,ti;ti=types[i++];){getListener(this,ti,true).push(listener);}},removeListener:function(types,listener){types=utils.trim(types).split(" ");for(var i=0,ti;ti=types[i++];){utils.removeItem(getListener(this,ti)||[],listener);}},fireEvent:function(types){types=utils.trim(types).split(" ");for(var i=0,ti;ti=types[i++];){var listeners=getListener(this,ti),r,t,k;if(listeners){k=listeners.length;while(k--){if(!listeners[k]){continue;}t=listeners[k].apply(this,arguments);if(t===true){return t;}if(t!==undefined){r=t;}}}if(t=this["on"+ti.toLowerCase()]){r=t.apply(this,arguments);}}return r;}};function getListener(obj,type,force){var allListeners;type=type.toLowerCase();return((allListeners=(obj.__allListeners||force&&(obj.__allListeners={})))&&(allListeners[type]||force&&(allListeners[type]=[])));}var dtd=dom.dtd=(function(){function _(s){for(var k in s){s[k.toUpperCase()]=s[k];}return s;}var X=utils.extend2;var A=_({isindex:1,fieldset:1}),B=_({input:1,button:1,select:1,textarea:1,label:1}),C=X(_({a:1}),B),D=X({iframe:1},C),E=_({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),F=_({ins:1,del:1,script:1,style:1}),G=X(_({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),F),H=X(_({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),G),I=X(_({p:1}),H),J=X(_({iframe:1}),H,B),K=_({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),L=X(_({a:0}),J),M=_({tr:1}),N=_({"#":1}),O=X(_({param:1}),K),P=X(_({form:1}),A,D,E,I),Q=_({li:1}),R=_({style:1,script:1}),S=_({base:1,link:1,meta:1,title:1}),T=X(S,R),U=_({head:1,body:1}),V=_({html:1});var block=_({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),empty=_({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return _({$nonBodyContent:X(V,U,S),$block:block,$inline:L,$body:X(_({script:1,style:1}),block),$cdata:_({script:1,style:1}),$empty:empty,$nonChild:_({iframe:1,textarea:1}),$listItem:_({dd:1,dt:1,li:1}),$list:_({ul:1,ol:1,dl:1}),$isNotEmpty:_({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:_({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:_({"p":1,"div":1}),$tableContent:_({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:_({pre:1,script:1,style:1,textarea:1}),html:U,head:T,style:N,script:N,body:P,base:{},link:{},meta:{},title:N,col:{},tr:_({td:1,th:1}),img:{},embed:{},colgroup:_({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:P,td:P,br:{},th:P,center:P,kbd:L,button:X(I,E),basefont:{},h5:L,h4:L,samp:L,h6:L,ol:Q,h1:L,h3:L,option:N,h2:L,form:X(A,D,E,I),select:_({optgroup:1,option:1}),font:L,ins:L,menu:Q,abbr:L,label:L,table:_({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:L,tfoot:M,cite:L,li:P,input:{},iframe:P,strong:L,textarea:N,noframes:P,big:L,small:L,span:_({"#":1,br:1}),hr:L,dt:L,sub:L,optgroup:_({option:1}),param:{},bdo:L,"var":L,div:P,object:O,sup:L,dd:P,strike:L,area:{},dir:Q,map:X(_({area:1,form:1,p:1}),A,F,E),applet:O,dl:_({dt:1,dd:1}),del:L,isindex:{},fieldset:X(_({legend:1}),K),thead:M,ul:Q,acronym:L,b:L,a:X(_({a:1}),J),blockquote:X(_({td:1,tr:1,tbody:1,li:1}),P),caption:L,i:L,u:L,tbody:M,s:L,address:X(D,I),tt:L,legend:L,q:L,pre:X(G,C),p:X(_({"a":1}),L),em:L,dfn:L});})();function getDomNode(node,start,ltr,startFromChild,fn,guard){var tmpNode=startFromChild&&node[start],parent;!tmpNode&&(tmpNode=node[ltr]);while(!tmpNode&&(parent=(parent||node).parentNode)){if(parent.tagName=="BODY"||guard&&!guard(parent)){return null;}tmpNode=parent[ltr];}if(tmpNode&&fn&&!fn(tmpNode)){return getDomNode(tmpNode,start,ltr,false,fn);}return tmpNode;}var attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]);var domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&browser.version=="6"?"\ufeff":"\u200B",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(nodeA,nodeB){if(nodeA===nodeB){return 0;}var node,parentsA=[nodeA],parentsB=[nodeB];node=nodeA;while(node=node.parentNode){if(node===nodeB){return 10;}parentsA.push(node);}node=nodeB;while(node=node.parentNode){if(node===nodeA){return 20;}parentsB.push(node);}parentsA.reverse();parentsB.reverse();if(parentsA[0]!==parentsB[0]){return 1;}var i=-1;while(i++,parentsA[i]===parentsB[i]){}nodeA=parentsA[i];nodeB=parentsB[i];while(nodeA=nodeA.nextSibling){if(nodeA===nodeB){return 4;}}return 2;},getNodeIndex:function(node,ignoreTextNode){var preNode=node,i=0;while(preNode=preNode.previousSibling){if(ignoreTextNode&&preNode.nodeType==3){if(preNode.nodeType!=preNode.nextSibling.nodeType){i++;}continue;}i++;}return i;},inDoc:function(node,doc){return domUtils.getPosition(node,doc)==10;},findParent:function(node,filterFn,includeSelf){if(node&&!domUtils.isBody(node)){node=includeSelf?node:node.parentNode;while(node){if(!filterFn||filterFn(node)||domUtils.isBody(node)){return filterFn&&!filterFn(node)&&domUtils.isBody(node)?null:node;}node=node.parentNode;}}return null;},findParentByTagName:function(node,tagNames,includeSelf,excludeFn){tagNames=utils.listToMap(utils.isArray(tagNames)?tagNames:[tagNames]);return domUtils.findParent(node,function(node){return tagNames[node.tagName]&&!(excludeFn&&excludeFn(node));},includeSelf);},findParents:function(node,includeSelf,filterFn,closerFirst){var parents=includeSelf&&(filterFn&&filterFn(node)||!filterFn)?[node]:[];while(node=domUtils.findParent(node,filterFn)){parents.push(node);}return closerFirst?parents:parents.reverse();},insertAfter:function(node,newNode){return node.parentNode.insertBefore(newNode,node.nextSibling);},remove:function(node,keepChildren){var parent=node.parentNode,child;if(parent){if(keepChildren&&node.hasChildNodes()){while(child=node.firstChild){parent.insertBefore(child,node);}}parent.removeChild(node);}return node;},getNextDomNode:function(node,startFromChild,filterFn,guard){return getDomNode(node,"firstChild","nextSibling",startFromChild,filterFn,guard);},isBookmarkNode:function(node){return node.nodeType==1&&node.id&&/^_baidu_bookmark_/i.test(node.id);},getWindow:function(node){var doc=node.ownerDocument||node;return doc.defaultView||doc.parentWindow;},getCommonAncestor:function(nodeA,nodeB){if(nodeA===nodeB){return nodeA;}var parentsA=[nodeA],parentsB=[nodeB],parent=nodeA,i=-1;while(parent=parent.parentNode){if(parent===nodeB){return parent;}parentsA.push(parent);}parent=nodeB;while(parent=parent.parentNode){if(parent===nodeA){return parent;}parentsB.push(parent);}parentsA.reverse();parentsB.reverse();while(i++,parentsA[i]===parentsB[i]){}return i==0?null:parentsA[i-1];},clearEmptySibling:function(node,ignoreNext,ignorePre){function clear(next,dir){var tmpNode;while(next&&!domUtils.isBookmarkNode(next)&&(domUtils.isEmptyInlineElement(next)||!new RegExp("[^\t\n\r"+domUtils.fillChar+"]").test(next.nodeValue))){tmpNode=next[dir];domUtils.remove(next);next=tmpNode;}}!ignoreNext&&clear(node.nextSibling,"nextSibling");!ignorePre&&clear(node.previousSibling,"previousSibling");},split:function(node,offset){var doc=node.ownerDocument;if(browser.ie&&offset==node.nodeValue.length){var next=doc.createTextNode("");return domUtils.insertAfter(node,next);}var retval=node.splitText(offset);if(browser.ie8){var tmpNode=doc.createTextNode("");domUtils.insertAfter(retval,tmpNode);domUtils.remove(tmpNode);}return retval;},isWhitespace:function(node){return !new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(node.nodeValue);},getXY:function(element){var x=0,y=0;while(element.offsetParent){y+=element.offsetTop;x+=element.offsetLeft;element=element.offsetParent;}return{"x":x,"y":y};},on:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k){while(k--){type=types[k];if(element.addEventListener){element.addEventListener(type,handler,false);}else{if(!handler._d){handler._d={els:[]};}var key=type+handler.toString(),index=utils.indexOf(handler._d.els,element);if(!handler._d[key]||index==-1){if(index==-1){handler._d.els.push(element);}if(!handler._d[key]){handler._d[key]=function(evt){return handler.call(evt.srcElement,evt||window.event);};}element.attachEvent("on"+type,handler._d[key]);}}}}element=null;},un:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k){while(k--){type=types[k];if(element.removeEventListener){element.removeEventListener(type,handler,false);}else{var key=type+handler.toString();try{element.detachEvent("on"+type,handler._d?handler._d[key]:handler);}catch(e){}if(handler._d&&handler._d[key]){var index=utils.indexOf(handler._d.els,element);if(index!=-1){handler._d.els.splice(index,1);}handler._d.els.length==0&&delete handler._d[key];}}}}},isSameElement:function(nodeA,nodeB){if(nodeA.tagName!=nodeB.tagName){return false;}var thisAttrs=nodeA.attributes,otherAttrs=nodeB.attributes;if(!ie&&thisAttrs.length!=otherAttrs.length){return false;}var attrA,attrB,al=0,bl=0;for(var i=0;attrA=thisAttrs[i++];){if(attrA.nodeName=="style"){if(attrA.specified){al++;}if(domUtils.isSameStyle(nodeA,nodeB)){continue;}else{return false;}}if(ie){if(attrA.specified){al++;attrB=otherAttrs.getNamedItem(attrA.nodeName);}else{continue;}}else{attrB=nodeB.attributes[attrA.nodeName];}if(!attrB.specified||attrA.nodeValue!=attrB.nodeValue){return false;}}if(ie){for(i=0;attrB=otherAttrs[i++];){if(attrB.specified){bl++;}}if(al!=bl){return false;}}return true;},isSameStyle:function(nodeA,nodeB){var styleA=nodeA.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),styleB=nodeB.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){styleA=nodeA.style;styleB=nodeB.style;if(styleA.length!=styleB.length){return false;}for(var p in styleA){if(/^(\d+|csstext)$/i.test(p)){continue;}if(styleA[p]!=styleB[p]){return false;}}return true;}if(!styleA||!styleB){return styleA==styleB;}styleA=styleA.split(";");styleB=styleB.split(";");if(styleA.length!=styleB.length){return false;}for(var i=0,ci;ci=styleA[i++];){if(utils.indexOf(styleB,ci)==-1){return false;}}return true;},isBlockElm:function(node){return node.nodeType==1&&(dtd.$block[node.tagName]||styleBlock[domUtils.getComputedStyle(node,"display")])&&!dtd.$nonChild[node.tagName];},isBody:function(node){return node&&node.nodeType==1&&node.tagName.toLowerCase()=="body";},breakParent:function(node,parent){var tmpNode,parentClone=node,clone=node,leftNodes,rightNodes;do{parentClone=parentClone.parentNode;if(leftNodes){tmpNode=parentClone.cloneNode(false);tmpNode.appendChild(leftNodes);leftNodes=tmpNode;tmpNode=parentClone.cloneNode(false);tmpNode.appendChild(rightNodes);rightNodes=tmpNode;}else{leftNodes=parentClone.cloneNode(false);rightNodes=leftNodes.cloneNode(false);}while(tmpNode=clone.previousSibling){leftNodes.insertBefore(tmpNode,leftNodes.firstChild);}while(tmpNode=clone.nextSibling){rightNodes.appendChild(tmpNode);}clone=parentClone;}while(parent!==parentClone);tmpNode=parent.parentNode;tmpNode.insertBefore(leftNodes,parent);tmpNode.insertBefore(rightNodes,parent);tmpNode.insertBefore(node,rightNodes);domUtils.remove(parent);return node;},isEmptyInlineElement:function(node){if(node.nodeType!=1||!dtd.$removeEmpty[node.tagName]){return 0;}node=node.firstChild;while(node){if(domUtils.isBookmarkNode(node)){return 0;}if(node.nodeType==1&&!domUtils.isEmptyInlineElement(node)||node.nodeType==3&&!domUtils.isWhitespace(node)){return 0;}node=node.nextSibling;}return 1;},trimWhiteTextNode:function(node){function remove(dir){var child;while((child=node[dir])&&child.nodeType==3&&domUtils.isWhitespace(child)){node.removeChild(child);}}remove("firstChild");remove("lastChild");},mergeChild:function(node,tagName,attrs){var list=domUtils.getElementsByTagName(node,node.tagName.toLowerCase());for(var i=0,ci;ci=list[i++];){if(!ci.parentNode||domUtils.isBookmarkNode(ci)){continue;}if(ci.tagName.toLowerCase()=="span"){if(node===ci.parentNode){domUtils.trimWhiteTextNode(node);if(node.childNodes.length==1){node.style.cssText=ci.style.cssText+";"+node.style.cssText;domUtils.remove(ci,true);continue;}}ci.style.cssText=node.style.cssText+";"+ci.style.cssText;if(attrs){var style=attrs.style;if(style){style=style.split(";");for(var j=0,s;s=style[j++];){ci.style[utils.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1];}}}if(domUtils.isSameStyle(ci,node)){domUtils.remove(ci,true);}continue;}if(domUtils.isSameElement(node,ci)){domUtils.remove(ci,true);}}},getElementsByTagName:function(node,name,filter){if(filter&&utils.isString(filter)){var className=filter;filter=function(node){return domUtils.hasClass(node,className);};}name=utils.trim(name).replace(/[ ]{2,}/g," ").split(" ");var arr=[];for(var n=0,ni;ni=name[n++];){var list=node.getElementsByTagName(ni);for(var i=0,ci;ci=list[i++];){if(!filter||filter(ci)){arr.push(ci);}}}return arr;},mergeToParent:function(node){var parent=node.parentNode;while(parent&&dtd.$removeEmpty[parent.tagName]){if(parent.tagName==node.tagName||parent.tagName=="A"){domUtils.trimWhiteTextNode(parent);if(parent.tagName=="SPAN"&&!domUtils.isSameStyle(parent,node)||(parent.tagName=="A"&&node.tagName=="SPAN")){if(parent.childNodes.length>1||parent!==node.parentNode){node.style.cssText=parent.style.cssText+";"+node.style.cssText;parent=parent.parentNode;continue;}else{parent.style.cssText+=";"+node.style.cssText;if(parent.tagName=="A"){parent.style.textDecoration="underline";}}}if(parent.tagName!="A"){parent===node.parentNode&&domUtils.remove(node,true);break;}}parent=parent.parentNode;}},mergeSibling:function(node,ignorePre,ignoreNext){function merge(rtl,start,node){var next;if((next=node[rtl])&&!domUtils.isBookmarkNode(next)&&next.nodeType==1&&domUtils.isSameElement(node,next)){while(next.firstChild){if(start=="firstChild"){node.insertBefore(next.lastChild,node.firstChild);}else{node.appendChild(next.firstChild);}}domUtils.remove(next);}}!ignorePre&&merge("previousSibling","firstChild",node);!ignoreNext&&merge("nextSibling","lastChild",node);},unSelectable:ie||browser.opera?function(node){node.onselectstart=function(){return false;};node.onclick=node.onkeyup=node.onkeydown=function(){return false;};node.unselectable="on";node.setAttribute("unselectable","on");for(var i=0,ci;ci=node.all[i++];){switch(ci.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:ci.unselectable="on";node.setAttribute("unselectable","on");}}}:function(node){node.style.MozUserSelect=node.style.webkitUserSelect=node.style.KhtmlUserSelect="none";},removeAttributes:function(node,attrNames){attrNames=utils.isArray(attrNames)?attrNames:utils.trim(attrNames).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,ci;ci=attrNames[i++];){ci=attrFix[ci]||ci;switch(ci){case"className":node[ci]="";break;case"style":node.style.cssText="";!browser.ie&&node.removeAttributeNode(node.getAttributeNode("style"));}node.removeAttribute(ci);}},createElement:function(doc,tag,attrs){return domUtils.setAttributes(doc.createElement(tag),attrs);},setAttributes:function(node,attrs){for(var attr in attrs){if(attrs.hasOwnProperty(attr)){var value=attrs[attr];switch(attr){case"class":node.className=value;break;case"style":node.style.cssText=node.style.cssText+";"+value;break;case"innerHTML":node[attr]=value;break;case"value":node.value=value;break;default:node.setAttribute(attrFix[attr]||attr,value);}}}return node;},getComputedStyle:function(element,styleName){var pros="width height top left";if(pros.indexOf(styleName)>-1){return element["offset"+styleName.replace(/^\w/,function(s){return s.toUpperCase();})]+"px";}if(element.nodeType==3){element=element.parentNode;}if(browser.ie&&browser.version<9&&styleName=="font-size"&&!element.style.fontSize&&!dtd.$empty[element.tagName]&&!dtd.$nonChild[element.tagName]){var span=element.ownerDocument.createElement("span");span.style.cssText="padding:0;border:0;font-family:simsun;";span.innerHTML=".";element.appendChild(span);var result=span.offsetHeight;element.removeChild(span);span=null;return result+"px";}try{var value=domUtils.getStyle(element,styleName)||(window.getComputedStyle?domUtils.getWindow(element).getComputedStyle(element,"").getPropertyValue(styleName):(element.currentStyle||element.style)[utils.cssStyleToDomStyle(styleName)]);}catch(e){return"";}return utils.transUnitToPx(utils.fixColor(styleName,value));},removeClasses:function(elm,classNames){classNames=utils.isArray(classNames)?classNames:utils.trim(classNames).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,ci,cls=elm.className;ci=classNames[i++];){cls=cls.replace(new RegExp("\\b"+ci+"\\b"),"");}cls=utils.trim(cls).replace(/[ ]{2,}/g," ");if(cls){elm.className=cls;}else{domUtils.removeAttributes(elm,["class"]);}},addClass:function(elm,classNames){if(!elm){return;}classNames=utils.trim(classNames).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,ci,cls=elm.className;ci=classNames[i++];){if(!new RegExp("\\b"+ci+"\\b").test(cls)){elm.className+=" "+ci;}}},hasClass:function(element,className){if(utils.isRegExp(className)){return className.test(element.className);}className=utils.trim(className).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,ci,cls=element.className;ci=className[i++];){if(!new RegExp("\\b"+ci+"\\b","i").test(cls)){return false;}}return i-1==className.length;},preventDefault:function(evt){evt.preventDefault?evt.preventDefault():(evt.returnValue=false);},removeStyle:function(element,name){if(browser.ie&&browser.version>8){element.style.cssText=element.style.cssText.replace(new RegExp(name+"s*:s*[^;]+;?"),"");}else{if(element.style.removeProperty){element.style.removeProperty(name);}else{element.style.removeAttribute(utils.cssStyleToDomStyle(name));}}if(!element.style.cssText){domUtils.removeAttributes(element,["style"]);}},getStyle:function(element,name){var value=element.style[utils.cssStyleToDomStyle(name)];return utils.fixColor(name,value);},setStyle:function(element,name,value){element.style[utils.cssStyleToDomStyle(name)]=value;},setStyles:function(element,styles){for(var name in styles){if(styles.hasOwnProperty(name)){domUtils.setStyle(element,name,styles[name]);}}},removeDirtyAttr:function(node){for(var i=0,ci,nodes=node.getElementsByTagName("*");ci=nodes[i++];){ci.removeAttribute("_moz_dirty");}node.removeAttribute("_moz_dirty");},getChildCount:function(node,fn){var count=0,first=node.firstChild;fn=fn||function(){return 1;};while(first){if(fn(first)){count++;}first=first.nextSibling;}return count;},isEmptyNode:function(node){return !node.firstChild||domUtils.getChildCount(node,function(node){return !domUtils.isBr(node)&&!domUtils.isBookmarkNode(node)&&!domUtils.isWhitespace(node);})==0;},clearSelectedArr:function(nodes){var node;while(node=nodes.pop()){domUtils.removeAttributes(node,["class"]);}},scrollToView:function(node,win,offsetTop){var getViewPaneSize=function(){var doc=win.document,mode=doc.compatMode=="CSS1Compat";return{width:(mode?doc.documentElement.clientWidth:doc.body.clientWidth)||0,height:(mode?doc.documentElement.clientHeight:doc.body.clientHeight)||0};},getScrollPosition=function(win){if("pageXOffset" in win){return{x:win.pageXOffset||0,y:win.pageYOffset||0};}else{var doc=win.document;return{x:doc.documentElement.scrollLeft||doc.body.scrollLeft||0,y:doc.documentElement.scrollTop||doc.body.scrollTop||0};}};var winHeight=getViewPaneSize().height,offset=winHeight*-1+offsetTop;offset+=(node.offsetHeight||0);var elementPosition=domUtils.getXY(node);offset+=elementPosition.y;var currentScroll=getScrollPosition(win).y;if(offset>currentScroll||offset<currentScroll-winHeight){win.scrollTo(0,offset+(offset<0?-20:20));}},isBr:function(node){return node.nodeType==1&&node.tagName=="BR";},isFillChar:function(node,isInStart){return node.nodeType==3&&!node.nodeValue.replace(new RegExp((isInStart?"^":"")+domUtils.fillChar),"").length;},isStartInblock:function(range){var tmpRange=range.cloneRange(),flag=0,start=tmpRange.startContainer,tmp;if(start.nodeType==1&&start.childNodes[tmpRange.startOffset]){start=start.childNodes[tmpRange.startOffset];var pre=start.previousSibling;while(pre&&domUtils.isFillChar(pre)){start=pre;pre=pre.previousSibling;}}if(this.isFillChar(start,true)&&tmpRange.startOffset==1){tmpRange.setStartBefore(start);start=tmpRange.startContainer;}while(start&&domUtils.isFillChar(start)){tmp=start;start=start.previousSibling;}if(tmp){tmpRange.setStartBefore(tmp);start=tmpRange.startContainer;}if(start.nodeType==1&&domUtils.isEmptyNode(start)&&tmpRange.startOffset==1){tmpRange.setStart(start,0).collapse(true);}while(!tmpRange.startOffset){start=tmpRange.startContainer;if(domUtils.isBlockElm(start)||domUtils.isBody(start)){flag=1;break;}var pre=tmpRange.startContainer.previousSibling,tmpNode;if(!pre){tmpRange.setStartBefore(tmpRange.startContainer);}else{while(pre&&domUtils.isFillChar(pre)){tmpNode=pre;pre=pre.previousSibling;}if(tmpNode){tmpRange.setStartBefore(tmpNode);}else{tmpRange.setStartBefore(tmpRange.startContainer);}}}return flag&&!domUtils.isBody(tmpRange.startContainer)?1:0;},isEmptyBlock:function(node){var reg=new RegExp("[ \t\r\n"+domUtils.fillChar+"]","g");if(node[browser.ie?"innerText":"textContent"].replace(reg,"").length>0){return 0;}for(var n in dtd.$isNotEmpty){if(node.getElementsByTagName(n).length){return 0;}}return 1;},setViewportOffset:function(element,offset){var left=parseInt(element.style.left)|0;var top=parseInt(element.style.top)|0;var rect=element.getBoundingClientRect();var offsetLeft=offset.left-rect.left;var offsetTop=offset.top-rect.top;if(offsetLeft){element.style.left=left+offsetLeft+"px";}if(offsetTop){element.style.top=top+offsetTop+"px";}},fillNode:function(doc,node){var tmpNode=browser.ie?doc.createTextNode(domUtils.fillChar):doc.createElement("br");node.innerHTML="";node.appendChild(tmpNode);},moveChild:function(src,tag,dir){while(src.firstChild){if(dir&&tag.firstChild){tag.insertBefore(src.lastChild,tag.firstChild);}else{tag.appendChild(src.firstChild);}}},hasNoAttributes:function(node){return browser.ie?/^<\w+\s*?>/.test(node.outerHTML):node.attributes.length==0;},isCustomeNode:function(node){return node.nodeType==1&&node.getAttribute("_ue_custom_node_");},isTagNode:function(node,tagName){return node.nodeType==1&&new RegExp(node.tagName,"i").test(tagName);},filterNodeList:function(nodelist,filter,forAll){var results=[];if(!utils.isFunction(filter)){var str=filter;filter=function(n){return utils.indexOf(utils.isArray(str)?str:str.split(" "),n.tagName.toLowerCase())!=-1;};}utils.each(nodelist,function(n){filter(n)&&results.push(n);});return results.length==0?null:results.length==1||!forAll?results[0]:results;},isInNodeEndBoundary:function(rng,node){var start=rng.startContainer;if(start.nodeType==3&&rng.startOffset!=start.nodeValue.length){return 0;}if(start.nodeType==1&&rng.startOffset!=start.childNodes.length){return 0;}while(start!==node){if(start.nextSibling){return 0;}start=start.parentNode;}return 1;},isBoundaryNode:function(node,dir){var tmp;while(!domUtils.isBody(node)){tmp=node;node=node.parentNode;if(tmp!==node[dir]){return false;}}return true;},findTagNamesInSelection:function(range,tags,filter){var as,ps,pe,node,start,end,common;if(range.collapsed){node=range.startContainer;if(node&&(node=domUtils.findParentByTagName(node,tags,true))){return node;}}else{range.shrinkBoundary();start=range.startContainer.nodeType==3||!range.startContainer.childNodes[range.startOffset]?range.startContainer:range.startContainer.childNodes[range.startOffset];end=range.endContainer.nodeType==3||range.endOffset==0?range.endContainer:range.endContainer.childNodes[range.endOffset-1];common=domUtils.getCommonAncestor(start,end);for(var j=0,t;t=tags[j++];){node=domUtils.findParentByTagName(common,t,true);if(!node&&common.nodeType==1){as=common.getElementsByTagName(t);for(var i=0,ci;ci=as[i++];){if(start==ci||end==ci){node=ci;if(filter){if(filter(node)){break;}node=null;}else{break;}}ps=domUtils.getPosition(ci,start),pe=domUtils.getPosition(ci,end);if((ps&domUtils.POSITION_FOLLOWING||ps&domUtils.POSITION_CONTAINS)&&(pe&domUtils.POSITION_PRECEDING||pe&domUtils.POSITION_CONTAINS)){node=ci;if(filter){if(filter(node)){break;}node=null;}else{break;}}}}if(node){return node;}}}return null;},triggerLayout:function(elm){if(elm.style.zoom=="1"){elm.style.zoom="100%";}else{elm.style.zoom="1";}},findStartElement:function(range,tester){var node=range.startContainer;if(node.hasChildNodes()){node=node.childNodes[range.startOffset]||node;}else{if(node.nodeType==3){if(range.startOffset==0){node=node.previousSibling||node.parentNode;while(node.nodeType==3&&!node.nodeValue){node=node.previousSibling||node.parentNode;}}else{if(range.startOffset>=node.nodeValue.length){node=node.nextSibling||node.parentNode;while(node.nodeType==3&&!node.nodeValue){node=node.nextSibling||node.parentNode;}}}}}if(node.nodeType!=1){node=node.parentNode;}while(node!=null){if(matchSelector(node)){return node;}node=node.parentNode;}return null;function matchSelector(node){if(typeof tester=="string"){return node.nodeName==tester;}else{if(typeof tester=="function"){return tester(node);}else{return tester.test(node.nodeName);}}}},clearReduent:function(node,tags){tags=tags||[];var nodes,reg=new RegExp(domUtils.fillChar,"g"),_parent;for(var t=0,ti;ti=tags[t++];){nodes=node.getElementsByTagName(ti);for(var i=0,ci;ci=nodes[i++];){if(ci.parentNode&&ci[browser.ie?"innerText":"textContent"].replace(reg,"").length==0&&ci.children.length==0){_parent=ci.parentNode;domUtils.remove(ci);while(_parent.childNodes.length==0&&new RegExp(tags.join("|"),"i").test(_parent.tagName)){ci=_parent;_parent=_parent.parentNode;domUtils.remove(ci);}}}}},getChildCount:function(node,fn){var count=0,first=node.firstChild;fn=fn||function(){return 1;};while(first){if(fn(first)){count++;}first=first.nextSibling;}return count;},getPreviousDomNode:function(node,startFromChild,fn){return getDomNode(node,"lastChild","previousSibling",startFromChild,fn);}};var fillCharReg=new RegExp(domUtils.fillChar,"g");(function(){var guid=0,fillChar=domUtils.fillChar,fillData;function updateCollapse(range){range.collapsed=range.startContainer&&range.endContainer&&range.startContainer===range.endContainer&&range.startOffset==range.endOffset;}function selectOneNode(rng){return !rng.collapsed&&rng.startContainer.nodeType==1&&rng.startContainer===rng.endContainer&&rng.endOffset-rng.startOffset==1;}function setEndPoint(toStart,node,offset,range){if(node.nodeType==1&&(dtd.$empty[node.tagName]||dtd.$nonChild[node.tagName])){offset=domUtils.getNodeIndex(node)+(toStart?0:1);node=node.parentNode;}if(toStart){range.startContainer=node;range.startOffset=offset;if(!range.endContainer){range.collapse(true);}}else{range.endContainer=node;range.endOffset=offset;if(!range.startContainer){range.collapse(false);}}updateCollapse(range);return range;}function execContentsAction(range,action){var start=range.startContainer,end=range.endContainer,startOffset=range.startOffset,endOffset=range.endOffset,doc=range.document,frag=doc.createDocumentFragment(),tmpStart,tmpEnd;if(start.nodeType==1){start=start.childNodes[startOffset]||(tmpStart=start.appendChild(doc.createTextNode("")));}if(end.nodeType==1){end=end.childNodes[endOffset]||(tmpEnd=end.appendChild(doc.createTextNode("")));}if(start===end&&start.nodeType==3){frag.appendChild(doc.createTextNode(start.substringData(startOffset,endOffset-startOffset)));if(action){start.deleteData(startOffset,endOffset-startOffset);range.collapse(true);}return frag;}var current,currentLevel,clone=frag,startParents=domUtils.findParents(start,true),endParents=domUtils.findParents(end,true);for(var i=0;startParents[i]==endParents[i];){i++;}for(var j=i,si;si=startParents[j];j++){current=si.nextSibling;if(si==start){if(!tmpStart){if(range.startContainer.nodeType==3){clone.appendChild(doc.createTextNode(start.nodeValue.slice(startOffset)));if(action){start.deleteData(startOffset,start.nodeValue.length-startOffset);}}else{clone.appendChild(!action?start.cloneNode(true):start);}}}else{currentLevel=si.cloneNode(false);clone.appendChild(currentLevel);}while(current){if(current===end||current===endParents[j]){break;}si=current.nextSibling;clone.appendChild(!action?current.cloneNode(true):current);current=si;}clone=currentLevel;}clone=frag;if(!startParents[i]){clone.appendChild(startParents[i-1].cloneNode(false));clone=clone.firstChild;}for(var j=i,ei;ei=endParents[j];j++){current=ei.previousSibling;if(ei==end){if(!tmpEnd&&range.endContainer.nodeType==3){clone.appendChild(doc.createTextNode(end.substringData(0,endOffset)));if(action){end.deleteData(0,endOffset);}}}else{currentLevel=ei.cloneNode(false);clone.appendChild(currentLevel);}if(j!=i||!startParents[i]){while(current){if(current===start){break;}ei=current.previousSibling;clone.insertBefore(!action?current.cloneNode(true):current,clone.firstChild);current=ei;}}clone=currentLevel;}if(action){range.setStartBefore(!endParents[i]?endParents[i-1]:!startParents[i]?startParents[i-1]:endParents[i]).collapse(true);}tmpStart&&domUtils.remove(tmpStart);tmpEnd&&domUtils.remove(tmpEnd);return frag;}var Range=dom.Range=function(document){var me=this;me.startContainer=me.startOffset=me.endContainer=me.endOffset=null;me.document=document;me.collapsed=true;};function removeFillData(doc,excludeNode){try{if(fillData&&domUtils.inDoc(fillData,doc)){if(!fillData.nodeValue.replace(fillCharReg,"").length){var tmpNode=fillData.parentNode;domUtils.remove(fillData);while(tmpNode&&domUtils.isEmptyInlineElement(tmpNode)&&(browser.safari?!(domUtils.getPosition(tmpNode,excludeNode)&domUtils.POSITION_CONTAINS):!tmpNode.contains(excludeNode))){fillData=tmpNode.parentNode;domUtils.remove(tmpNode);tmpNode=fillData;}}else{fillData.nodeValue=fillData.nodeValue.replace(fillCharReg,"");}}}catch(e){}}function mergeSibling(node,dir){var tmpNode;node=node[dir];while(node&&domUtils.isFillChar(node)){tmpNode=node[dir];domUtils.remove(node);node=tmpNode;}}Range.prototype={cloneContents:function(){return this.collapsed?null:execContentsAction(this,0);},deleteContents:function(){var txt;if(!this.collapsed){execContentsAction(this,1);}if(browser.webkit){txt=this.startContainer;if(txt.nodeType==3&&!txt.nodeValue.length){this.setStartBefore(txt).collapse(true);domUtils.remove(txt);}}return this;},extractContents:function(){return this.collapsed?null:execContentsAction(this,2);},setStart:function(node,offset){return setEndPoint(true,node,offset,this);},setEnd:function(node,offset){return setEndPoint(false,node,offset,this);},setStartAfter:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node)+1);},setStartBefore:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node));},setEndAfter:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node)+1);},setEndBefore:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node));},setStartAtFirst:function(node){return this.setStart(node,0);},setStartAtLast:function(node){return this.setStart(node,node.nodeType==3?node.nodeValue.length:node.childNodes.length);},setEndAtFirst:function(node){return this.setEnd(node,0);},setEndAtLast:function(node){return this.setEnd(node,node.nodeType==3?node.nodeValue.length:node.childNodes.length);},selectNode:function(node){return this.setStartBefore(node).setEndAfter(node);},selectNodeContents:function(node){return this.setStart(node,0).setEndAtLast(node);},cloneRange:function(){var me=this;return new Range(me.document).setStart(me.startContainer,me.startOffset).setEnd(me.endContainer,me.endOffset);},collapse:function(toStart){var me=this;if(toStart){me.endContainer=me.startContainer;me.endOffset=me.startOffset;}else{me.startContainer=me.endContainer;me.startOffset=me.endOffset;}me.collapsed=true;return me;},shrinkBoundary:function(ignoreEnd){var me=this,child,collapsed=me.collapsed;function check(node){return node.nodeType==1&&!domUtils.isBookmarkNode(node)&&!dtd.$empty[node.tagName]&&!dtd.$nonChild[node.tagName];}while(me.startContainer.nodeType==1&&(child=me.startContainer.childNodes[me.startOffset])&&check(child)){me.setStart(child,0);}if(collapsed){return me.collapse(true);}if(!ignoreEnd){while(me.endContainer.nodeType==1&&me.endOffset>0&&(child=me.endContainer.childNodes[me.endOffset-1])&&check(child)){me.setEnd(child,child.childNodes.length);}}return me;},getCommonAncestor:function(includeSelf,ignoreTextNode){var me=this,start=me.startContainer,end=me.endContainer;if(start===end){if(includeSelf&&selectOneNode(this)){start=start.childNodes[me.startOffset];if(start.nodeType==1){return start;}}return ignoreTextNode&&start.nodeType==3?start.parentNode:start;}return domUtils.getCommonAncestor(start,end);},trimBoundary:function(ignoreEnd){this.txtToElmBoundary();var start=this.startContainer,offset=this.startOffset,collapsed=this.collapsed,end=this.endContainer;if(start.nodeType==3){if(offset==0){this.setStartBefore(start);}else{if(offset>=start.nodeValue.length){this.setStartAfter(start);}else{var textNode=domUtils.split(start,offset);if(start===end){this.setEnd(textNode,this.endOffset-offset);}else{if(start.parentNode===end){this.endOffset+=1;}}this.setStartBefore(textNode);}}if(collapsed){return this.collapse(true);}}if(!ignoreEnd){offset=this.endOffset;end=this.endContainer;if(end.nodeType==3){if(offset==0){this.setEndBefore(end);}else{offset<end.nodeValue.length&&domUtils.split(end,offset);this.setEndAfter(end);}}}return this;},txtToElmBoundary:function(){function adjust(r,c){var container=r[c+"Container"],offset=r[c+"Offset"];if(container.nodeType==3){if(!offset){r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase();})+"Before"](container);}else{if(offset>=container.nodeValue.length){r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase();})+"After"](container);}}}}if(!this.collapsed){adjust(this,"start");adjust(this,"end");}return this;},insertNode:function(node){var first=node,length=1;if(node.nodeType==11){first=node.firstChild;length=node.childNodes.length;}this.trimBoundary(true);var start=this.startContainer,offset=this.startOffset;var nextNode=start.childNodes[offset];if(nextNode){start.insertBefore(node,nextNode);}else{start.appendChild(node);}if(first.parentNode===this.endContainer){this.endOffset=this.endOffset+length;}return this.setStartBefore(first);},setCursor:function(toEnd,noFillData){return this.collapse(!toEnd).select(noFillData);},createBookmark:function(serialize,same){var endNode,startNode=this.document.createElement("span");startNode.style.cssText="display:none;line-height:0px;";startNode.appendChild(this.document.createTextNode("\u200D"));startNode.id="_baidu_bookmark_start_"+(same?"":guid++);if(!this.collapsed){endNode=startNode.cloneNode(true);endNode.id="_baidu_bookmark_end_"+(same?"":guid++);}this.insertNode(startNode);if(endNode){this.collapse().insertNode(endNode).setEndBefore(endNode);}this.setStartAfter(startNode);return{start:serialize?startNode.id:startNode,end:endNode?serialize?endNode.id:endNode:null,id:serialize};},moveToBookmark:function(bookmark){var start=bookmark.id?this.document.getElementById(bookmark.start):bookmark.start,end=bookmark.end&&bookmark.id?this.document.getElementById(bookmark.end):bookmark.end;this.setStartBefore(start);domUtils.remove(start);if(end){this.setEndBefore(end);domUtils.remove(end);}else{this.collapse(true);}return this;},enlarge:function(toBlock,stopFn){var isBody=domUtils.isBody,pre,node,tmp=this.document.createTextNode("");if(toBlock){node=this.startContainer;if(node.nodeType==1){if(node.childNodes[this.startOffset]){pre=node=node.childNodes[this.startOffset];}else{node.appendChild(tmp);pre=node=tmp;}}else{pre=node;}while(1){if(domUtils.isBlockElm(node)){node=pre;while((pre=node.previousSibling)&&!domUtils.isBlockElm(pre)){node=pre;}this.setStartBefore(node);break;}pre=node;node=node.parentNode;}node=this.endContainer;if(node.nodeType==1){if(pre=node.childNodes[this.endOffset]){node.insertBefore(tmp,pre);}else{node.appendChild(tmp);}pre=node=tmp;}else{pre=node;}while(1){if(domUtils.isBlockElm(node)){node=pre;while((pre=node.nextSibling)&&!domUtils.isBlockElm(pre)){node=pre;}this.setEndAfter(node);break;}pre=node;node=node.parentNode;}if(tmp.parentNode===this.endContainer){this.endOffset--;}domUtils.remove(tmp);}if(!this.collapsed){while(this.startOffset==0){if(stopFn&&stopFn(this.startContainer)){break;}if(isBody(this.startContainer)){break;}this.setStartBefore(this.startContainer);}while(this.endOffset==(this.endContainer.nodeType==1?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)){if(stopFn&&stopFn(this.endContainer)){break;}if(isBody(this.endContainer)){break;}this.setEndAfter(this.endContainer);}}return this;},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setStartAfter(this.startContainer);}while(!domUtils.isBody(this.endContainer)&&!this.endOffset){this.setEndBefore(this.endContainer);}}return this;},applyInlineStyle:function(tagName,attrs,list){if(this.collapsed){return this;}this.trimBoundary().enlarge(false,function(node){return node.nodeType==1&&domUtils.isBlockElm(node);}).adjustmentBoundary();var bookmark=this.createBookmark(),end=bookmark.end,filterFn=function(node){return node.nodeType==1?node.tagName.toLowerCase()!="br":!domUtils.isWhitespace(node);},current=domUtils.getNextDomNode(bookmark.start,false,filterFn),node,pre,range=this.cloneRange();while(current&&(domUtils.getPosition(current,end)&domUtils.POSITION_PRECEDING)){if(current.nodeType==3||dtd[tagName][current.tagName]){range.setStartBefore(current);node=current;while(node&&(node.nodeType==3||dtd[tagName][node.tagName])&&node!==end){pre=node;node=domUtils.getNextDomNode(node,node.nodeType==1,null,function(parent){return dtd[tagName][parent.tagName];});}var frag=range.setEndAfter(pre).extractContents(),elm;if(list&&list.length>0){var level,top;top=level=list[0].cloneNode(false);for(var i=1,ci;ci=list[i++];){level.appendChild(ci.cloneNode(false));level=level.firstChild;}elm=level;}else{elm=range.document.createElement(tagName);}if(attrs){domUtils.setAttributes(elm,attrs);}elm.appendChild(frag);range.insertNode(list?top:elm);var aNode;if(tagName=="span"&&attrs.style&&/text\-decoration/.test(attrs.style)&&(aNode=domUtils.findParentByTagName(elm,"a",true))){domUtils.setAttributes(aNode,attrs);domUtils.remove(elm,true);elm=aNode;}else{domUtils.mergeSibling(elm);domUtils.clearEmptySibling(elm);}domUtils.mergeChild(elm,attrs);current=domUtils.getNextDomNode(elm,false,filterFn);domUtils.mergeToParent(elm);if(node===end){break;}}else{current=domUtils.getNextDomNode(current,true,filterFn);}}return this.moveToBookmark(bookmark);},removeInlineStyle:function(tagNames){if(this.collapsed){return this;}tagNames=utils.isArray(tagNames)?tagNames:[tagNames];this.shrinkBoundary().adjustmentBoundary();var start=this.startContainer,end=this.endContainer;while(1){if(start.nodeType==1){if(utils.indexOf(tagNames,start.tagName.toLowerCase())>-1){break;}if(start.tagName.toLowerCase()=="body"){start=null;break;}}start=start.parentNode;}while(1){if(end.nodeType==1){if(utils.indexOf(tagNames,end.tagName.toLowerCase())>-1){break;}if(end.tagName.toLowerCase()=="body"){end=null;break;}}end=end.parentNode;}var bookmark=this.createBookmark(),frag,tmpRange;if(start){tmpRange=this.cloneRange().setEndBefore(bookmark.start).setStartBefore(start);frag=tmpRange.extractContents();tmpRange.insertNode(frag);domUtils.clearEmptySibling(start,true);start.parentNode.insertBefore(bookmark.start,start);}if(end){tmpRange=this.cloneRange().setStartAfter(bookmark.end).setEndAfter(end);frag=tmpRange.extractContents();tmpRange.insertNode(frag);domUtils.clearEmptySibling(end,false,true);end.parentNode.insertBefore(bookmark.end,end.nextSibling);}var current=domUtils.getNextDomNode(bookmark.start,false,function(node){return node.nodeType==1;}),next;while(current&&current!==bookmark.end){next=domUtils.getNextDomNode(current,true,function(node){return node.nodeType==1;});if(utils.indexOf(tagNames,current.tagName.toLowerCase())>-1){domUtils.remove(current,true);}current=next;}return this.moveToBookmark(bookmark);},getClosedNode:function(){var node;if(!this.collapsed){var range=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(selectOneNode(range)){var child=range.startContainer.childNodes[range.startOffset];if(child&&child.nodeType==1&&(dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName])){node=child;}}}return node;},select:browser.ie?function(noFillData,textRange){var nativeRange;if(!this.collapsed){this.shrinkBoundary();}var node=this.getClosedNode();if(node&&!textRange){try{nativeRange=this.document.body.createControlRange();nativeRange.addElement(node);nativeRange.select();}catch(e){}return this;}var bookmark=this.createBookmark(),start=bookmark.start,end;nativeRange=this.document.body.createTextRange();nativeRange.moveToElementText(start);nativeRange.moveStart("character",1);if(!this.collapsed){var nativeRangeEnd=this.document.body.createTextRange();end=bookmark.end;nativeRangeEnd.moveToElementText(end);nativeRange.setEndPoint("EndToEnd",nativeRangeEnd);}else{if(!noFillData&&this.startContainer.nodeType!=3){var tmpText=this.document.createTextNode(fillChar),tmp=this.document.createElement("span");tmp.appendChild(this.document.createTextNode(fillChar));start.parentNode.insertBefore(tmp,start);start.parentNode.insertBefore(tmpText,start);removeFillData(this.document,tmpText);fillData=tmpText;mergeSibling(tmp,"previousSibling");mergeSibling(start,"nextSibling");nativeRange.moveStart("character",-1);nativeRange.collapse(true);}}this.moveToBookmark(bookmark);tmp&&domUtils.remove(tmp);try{nativeRange.select();}catch(e){}return this;}:function(notInsertFillData){function checkOffset(rng){function check(node,offset,dir){if(node.nodeType==3&&node.nodeValue.length<offset){rng[dir+"Offset"]=node.nodeValue.length;}}check(rng.startContainer,rng.startOffset,"start");check(rng.endContainer,rng.endOffset,"end");}var win=domUtils.getWindow(this.document),sel=win.getSelection(),txtNode;browser.gecko?this.document.body.focus():win.focus();if(sel){sel.removeAllRanges();if(this.collapsed&&!notInsertFillData){var start=this.startContainer,child=start;if(start.nodeType==1){child=start.childNodes[this.startOffset];}if(!(start.nodeType==3&&this.startOffset)&&(child?(!child.previousSibling||child.previousSibling.nodeType!=3):(!start.lastChild||start.lastChild.nodeType!=3))){txtNode=this.document.createTextNode(fillChar);this.insertNode(txtNode);removeFillData(this.document,txtNode);mergeSibling(txtNode,"previousSibling");mergeSibling(txtNode,"nextSibling");fillData=txtNode;this.setStart(txtNode,browser.webkit?1:0).collapse(true);}}var nativeRange=this.document.createRange();if(this.collapsed&&browser.opera&&this.startContainer.nodeType==1){var child=this.startContainer.childNodes[this.startOffset];if(!child){child=this.startContainer.lastChild;if(child&&domUtils.isBr(child)){this.setStartBefore(child).collapse(true);}}else{while(child&&domUtils.isBlockElm(child)){if(child.nodeType==1&&child.childNodes[0]){child=child.childNodes[0];}else{break;}}child&&this.setStartBefore(child).collapse(true);}}checkOffset(this);nativeRange.setStart(this.startContainer,this.startOffset);nativeRange.setEnd(this.endContainer,this.endOffset);sel.addRange(nativeRange);}return this;},scrollToView:function(win,offset){win=win?window:domUtils.getWindow(this.document);var me=this,span=me.document.createElement("span");span.innerHTML="&nbsp;";me.cloneRange().insertNode(span);domUtils.scrollToView(span,win,offset);domUtils.remove(span);return me;},inFillChar:function(){var start=this.startContainer;if(this.collapsed&&start.nodeType==3&&start.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==start.nodeValue.length){return true;}return false;},createAddress:function(ignoreEnd,ignoreTxt){var addr={},me=this;function getAddress(isStart){var node=isStart?me.startContainer:me.endContainer;var parents=domUtils.findParents(node,true,function(node){return !domUtils.isBody(node);}),addrs=[];for(var i=0,ci;ci=parents[i++];){addrs.push(domUtils.getNodeIndex(ci,ignoreTxt));}var firstIndex=0;if(ignoreTxt){if(node.nodeType==3){var tmpNode=node;while(tmpNode=tmpNode.previousSibling){if(tmpNode.nodeType==3){firstIndex+=tmpNode.nodeValue.replace(fillCharReg,"").length;}else{break;}}firstIndex+=(isStart?me.startOffset:me.endOffset)-(fillCharReg.test(node.nodeValue)?1:0);}else{node=node.childNodes[isStart?me.startOffset:me.endOffset];if(node){firstIndex=domUtils.getNodeIndex(node,ignoreTxt);}else{node=isStart?me.startContainer:me.endContainer;var first=node.firstChild;while(first){if(domUtils.isFillChar(first)){first=first.nextSibling;continue;}firstIndex++;if(first.nodeType==3){while(first&&first.nodeType==3){first=first.nextSibling;}}else{first=first.nextSibling;}}}}}else{firstIndex=isStart?me.startOffset:me.endOffset;}if(firstIndex<0){firstIndex=0;}addrs.push(firstIndex);return addrs;}addr.startAddress=getAddress(true);if(!ignoreEnd){addr.endAddress=me.collapsed?[].concat(addr.startAddress):getAddress();}return addr;},moveToAddress:function(addr,ignoreEnd){var me=this;function getNode(address,isStart){var tmpNode=me.document.body,parentNode,offset;for(var i=0,ci,l=address.length;i<l;i++){ci=address[i];parentNode=tmpNode;tmpNode=tmpNode.childNodes[ci];if(!tmpNode){offset=ci;break;}}if(isStart){if(tmpNode){me.setStartBefore(tmpNode);}else{me.setStart(parentNode,offset);}}else{if(tmpNode){me.setEndBefore(tmpNode);}else{me.setEnd(parentNode,offset);}}}getNode(addr.startAddress,true);!ignoreEnd&&addr.endAddress&&getNode(addr.endAddress);return me;},equals:function(rng){for(var p in this){if(this.hasOwnProperty(p)){if(this[p]!==rng[p]){return false;}}}return true;},traversal:function(doFn,filterFn){if(this.collapsed){return this;}var bookmark=this.createBookmark(),end=bookmark.end,current=domUtils.getNextDomNode(bookmark.start,false,filterFn);while(current&&current!==end&&(domUtils.getPosition(current,end)&domUtils.POSITION_PRECEDING)){var tmpNode=domUtils.getNextDomNode(current,false,filterFn);doFn(current);current=tmpNode;}return this.moveToBookmark(bookmark);}};})();(function(){function getBoundaryInformation(range,start){var getIndex=domUtils.getNodeIndex;range=range.duplicate();range.collapse(start);var parent=range.parentElement();if(!parent.hasChildNodes()){return{container:parent,offset:0};}var siblings=parent.children,child,testRange=range.duplicate(),startIndex=0,endIndex=siblings.length-1,index=-1,distance;while(startIndex<=endIndex){index=Math.floor((startIndex+endIndex)/2);child=siblings[index];testRange.moveToElementText(child);var position=testRange.compareEndPoints("StartToStart",range);if(position>0){endIndex=index-1;}else{if(position<0){startIndex=index+1;}else{return{container:parent,offset:getIndex(child)};}}}if(index==-1){testRange.moveToElementText(parent);testRange.setEndPoint("StartToStart",range);distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length;siblings=parent.childNodes;if(!distance){child=siblings[siblings.length-1];return{container:child,offset:child.nodeValue.length};}var i=siblings.length;while(distance>0){distance-=siblings[--i].nodeValue.length;}return{container:siblings[i],offset:-distance};}testRange.collapse(position>0);testRange.setEndPoint(position>0?"StartToStart":"EndToStart",range);distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length;if(!distance){return dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName]?{container:parent,offset:getIndex(child)+(position>0?0:1)}:{container:child,offset:position>0?0:child.childNodes.length};}while(distance>0){try{var pre=child;child=child[position>0?"previousSibling":"nextSibling"];distance-=child.nodeValue.length;}catch(e){return{container:parent,offset:getIndex(pre)};}}return{container:child,offset:position>0?-distance:child.nodeValue.length+distance};}function transformIERangeToRange(ieRange,range){if(ieRange.item){range.selectNode(ieRange.item(0));}else{var bi=getBoundaryInformation(ieRange,true);range.setStart(bi.container,bi.offset);if(ieRange.compareEndPoints("StartToEnd",ieRange)!=0){bi=getBoundaryInformation(ieRange,false);range.setEnd(bi.container,bi.offset);}}return range;}function _getIERange(sel){var ieRange;try{ieRange=sel.getNative().createRange();}catch(e){return null;}var el=ieRange.item?ieRange.item(0):ieRange.parentElement();if((el.ownerDocument||el)===sel.document){return ieRange;}return null;}var Selection=dom.Selection=function(doc){var me=this,iframe;me.document=doc;if(ie){iframe=domUtils.getWindow(doc).frameElement;domUtils.on(iframe,"beforedeactivate",function(){me._bakIERange=me.getIERange();});domUtils.on(iframe,"activate",function(){try{if(!_getIERange(me)&&me._bakIERange){me._bakIERange.select();}}catch(ex){}me._bakIERange=null;});}iframe=doc=null;};Selection.prototype={getNative:function(){var doc=this.document;try{return !doc?null:ie?doc.selection:domUtils.getWindow(doc).getSelection();}catch(e){return null;}},getIERange:function(){var ieRange=_getIERange(this);if(!ieRange){if(this._bakIERange){return this._bakIERange;}}return ieRange;},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath();},getStartElementPath:function(){if(this._cachedStartElementPath){return this._cachedStartElementPath;}var start=this.getStart();if(start){return domUtils.findParents(start,true,null,true);}return[];},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null;},isFocus:function(){try{return browser.ie&&_getIERange(this)||!browser.ie&&this.getNative().rangeCount?true:false;}catch(e){return false;}},getRange:function(){var me=this;function optimze(range){var child=me.document.body.firstChild,collapsed=range.collapsed;while(child&&child.firstChild){range.setStart(child,0);child=child.firstChild;}if(!range.startContainer){range.setStart(me.document.body,0);}if(collapsed){range.collapse(true);}}if(me._cachedRange!=null){return this._cachedRange;}var range=new baidu.editor.dom.Range(me.document);if(ie){var nativeRange=me.getIERange();if(nativeRange){try{transformIERangeToRange(nativeRange,range);}catch(e){optimze(range);}}else{optimze(range);}}else{var sel=me.getNative();if(sel&&sel.rangeCount){var firstRange=sel.getRangeAt(0);var lastRange=sel.getRangeAt(sel.rangeCount-1);range.setStart(firstRange.startContainer,firstRange.startOffset).setEnd(lastRange.endContainer,lastRange.endOffset);if(range.collapsed&&domUtils.isBody(range.startContainer)&&!range.startOffset){optimze(range);}}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document)){return this._bakRange;}optimze(range);}}return this._bakRange=range;},getStart:function(){if(this._cachedStartElement){return this._cachedStartElement;}var range=ie?this.getIERange():this.getRange(),tmpRange,start,tmp,parent;if(ie){if(!range){return this.document.body.firstChild;}if(range.item){return range.item(0);}tmpRange=range.duplicate();tmpRange.text.length>0&&tmpRange.moveStart("character",1);tmpRange.collapse(1);start=tmpRange.parentElement();parent=tmp=range.parentElement();while(tmp=tmp.parentNode){if(tmp==start){start=parent;break;}}}else{range.shrinkBoundary();start=range.startContainer;if(start.nodeType==1&&start.hasChildNodes()){start=start.childNodes[Math.min(start.childNodes.length-1,range.startOffset)];}if(start.nodeType==3){return start.parentNode;}}return start;},getText:function(){var nativeSel,nativeRange;if(this.isFocus()&&(nativeSel=this.getNative())){nativeRange=browser.ie?nativeSel.createRange():nativeSel.getRangeAt(0);return browser.ie?nativeRange.text:nativeRange.toString();}return"";},clearRange:function(){this.getNative()[browser.ie?"empty":"removeAllRanges"]();}};})();(function(){var uid=0,_selectionChangeTimer;function replaceSrc(root){utils.each(domUtils.getElementsByTagName(root,"a img"),function(node){var val,attr=node.tagName=="A"?"href":"src";if(val=node.getAttribute("_"+attr)){node.setAttribute(attr,val);}});}function setValue(form,editor){var textarea;if(editor.textarea){if(utils.isString(editor.textarea)){for(var i=0,ti,tis=domUtils.getElementsByTagName(form,"textarea");ti=tis[i++];){if(ti.id=="ueditor_textarea_"+editor.options.textarea){textarea=ti;break;}}}else{textarea=editor.textarea;}}if(!textarea){form.appendChild(textarea=domUtils.createElement(document,"textarea",{"name":editor.options.textarea,"id":"ueditor_textarea_"+editor.options.textarea,"style":"display:none"}));editor.textarea=textarea;}textarea.value=editor.hasContents()?(editor.options.allHtmlEnabled?editor.getAllHtml():editor.getContent(null,null,true)):"";}var Editor=UE.Editor=function(options){var me=this;me.uid=uid++;EventBase.call(me);me.commands={};me.options=utils.extend(utils.clone(options||{}),UEDITOR_CONFIG,true);me.shortcutkeys={};me.inputRules=[];me.outputRules=[];me.setOpt({isShow:true,initialContent:"",autoClearinitialContent:false,iframeCssUrl:me.options.UEDITOR_HOME_URL+"themes/iframe.css",textarea:"editorValue",focus:false,focusInEnd:true,autoClearEmptyNode:true,fullscreen:false,readonly:false,zIndex:999,imagePopup:true,enterTag:"p",customDomain:false,lang:"zh-cn",langPath:me.options.UEDITOR_HOME_URL+"lang/",theme:"default",themePath:me.options.UEDITOR_HOME_URL+"themes/",allHtmlEnabled:false,scaleEnabled:false,tableNativeEditInFF:false,autoSyncData:true});utils.loadFile(document,{src:me.options.langPath+me.options.lang+"/"+me.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){for(var pi in UE.plugins){UE.plugins[pi].call(me);}me.langIsReady=true;me.fireEvent("langReady");});UE.instants["ueditorInstant"+me.uid]=me;};Editor.prototype={ready:function(fn){var me=this;if(fn){me.isReady?fn.apply(me):me.addListener("ready",fn);}},setOpt:function(key,val){var obj={};if(utils.isString(key)){obj[key]=val;}else{obj=key;}utils.extend(this.options,obj,true);},destroy:function(){var me=this;me.fireEvent("destroy");var container=me.container.parentNode;var textarea=me.textarea;if(!textarea){textarea=document.createElement("textarea");container.parentNode.insertBefore(textarea,container);}else{textarea.style.display="";}textarea.style.width=container.offsetWidth+"px";textarea.style.height=container.offsetHeight+"px";textarea.value=me.getContent();textarea.id=me.key;container.innerHTML="";domUtils.remove(container);var key=me.key;for(var p in me){if(me.hasOwnProperty(p)){delete this[p];}}UE.delEditor(key);},render:function(container,holder){var me=this,options=me.options;if(utils.isString(container)){container=document.getElementById(container);}if(container){var useBodyAsViewport=ie&&browser.version<9,html=(ie&&browser.version<9?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml'"+(!useBodyAsViewport?" class='view'":"")+"><head>"+(options.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(options.iframeCssUrl)+"'/>":"")+"<style type='text/css'>"+".view{word-wrap:break-word;cursor:text;height:100%;}\n"+"body{margin:8px;font-family:sans-serif;font-size:16px;}"+"p{margin:0;}"+(options.initialStyle||"")+"</style></head><body"+(useBodyAsViewport?" class='view'":"")+"></body>";if(options.customDomain&&document.domain!=location.hostname){html+="<script>window.parent.UE.instants['ueditorInstant"+me.uid+"']._setup(document);<\/script></html>";container.appendChild(domUtils.createElement(document,"iframe",{id:"ueditor_"+me.uid,width:"100%",height:"100%",frameborder:"0",src:'javascript:void(function(){document.open();document.domain="'+document.domain+'";'+'document.write("'+html+'");document.close();}())'}));}else{if(options.initialFrameWidth){options.minFrameWidth=options.initialFrameWidth;}else{options.minFrameWidth=options.initialFrameWidth=container.offsetWidth;}if(options.initialFrameHeight){options.minFrameHeight=options.initialFrameHeight;}else{options.initialFrameHeight=options.minFrameHeight=container.offsetHeight;}container.style.width=options.initialFrameWidth+"px";container.style.height=options.initialFrameHeight+"px";container.style.zIndex=options.zIndex;container.innerHTML='<iframe id="'+"ueditor_"+this.uid+'"'+'width="100%" height="100%" scroll="no" frameborder="0" ></iframe>';var doc=container.firstChild.contentWindow.document;doc.open();doc.write(html+"</html>");doc.close();me._setup(doc);}container.style.overflow="hidden";}},_setup:function(doc){var me=this,options=me.options;if(ie){doc.body.disabled=true;doc.body.contentEditable=true;doc.body.disabled=false;}else{doc.body.contentEditable=true;doc.body.spellcheck=false;}me.document=doc;me.window=doc.defaultView||doc.parentWindow;me.iframe=me.window.frameElement;me.body=doc.body;me.setHeight(Math.max(options.minFrameHeight,options.initialFrameHeight));me.selection=new dom.Selection(doc);var geckoSel;if(browser.gecko&&(geckoSel=this.selection.getNative())){geckoSel.removeAllRanges();}this._initEvents();if(options.initialContent){if(options.autoClearinitialContent){var oldExecCommand=me.execCommand;me.execCommand=function(){me.fireEvent("firstBeforeExecCommand");return oldExecCommand.apply(me,arguments);};this._setDefaultContent(options.initialContent);}else{this.setContent(options.initialContent,false,true);}}for(var form=this.iframe.parentNode;!domUtils.isBody(form);form=form.parentNode){if(form.tagName=="FORM"){if(me.options.autoSyncData){domUtils.on(me.window,"blur",function(){setValue(form,me);});}else{domUtils.on(form,"submit",function(){setValue(this,me);});}break;}}if(domUtils.isEmptyNode(me.body)){me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";}if(options.focus){setTimeout(function(){me.focus(me.options.focusInEnd);!me.options.autoClearinitialContent&&me._selectionChange();},0);}if(!me.container){me.container=this.iframe.parentNode;}if(options.fullscreen&&me.ui){me.ui.setFullScreen(true);}try{me.document.execCommand("2D-position",false,false);}catch(e){}try{me.document.execCommand("enableInlineTableEditing",false,false);}catch(e){}try{me.document.execCommand("enableObjectResizing",false,false);}catch(e){}me._bindshortcutKeys();me.isReady=1;me.fireEvent("ready");options.onready&&options.onready.call(me);if(!browser.ie){domUtils.on(me.window,["blur","focus"],function(e){if(e.type=="blur"){me._bakRange=me.selection.getRange();try{me.selection.getNative().removeAllRanges();}catch(e){}}else{try{me._bakRange&&me._bakRange.select();}catch(e){}}});}if(browser.gecko&&browser.version<=10902){me.body.contentEditable=false;setTimeout(function(){me.body.contentEditable=true;},100);setInterval(function(){me.body.style.height=me.iframe.offsetHeight-20+"px";},100);}!options.isShow&&me.setHide();options.readonly&&me.setDisabled();},sync:function(formId){var me=this,form=formId?document.getElementById(formId):domUtils.findParent(me.iframe.parentNode,function(node){return node.tagName=="FORM";},true);form&&setValue(form,me);},setHeight:function(height){if(height!==parseInt(this.iframe.parentNode.style.height)){this.iframe.parentNode.style.height=height+"px";}this.document.body.style.height=height-20+"px";},addshortcutkey:function(cmd,keys){var obj={};if(keys){obj[cmd]=keys;}else{obj=cmd;}utils.extend(this.shortcutkeys,obj);},_bindshortcutKeys:function(){var me=this,shortcutkeys=this.shortcutkeys;me.addListener("keydown",function(type,e){var keyCode=e.keyCode||e.which;for(var i in shortcutkeys){var tmp=shortcutkeys[i].split(",");for(var t=0,ti;ti=tmp[t++];){ti=ti.split(":");var key=ti[0],param=ti[1];if(/^(ctrl)(\+shift)?\+(\d+)$/.test(key.toLowerCase())||/^(\d+)$/.test(key)){if(((RegExp.$1=="ctrl"?(e.ctrlKey||e.metaKey):0)&&(RegExp.$2!=""?e[RegExp.$2.slice(1)+"Key"]:1)&&keyCode==RegExp.$3)||keyCode==RegExp.$1){me.execCommand(i,param);domUtils.preventDefault(e);}}}}});},getContent:function(cmd,fn,notSetCursor){var me=this;if(cmd&&utils.isFunction(cmd)){fn=cmd;cmd="";}if(fn?!fn():!this.hasContents()){return"";}me.fireEvent("beforegetcontent");var root=UE.htmlparser(me.body.innerHTML);me.filterOutputRule(root);me.fireEvent("aftergetcontent",cmd);return root.toHtml().replace(/'/g,"&#39;");},getAllHtml:function(){var me=this,headHtml=[],html="";me.fireEvent("getAllHtml",headHtml);if(browser.ie&&browser.version>8){var headHtmlForIE9="";utils.each(me.document.styleSheets,function(si){headHtmlForIE9+=(si.href?'<link rel="stylesheet" type="text/css" href="'+si.href+'" />':"<style>"+si.cssText+"</style>");});utils.each(me.document.getElementsByTagName("script"),function(si){headHtmlForIE9+=si.outerHTML;});}return"<html><head>"+(me.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+me.options.charset+'"/>':"")+(headHtmlForIE9||me.document.getElementsByTagName("head")[0].innerHTML)+headHtml.join("\n")+"</head>"+"<body "+(ie&&browser.version<9?'class="view"':"")+">"+me.getContent(null,null,true)+"</body></html>";},getPlainTxt:function(){var reg=new RegExp(domUtils.fillChar,"g"),html=this.body.innerHTML.replace(/[\n\r]/g,"");html=html.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(a,b,c){return dtd.$block[c]?"\n":b?b:"";});return html.replace(reg,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ");},getContentTxt:function(){var reg=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(reg,"").replace(/\u00a0/g," ");},setContent:function(html,isAppendTo,notFireSelectionchange){var me=this;me.fireEvent("beforesetcontent",html);var root=UE.htmlparser(html);me.filterInputRule(root);html=root.toHtml();me.body.innerHTML=(isAppendTo?me.body.innerHTML:"")+html;if(browser.ie&&browser.version<7){replaceSrc(me.body);}if(me.options.enterTag=="p"){var child=this.body.firstChild,tmpNode;if(!child||child.nodeType==1&&(dtd.$cdata[child.tagName]||domUtils.isCustomeNode(child))&&child===this.body.lastChild){this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;}else{var p=me.document.createElement("p");while(child){while(child&&(child.nodeType==3||child.nodeType==1&&dtd.p[child.tagName]&&!dtd.$cdata[child.tagName])){tmpNode=child.nextSibling;p.appendChild(child);child=tmpNode;}if(p.firstChild){if(!child){me.body.appendChild(p);break;}else{child.parentNode.insertBefore(p,child);p=me.document.createElement("p");}}child=child.nextSibling;}}}me.fireEvent("aftersetcontent");me.fireEvent("contentchange");!notFireSelectionchange&&me._selectionChange();me._bakRange=me._bakIERange=null;var geckoSel;if(browser.gecko&&(geckoSel=this.selection.getNative())){geckoSel.removeAllRanges();}},expSubmit:function(){var me=this,hlist=domUtils.getElementsByTagName(me.document,"h2"),state="",flag=true,uiutils=baidu.editor.ui.uiUtils;for(var i=0,node;node=hlist[i++];){var txt=node.innerHTML.replace(domUtils.fillChar,"");if(domUtils.isEmptyNode(node)){state="标题为空";}if(txt.replace(/[^\x00-\xff]/g,"ci").length>40){state="标题要小于40个字符";}if(state){var top=(document.body.scrollTop||document.documentElement.scrollTop)+uiutils.getClientRect(node).top-60;window.scrollTo(0,top);window.edSimShowStepPop(uiutils.getClientRect(node).top,state);if(!node.firstChild){node.innerHTML=domUtils.fillChar;}me.selection.getRange().selectNode(node.firstChild).setCursor(true);flag=false;break;}}return flag;},focus:function(toEnd){try{var me=this,rng=me.selection.getRange();if(toEnd){rng.setStartAtLast(me.body.lastChild).setCursor(false,true);}else{rng.select(true);}}catch(e){}},_initEvents:function(){var me=this,doc=me.document,win=me.window;me._proxyDomEvent=utils.bind(me._proxyDomEvent,me);domUtils.on(doc,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],me._proxyDomEvent);domUtils.on(win,["focus","blur"],me._proxyDomEvent);domUtils.on(doc,["mouseup","keydown"],function(evt){if(evt.type=="keydown"&&(evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)){return;}if(evt.button==2){return;}me._selectionChange(250,evt);});var innerDrag=0,source=browser.ie?me.body:me.document,dragoverHandler;domUtils.on(source,"dragstart",function(){innerDrag=1;});domUtils.on(source,browser.webkit?"dragover":"drop",function(){return browser.webkit?function(){clearTimeout(dragoverHandler);dragoverHandler=setTimeout(function(){if(!innerDrag){var sel=me.selection,range=sel.getRange();if(range){var common=range.getCommonAncestor();if(common&&me.serialize){var f=me.serialize,node=f.filter(f.transformInput(f.parseHTML(f.word(common.innerHTML))));common.innerHTML=f.toHTML(node);}}}innerDrag=0;},200);}:function(e){if(!innerDrag){e.preventDefault?e.preventDefault():(e.returnValue=false);}innerDrag=0;};}());},_proxyDomEvent:function(evt){return this.fireEvent(evt.type.replace(/^on/,""),evt);},_selectionChange:function(delay,evt){var me=this;var hackForMouseUp=false;var mouseX,mouseY;if(browser.ie&&browser.version<9&&evt&&evt.type=="mouseup"){var range=this.selection.getRange();if(!range.collapsed){hackForMouseUp=true;mouseX=evt.clientX;mouseY=evt.clientY;}}clearTimeout(_selectionChangeTimer);_selectionChangeTimer=setTimeout(function(){if(!me.selection.getNative()){return;}var ieRange;if(hackForMouseUp&&me.selection.getNative().type=="None"){ieRange=me.document.body.createTextRange();try{ieRange.moveToPoint(mouseX,mouseY);}catch(ex){ieRange=null;}}var bakGetIERange;if(ieRange){bakGetIERange=me.selection.getIERange;me.selection.getIERange=function(){return ieRange;};}me.selection.cache();if(bakGetIERange){me.selection.getIERange=bakGetIERange;}if(me.selection._cachedRange&&me.selection._cachedStartElement){me.fireEvent("beforeselectionchange");me.fireEvent("selectionchange",!!evt);me.fireEvent("afterselectionchange");me.selection.clear();}},delay||50);},_callCmdFn:function(fnName,args){var cmdName=args[0].toLowerCase(),cmd,cmdFn;cmd=this.commands[cmdName]||UE.commands[cmdName];cmdFn=cmd&&cmd[fnName];if((!cmd||!cmdFn)&&fnName=="queryCommandState"){return 0;}else{if(cmdFn){return cmdFn.apply(this,args);}}},execCommand:function(cmdName){cmdName=cmdName.toLowerCase();var me=this,result,cmd=me.commands[cmdName]||UE.commands[cmdName];if(!cmd||!cmd.execCommand){return null;}if(!cmd.notNeedUndo&&!me.__hasEnterExecCommand){me.__hasEnterExecCommand=true;if(me.queryCommandState.apply(me,arguments)!=-1){me.fireEvent("beforeexeccommand",cmdName);result=this._callCmdFn("execCommand",arguments);!me._ignoreContentChange&&me.fireEvent("contentchange");me.fireEvent("afterexeccommand",cmdName);}me.__hasEnterExecCommand=false;}else{result=this._callCmdFn("execCommand",arguments);!me._ignoreContentChange&&me.fireEvent("contentchange");}!me._ignoreContentChange&&me._selectionChange();return result;},queryCommandState:function(cmdName){return this._callCmdFn("queryCommandState",arguments);},queryCommandValue:function(cmdName){return this._callCmdFn("queryCommandValue",arguments);},hasContents:function(tags){if(tags){for(var i=0,ci;ci=tags[i++];){if(this.document.getElementsByTagName(ci).length>0){return true;}}}if(!domUtils.isEmptyBlock(this.body)){return true;}tags=["div"];for(i=0;ci=tags[i++];){var nodes=domUtils.getElementsByTagName(this.document,ci);for(var n=0,cn;cn=nodes[n++];){if(domUtils.isCustomeNode(cn)){return true;}}}return false;},reset:function(){this.fireEvent("reset");},setEnabled:function(){var me=this,range;if(me.body.contentEditable=="false"){me.body.contentEditable=true;range=me.selection.getRange();try{range.moveToBookmark(me.lastBk);delete me.lastBk;}catch(e){range.setStartAtFirst(me.body).collapse(true);}range.select(true);if(me.bkqueryCommandState){me.queryCommandState=me.bkqueryCommandState;delete me.bkqueryCommandState;}me.fireEvent("selectionchange");}},enable:function(){return this.setEnabled();},setDisabled:function(except){var me=this;except=except?utils.isArray(except)?except:[except]:[];if(me.body.contentEditable=="true"){if(!me.lastBk){me.lastBk=me.selection.getRange().createBookmark(true);}me.body.contentEditable=false;me.bkqueryCommandState=me.queryCommandState;me.queryCommandState=function(type){if(utils.indexOf(except,type)!=-1){return me.bkqueryCommandState.apply(me,arguments);}return -1;};me.fireEvent("selectionchange");}},disable:function(except){return this.setDisabled(except);},_setDefaultContent:function(){function clear(){var me=this;if(me.document.getElementById("initContent")){me.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>";me.removeListener("firstBeforeExecCommand focus",clear);setTimeout(function(){me.focus();me._selectionChange();},0);}}return function(cont){var me=this;me.body.innerHTML='<p id="initContent">'+cont+"</p>";if(browser.ie&&browser.version<7){replaceSrc(me.body);}me.addListener("firstBeforeExecCommand focus",clear);};}(),setShow:function(){var me=this,range=me.selection.getRange();if(me.container.style.display=="none"){try{range.moveToBookmark(me.lastBk);delete me.lastBk;}catch(e){range.setStartAtFirst(me.body).collapse(true);}setTimeout(function(){range.select(true);},100);me.container.style.display="";}},show:function(){return this.setShow();},setHide:function(){var me=this;if(!me.lastBk){me.lastBk=me.selection.getRange().createBookmark(true);}me.container.style.display="none";},hide:function(){return this.setHide();},getLang:function(path){var lang=UE.I18N[this.options.lang];if(!lang){throw Error("not import language file");}path=(path||"").split(".");for(var i=0,ci;ci=path[i++];){lang=lang[ci];if(!lang){break;}}return lang;},getContentLength:function(ingoneHtml,tagNames){var count=this.getContent(false,false,true).length;if(ingoneHtml){tagNames=(tagNames||[]).concat(["hr","img","iframe"]);count=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var i=0,ci;ci=tagNames[i++];){count+=this.document.getElementsByTagName(ci).length;}}return count;},addInputRule:function(rule){this.inputRules.push(rule);},filterInputRule:function(root){for(var i=0,ci;ci=this.inputRules[i++];){ci.call(this,root);}},addOutputRule:function(rule){this.outputRules.push(rule);},filterOutputRule:function(root){for(var i=0,ci;ci=this.outputRules[i++];){ci.call(this,root);}}};utils.inherits(Editor,EventBase);})();UE.ajax=function(){var fnStr="XMLHttpRequest()";try{new ActiveXObject("Msxml2.XMLHTTP");fnStr="ActiveXObject('Msxml2.XMLHTTP')";}catch(e){try{new ActiveXObject("Microsoft.XMLHTTP");fnStr="ActiveXObject('Microsoft.XMLHTTP')";}catch(e){}}var creatAjaxRequest=new Function("return new "+fnStr);function json2str(json){var strArr=[];for(var i in json){if(i=="method"||i=="timeout"||i=="async"){continue;}if(!((typeof json[i]).toLowerCase()=="function"||(typeof json[i]).toLowerCase()=="object")){strArr.push(encodeURIComponent(i)+"="+encodeURIComponent(json[i]));}}return strArr.join("&");}return{request:function(url,ajaxOptions){var ajaxRequest=creatAjaxRequest(),timeIsOut=false,defaultAjaxOptions={method:"POST",timeout:5000,async:true,data:{},onsuccess:function(){},onerror:function(){}};if(typeof url==="object"){ajaxOptions=url;url=ajaxOptions.url;}if(!ajaxRequest||!url){return;}var ajaxOpts=ajaxOptions?utils.extend(defaultAjaxOptions,ajaxOptions):defaultAjaxOptions;var submitStr=json2str(ajaxOpts);if(!utils.isEmptyObject(ajaxOpts.data)){submitStr+=(submitStr?"&":"")+json2str(ajaxOpts.data);}var timerID=setTimeout(function(){if(ajaxRequest.readyState!=4){timeIsOut=true;ajaxRequest.abort();clearTimeout(timerID);}},ajaxOpts.timeout);var method=ajaxOpts.method.toUpperCase();var str=url+(url.indexOf("?")==-1?"?":"&")+(method=="POST"?"":submitStr+"&noCache="+ +new Date);ajaxRequest.open(method,str,ajaxOpts.async);ajaxRequest.onreadystatechange=function(){if(ajaxRequest.readyState==4){if(!timeIsOut&&ajaxRequest.status==200){ajaxOpts.onsuccess(ajaxRequest);}else{ajaxOpts.onerror(ajaxRequest);}}};if(method=="POST"){ajaxRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded");ajaxRequest.send(submitStr);}else{ajaxRequest.send(null);}}};}();var filterWord=UE.filterWord=function(){function isWordDocument(str){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<v:)/ig.test(str);}function transUnit(v){v=v.replace(/[\d.]+\w+/g,function(m){return utils.transUnitToPx(m);});return v;}function filterPasteWord(str){return str.replace(/[\t\r\n]+/g,"").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(str){if(browser.opera){return"";}try{var width=str.match(/width:([ \d.]*p[tx])/i)[1],height=str.match(/height:([ \d.]*p[tx])/i)[1],src=str.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+transUnit(width)+'" height="'+transUnit(height)+'" src="'+src+'" />';}catch(e){return"";}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(str,name,marks,val){return name=="class"&&val=="MsoListParagraph"?str:"";}).replace(/<(font|span)[^>]*>\s*<\/\1>/gi,"").replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(str,tag,tmp,style){var n=[],s=style.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g);for(var i=0,v;v=s[i];i++){var name,value,parts=v.split(":");if(parts.length==2){name=parts[0].toLowerCase();value=parts[1].toLowerCase();if(/^(background)\w*/.test(name)&&value.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(name)&&/^0\w+$/.test(value)){continue;}switch(name){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":if(!/<table/.test(tag)){n[i]=name.replace(/^mso-|-alt$/g,"")+":"+transUnit(value);}continue;case"horiz-align":n[i]="text-align:"+value;continue;case"vert-align":n[i]="vertical-align:"+value;continue;case"font-color":case"mso-foreground":n[i]="color:"+value;continue;case"mso-background":case"mso-highlight":n[i]="background:"+value;continue;case"mso-default-height":n[i]="min-height:"+transUnit(value);continue;case"mso-default-width":n[i]="min-width:"+transUnit(value);continue;case"mso-padding-between-alt":n[i]="border-collapse:separate;border-spacing:"+transUnit(value);continue;case"text-line-through":if((value=="single")||(value=="double")){n[i]="text-decoration:line-through";}continue;case"mso-zero-height":if(value=="yes"){n[i]="display:none";}continue;case"background":if(value=="initial"){}break;case"margin":if(!/[1-9]/.test(value)){continue;}}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(name)||/text\-indent|padding|margin/.test(name)&&/\-[\d.]+/.test(value)){continue;}n[i]=name+":"+parts[1];}}return tag+(n.length?' style="'+n.join(";").replace(/;{2,}/g,";")+'"':"");}).replace(/[\d.]+(cm|pt)/g,function(str){return utils.transUnitToPx(str);});}return function(html){return(isWordDocument(html)?filterPasteWord(html):html).replace(/>[ \t\r\n]*</g,"><");};}();(function(){var uNode=UE.uNode=function(obj){this.type=obj.type;this.data=obj.data;this.tagName=obj.tagName;this.parentNode=obj.parentNode;this.attrs=obj.attrs||{};this.children=obj.children;};var indentChar="    ",breakChar="\n";function insertLine(arr,current,begin){arr.push(breakChar);return current+(begin?1:-1);}function insertIndent(arr,current){for(var i=0;i<current;i++){arr.push(indentChar);}}uNode.createElement=function(html){if(/[<>]/.test(html)){return UE.htmlparser(html).children[0];}else{return new uNode({type:"element",children:[],tagName:html});}};uNode.createText=function(data){return new UE.uNode({type:"text","data":data||""});};function nodeToHtml(node,arr,formatter,current){switch(node.type){case"root":for(var i=0,ci;ci=node.children[i++];){if(formatter&&ci.type=="element"&&!dtd.$inline[ci.tagName]&&i>1){insertLine(arr,current,true);insertIndent(arr,current);}nodeToHtml(ci,arr,formatter,current);}break;case"text":isText(node,arr);break;case"element":isElement(node,arr,formatter,current);break;case"comment":isComment(node,arr,formatter);}return arr;}function isText(node,arr){arr.push(node.data);}function isElement(node,arr,formatter,current){var attrhtml="";if(node.attrs){attrhtml=[];var attrs=node.attrs;for(var a in attrs){attrhtml.push(a+(attrs[a]!==undefined?'="'+utils.unhtml(attrs[a])+'"':""));}attrhtml=attrhtml.join(" ");}arr.push("<"+node.tagName+(attrhtml?" "+attrhtml+" ":"")+(dtd.$empty[node.tagName]?"/":"")+">");if(formatter&&!dtd.$inline[node.tagName]){current=insertLine(arr,current,true);insertIndent(arr,current);}if(node.children&&node.children.length){for(var i=0,ci;ci=node.children[i++];){if(formatter&&ci.type=="element"&&!dtd.$inline[ci.tagName]&&i>1){insertLine(arr,current);insertIndent(arr,current);}nodeToHtml(ci,arr,formatter,current);}}if(!dtd.$empty[node.tagName]){if(formatter&&!dtd.$inline[node.tagName]){current=insertLine(arr,current);insertIndent(arr,current);}arr.push("</"+node.tagName+">");}}function isComment(node,arr){arr.push("<!--"+node.data+"-->");}function getNodeById(root,id){var node;if(root.type=="element"&&root.getAttr("id")==id){return root;}if(root.children&&root.children.length){for(var i=0,ci;ci=root.children[i++];){if(node=getNodeById(ci,id)){return node;}}}}function getNodesByTagName(node,tagName,arr){if(node.type=="element"&&node.tagName==tagName){arr.push(node);}if(node.children&&node.children.length){for(var i=0,ci;ci=node.children[i++];){getNodesByTagName(ci,tagName,arr);}}}function nodeTraversal(root,fn){if(root.children&&root.children.length){for(var i=0,ci;ci=root.children[i];){nodeTraversal(ci,fn);if(ci.parentNode){if(ci.children){fn(ci);}if(ci.parentNode){i++;}}}}else{fn(root);}}uNode.prototype={toHtml:function(formatter){var arr=[];nodeToHtml(this,arr,formatter,0);return arr.join("");},innerHTML:function(htmlstr){if(this.type!="element"||dtd.$empty[this.tagName]){return this;}if(htmlstr){if(this.children){for(var i=0,ci;ci=this.children[i++];){ci.parentNode=null;}}this.children=[];var tmpRoot=UE.htmlparser(htmlstr);for(var i=0,ci;ci=tmpRoot.children[i++];){this.children.push(ci);ci.parentNode=this;}return this;}else{var tmpRoot=new UE.uNode({type:"root",children:this.children});return tmpRoot.toHtml();}},innerText:function(textStr){if(this.type!="element"||dtd.$empty[this.tagName]){return this;}if(textStr){if(this.children){for(var i=0,ci;ci=this.children[i++];){ci.parentNode=null;}}this.children=[];this.appendChild(uNode.createText(textStr));return this;}else{return this.toHtml().replace(/<[^>]+>/g,"");}},getData:function(){if(this.type=="element"){return"";}return this.data;},firstChild:function(){return this.children?this.children[0]:null;},lastChild:function(){return this.children?this.children[this.children.length-1]:null;},previousSibling:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i];i++){if(ci===this){return i==0?null:parent.children[i-1];}}},nextSibling:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i++];){if(ci===this){return parent.children[i];}}},replaceChild:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target);}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i,1,target);source.parentNode=null;target.parentNode=this;return target;}}}},appendChild:function(node){if(this.type=="root"||(this.type=="element"&&!dtd.$empty[this.tagName])){if(!this.children){this.children=[];}if(node.parentNode){node.parentNode.removeChild(node);}for(var i=0,ci;ci=this.children[i];i++){if(ci===node){this.children.splice(i,1);break;}}this.children.push(node);node.parentNode=this;return node;}},insertBefore:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target);}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i,0,target);target.parentNode=this;return target;}}}},insertAfter:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target);}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i+1,0,target);target.parentNode=this;return target;}}}},removeChild:function(node,keepChildren){if(this.children){for(var i=0,ci;ci=this.children[i];i++){if(ci===node){this.children.splice(i,1);ci.parentNode=null;if(keepChildren&&ci.children&&ci.children.length){for(var j=0,cj;cj=ci.children[j];j++){this.children.splice(i+j,0,cj);cj.parentNode=this;}}return ci;}}}},getAttr:function(attrName){return this.attrs&&this.attrs[attrName.toLowerCase()];},setAttr:function(attrName,attrVal){if(!attrName){delete this.attrs;return;}if(!this.attrs){this.attrs={};}if(utils.isObject(attrName)){for(var a in attrName){if(!attrName[a]){delete this.attrs[a];}else{this.attrs[a.toLowerCase()]=attrName[a];}}}else{if(!attrVal){delete this.attrs[attrName];}else{this.attrs[attrName.toLowerCase()]=attrVal;}}},getIndex:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i];i++){if(ci===this){return i;}}return -1;},getNodeById:function(id){var node;if(this.children&&this.children.length){for(var i=0,ci;ci=this.children[i++];){if(node=getNodeById(ci,id)){return node;}}}},getNodesByTagName:function(tagNames){tagNames=utils.trim(tagNames).replace(/[ ]{2,}/g," ").split(" ");var arr=[],me=this;utils.each(tagNames,function(tagName){if(me.children&&me.children.length){for(var i=0,ci;ci=me.children[i++];){getNodesByTagName(ci,tagName,arr);}}});return arr;},getStyle:function(name){var cssStyle=this.getAttr("style");if(!cssStyle){return"";}var reg=new RegExp(name+":([^;]+)");var match=cssStyle.match(reg);if(match&&match[0]){return match[1];}return"";},setStyle:function(name,val){function exec(name,val){var reg=new RegExp(name+":([^;]+);?","gi");cssStyle=cssStyle.replace(reg,"");if(val){cssStyle=name+":"+utils.unhtml(val)+";"+cssStyle;}}var cssStyle=this.getAttr("style");if(!cssStyle){cssStyle="";}if(utils.isObject(name)){for(var a in name){exec(a,name[a]);}}else{exec(name,val);}this.setAttr("style",cssStyle);},traversal:function(fn){if(this.children&&this.children.length){nodeTraversal(this,fn);}return this;}};})();var htmlparser=UE.htmlparser=function(htmlstr,coverBlank){var reg=new RegExp(domUtils.fillChar,"g");htmlstr=htmlstr.replace(reg,"").replace(/(?:^[ \t\r\n]*?<)/,"<").replace(/(?:>[ \t\r\n]*?$)/,">");!coverBlank&&(htmlstr=htmlstr.replace(/>(?:[ \t\r\n]*)/g,">").replace(/(?:[ \t\r\n]*)</g,"<"));var re_tag=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,re_attr=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g;var uNode=UE.uNode,needParentNode={"td":"tr","tr":["tbody","thead","tfoot"],"tbody":"table","th":"tr","thead":"table","tfoot":"table","caption":"table","li":["ul","ol"],"dt":"dl","dd":"dl","option":"select"},needChild={"ol":"li","ul":"li"};function text(parent,data){if(needChild[parent.tagName]){var tmpNode=uNode.createElement(needChild[parent.tagName]);parent.appendChild(tmpNode);tmpNode.appendChild(uNode.createText(data));parent=tmpNode;}else{parent.appendChild(uNode.createText(data));}}function element(parent,tagName,htmlattr){var needParentTag;if(needParentTag=needParentNode[tagName]){var tmpParent=parent,hasParent;while(tmpParent.type!="root"){if(utils.isArray(needParentTag)?utils.indexOf(needParentTag,tmpParent.tagName)!=-1:needParentTag==tmpParent.tagName){parent=tmpParent;hasParent=true;break;}tmpParent=tmpParent.parentNode;}if(!hasParent){parent=element(parent,utils.isArray(needParentTag)?needParentTag[0]:needParentTag);}}var elm=new uNode({parentNode:parent,type:"element",tagName:tagName.toLowerCase(),children:dtd.$empty[tagName]?null:[]});if(htmlattr){var attrs={},match;while(match=re_attr.exec(htmlattr)){attrs[match[1].toLowerCase()]=match[2]||match[3]||match[4];}elm.attrs=attrs;}parent.children.push(elm);return dtd.$empty[tagName]?parent:elm;}function comment(parent,data){parent.children.push(new uNode({type:"comment",data:data,parentNode:parent}));}var match,currentIndex=0,nextIndex=0;var root=new uNode({type:"root",children:[]});var currentParent=root;while(match=re_tag.exec(htmlstr)){currentIndex=match.index;try{if(currentIndex>nextIndex){text(currentParent,htmlstr.slice(nextIndex,currentIndex));}if(match[3]){currentParent=element(currentParent,match[3].toLowerCase(),match[4]);}else{if(match[1]){if(currentParent.type!="root"){var tmpParent=currentParent;while(currentParent.type=="element"&&currentParent.tagName!=match[1].toLowerCase()){currentParent=currentParent.parentNode;if(currentParent.type=="root"){currentParent=tmpParent;throw"break";}}currentParent=currentParent.parentNode;}}else{if(match[2]){comment(currentParent,match[2]);}}}}catch(e){}nextIndex=re_tag.lastIndex;}if(nextIndex<htmlstr.length){text(currentParent,htmlstr.slice(nextIndex));}return root;};var filterNode=UE.filterNode=function(){function filterNode(node,rules){switch(node.type){case"text":break;case"element":var val;if(val=rules[node.tagName]){if(val==="-"){node.parentNode.removeChild(node);}else{if(utils.isFunction(val)){var parentNode=node.parentNode,index=node.getIndex();val(node);if(node.parentNode){if(node.children){for(var i=0,ci;ci=node.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}}}else{for(var i=index,ci;ci=parentNode.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}}}else{var attrs=val["$"];if(attrs&&node.attrs){var tmpAttrs={},tmpVal;for(var a in attrs){tmpVal=node.getAttr(a);if(a=="style"&&utils.isArray(attrs[a])){var tmpCssStyle=[];utils.each(attrs[a],function(v){var tmp;if(tmp=node.getStyle(v)){tmpCssStyle.push(v+":"+tmp);}});tmpVal=tmpCssStyle.join(";");}if(tmpVal){tmpAttrs[a]=tmpVal;}}node.attrs=tmpAttrs;}if(node.children){for(var i=0,ci;ci=node.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}}}}}else{if(dtd.$cdata[node.tagName]){node.parentNode.removeChild(node);}else{var parentNode=node.parentNode,index=node.getIndex();node.parentNode.removeChild(node,true);for(var i=index,ci;ci=parentNode.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}}}break;case"comment":node.parentNode.removeChild(node);}}return function(root,rules){if(utils.isEmptyObject(rules)){return root;}var val;if(val=rules["-"]){utils.each(val.split(" "),function(k){rules[k]="-";});}for(var i=0,ci;ci=root.children[i];){filterNode(ci,rules);if(ci.parentNode){i++;}}return root;};}();UE.plugins["defaultfilter"]=function(){var me=this;me.addInputRule(function(root){var val;root.traversal(function(node){if(node.type=="element"){if(me.options.autoClearEmptyNode&&dtd.$inline[node.tagName]&&!dtd.$empty[node.tagName]&&(!node.attrs||utils.isEmptyObject(node.attrs))){if(!node.firstChild()){node.parentNode.removeChild(node);}else{if(node.tagName=="span"&&(!node.attrs||utils.isEmptyObject(node.attrs))){node.parentNode.removeChild(node,true);}}return;}switch(node.tagName){case"style":case"script":node.setAttr({cdata_tag:node.tagName,cdata_data:encodeURIComponent(node.innerText()||"")});node.tagName="div";node.removeChild(node.firstChild());break;case"a":if(val=node.getAttr("href")){node.setAttr("_href",val);}break;case"img":if(val=node.getAttr("src")){if(/^data:/.test(val)){node.parentNode.removeChild(node);break;}}node.setAttr("_src",node.getAttr("src"));break;case"span":if(browser.webkit&&(val=node.getStyle("white-space"))){if(/nowrap|normal/.test(val)){node.setStyle("white-space","");if(me.options.autoClearEmptyNode&&utils.isEmptyObject(node.attrs)){node.parentNode.removeChild(node,true);}}}break;case"p":if(val=node.getAttr("align")){node.setAttr("align");node.setStyle("text-align",val);}var cssStyle=node.getAttr("style");if(cssStyle){cssStyle=cssStyle.replace(/(margin|padding)[^;]+/g,"");node.setAttr("style",cssStyle);}if(!node.firstChild()){node.innerHTML(UE.browser.ie?"&nbsp;":"<br>");}break;case"div":var tmpNode,p=UE.uNode.createElement("p");while(tmpNode=node.firstChild()){if(tmpNode.type=="text"||!UE.dom.dtd.$block[tmpNode.tagName]){p.appendChild(tmpNode);}else{if(p.firstChild()){node.parentNode.insertBefore(p,node);p=UE.uNode.createElement("p");}else{node.parentNode.insertBefore(tmpNode,node);}}}if(p.firstChild()){node.parentNode.insertBefore(p,node);}node.parentNode.removeChild(node);break;case"dl":node.tagName="ul";break;case"dt":case"dd":node.tagName="li";break;case"li":var className=node.getAttr("class");if(!className||!/list\-/.test(className)){node.setAttr();}var tmpNodes=node.getNodesByTagName("ol ul");UE.utils.each(tmpNodes,function(n){node.parentNode.insertAfter(n,node);});}}});});me.addOutputRule(function(root){var val;root.traversal(function(node){if(node.type=="element"){if(me.options.autoClearEmptyNode&&dtd.$inline[node.tagName]&&!dtd.$empty[node.tagName]&&(!node.attrs||utils.isEmptyObject(node.attrs))){if(!node.firstChild()){node.parentNode.removeChild(node);}else{if(node.tagName=="span"&&(!node.attrs||utils.isEmptyObject(node.attrs))){node.parentNode.removeChild(node,true);}}return;}switch(node.tagName){case"div":if(val=node.getAttr("cdata_tag")){node.tagName=val;node.appendChild(UE.uNode.createText(node.getAttr("cdata_data")));node.setAttr({cdata_tag:"",cdata_data:""});}break;case"a":if(val=node.getAttr("_href")){node.setAttr({"href":val,"_href":""});}break;case"img":if(val=node.getAttr("_src")){node.setAttr({"src":node.getAttr("_src"),"_src":""});}}}});});};UE.commands["inserthtml"]={execCommand:function(command,html,notNeedFilter){var me=this,range,div;if(!html){return;}range=me.selection.getRange();div=range.document.createElement("div");div.style.display="inline";if(!notNeedFilter){var root=UE.htmlparser(html);if(me.options.filterRules){UE.filterNode(root,me.options.filterRules);}me.filterInputRule(root);html=root.toHtml();}div.innerHTML=utils.trim(html);if(!range.collapsed){var tmpNode=range.startContainer;if(domUtils.isFillChar(tmpNode)){range.setStartBefore(tmpNode);}tmpNode=range.endContainer;if(domUtils.isFillChar(tmpNode)){range.setEndAfter(tmpNode);}range.txtToElmBoundary();if(range.endContainer&&range.endContainer.nodeType==1){tmpNode=range.endContainer.childNodes[range.endOffset];if(tmpNode&&domUtils.isBr(tmpNode)){range.setEndAfter(tmpNode);}}if(range.startOffset==0){tmpNode=range.startContainer;if(domUtils.isBoundaryNode(tmpNode,"firstChild")){tmpNode=range.endContainer;if(range.endOffset==(tmpNode.nodeType==3?tmpNode.nodeValue.length:tmpNode.childNodes.length)&&domUtils.isBoundaryNode(tmpNode,"lastChild")){me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";range.setStart(me.body.firstChild,0).collapse(true);}}}!range.collapsed&&range.deleteContents();if(range.startContainer.nodeType==1){var child=range.startContainer.childNodes[range.startOffset],pre;if(child&&domUtils.isBlockElm(child)&&(pre=child.previousSibling)&&domUtils.isBlockElm(pre)){range.setEnd(pre,pre.childNodes.length).collapse();while(child.firstChild){pre.appendChild(child.firstChild);}domUtils.remove(child);}}}var child,parent,pre,tmp,hadBreak=0,nextNode;if(range.inFillChar()){child=range.startContainer;if(domUtils.isFillChar(child)){range.setStartBefore(child).collapse(true);domUtils.remove(child);}else{if(domUtils.isFillChar(child,true)){child.nodeValue=child.nodeValue.replace(fillCharReg,"");range.startOffset--;range.collapsed&&range.collapse(true);}}}var li=domUtils.findParentByTagName(range.startContainer,"li",true);if(li){var next,last;while(child=div.firstChild){while(child&&(child.nodeType==3||!domUtils.isBlockElm(child))){next=child.nextSibling;range.insertNode(child);last=child;child=next;}if(child){if(/^(ol|ul)$/i.test(child.tagName)){while(child.firstChild){last=child.firstChild;domUtils.insertAfter(li,child.firstChild);li=li.nextSibling;}domUtils.remove(child);}else{var tmpLi;next=child.nextSibling;tmpLi=me.document.createElement("li");domUtils.insertAfter(li,tmpLi);tmpLi.appendChild(child);last=child;child=next;li=tmpLi;}}}li=domUtils.findParentByTagName(range.startContainer,"li",true);if(domUtils.isEmptyBlock(li)){domUtils.remove(li);}if(last){range.setStartAfter(last).collapse(true).select(true);}}else{while(child=div.firstChild){if(hadBreak){var p=me.document.createElement("p");while(child&&(child.nodeType==3||!dtd.$block[child.tagName])){nextNode=child.nextSibling;p.appendChild(child);child=nextNode;}if(p.firstChild){child=p;}}range.insertNode(child);nextNode=child.nextSibling;if(!hadBreak&&child.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(child)){parent=domUtils.findParent(child,function(node){return domUtils.isBlockElm(node);});if(parent&&parent.tagName.toLowerCase()!="body"&&!(dtd[parent.tagName][child.nodeName]&&child.parentNode===parent)){if(!dtd[parent.tagName][child.nodeName]){pre=parent;}else{tmp=child.parentNode;while(tmp!==parent){pre=tmp;tmp=tmp.parentNode;}}domUtils.breakParent(child,pre||tmp);var pre=child.previousSibling;domUtils.trimWhiteTextNode(pre);if(!pre.childNodes.length){domUtils.remove(pre);}if(!browser.ie&&(next=child.nextSibling)&&domUtils.isBlockElm(next)&&next.lastChild&&!domUtils.isBr(next.lastChild)){next.appendChild(me.document.createElement("br"));}hadBreak=1;}}var next=child.nextSibling;if(!div.firstChild&&next&&domUtils.isBlockElm(next)){range.setStart(next,0).collapse(true);break;}range.setEndAfter(child).collapse();}child=range.startContainer;if(nextNode&&domUtils.isBr(nextNode)){domUtils.remove(nextNode);}if(domUtils.isBlockElm(child)&&domUtils.isEmptyNode(child)){if(nextNode=child.nextSibling){domUtils.remove(child);if(nextNode.nodeType==1&&dtd.$block[nextNode.tagName]){range.setStart(nextNode,0).collapse(true).shrinkBoundary();}}else{child.innerHTML=browser.ie?domUtils.fillChar:"<br/>";}}range.select(true);}setTimeout(function(){range=me.selection.getRange();range.scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0);me.fireEvent("afterinserthtml");},200);}};UE.plugins["autotypeset"]=function(){this.setOpt({"autotypeset":{mergeEmptyline:true,removeClass:false,removeEmptyline:true,textAlign:"left",imageBlockLine:"center",pasteFilter:false,clearFontSize:true,clearFontFamily:true,removeEmptyNode:true,removeTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:true,indentValue:"2em"}});var me=this,opt=me.options.autotypeset,remainClass={"selectTdClass":1,"pagebreak":1,"anchorclass":1},remainTag={"li":1},tags={div:1,p:1,blockquote:1,center:1,h1:1,h2:0,h3:1,h4:1,h5:1,h6:1,span:1},highlightCont;if(!opt){return;}function isLine(node,notEmpty){if(!node||node.nodeType==3){return 0;}if(domUtils.isBr(node)){return 1;}if(node&&node.parentNode&&tags[node.tagName.toLowerCase()]){if(highlightCont&&highlightCont.contains(node)||node.getAttribute("pagebreak")){return 0;}return notEmpty?!domUtils.isEmptyBlock(node):domUtils.isEmptyBlock(node);}}function CtoH(str){var result="";for(var i=0;i<str.length;i++){if(str.charCodeAt(i)==12288){result+=String.fromCharCode(str.charCodeAt(i)-12256);continue;}if(str.charCodeAt(i)>65280&&str.charCodeAt(i)<65375){result+=String.fromCharCode(str.charCodeAt(i)-65248);}else{result+=String.fromCharCode(str.charCodeAt(i));}}return result;}function removeNotAttributeSpan(node){if(!node.style.cssText){domUtils.removeAttributes(node,["style"]);if(node.tagName.toLowerCase()=="span"&&domUtils.hasNoAttributes(node)){domUtils.remove(node,true);}}}function autotype(type,html){var me=this,cont;if(html){if(!opt.pasteFilter){return;}cont=me.document.createElement("div");cont.innerHTML=html.html;}else{cont=me.document.body;cont.innerHTML=CtoH(cont.innerHTML);}var nodes=domUtils.getElementsByTagName(cont,"*");for(var i=0,ci;ci=nodes[i++];){if(me.fireEvent("excludeNodeinautotype",ci)===true){continue;}if(opt.clearFontSize&&ci.style.fontSize){domUtils.removeStyle(ci,"font-size");removeNotAttributeSpan(ci);}if(opt.clearFontFamily&&ci.style.fontFamily){domUtils.removeStyle(ci,"font-family");removeNotAttributeSpan(ci);}if(isLine(ci)){if(opt.mergeEmptyline){var next=ci.nextSibling,tmpNode,isBr=domUtils.isBr(ci);while(isLine(next)){tmpNode=next;next=tmpNode.nextSibling;if(isBr&&(!next||next&&!domUtils.isBr(next))){break;}domUtils.remove(tmpNode);}}if(opt.removeEmptyline&&domUtils.inDoc(ci,cont)&&!remainTag[ci.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(ci)){var li=domUtils.findParentByTagName(ci,"li",true);if(li){continue;}next=ci.nextSibling;if(next&&!domUtils.isBr(next)){continue;}}domUtils.remove(ci);continue;}}if(isLine(ci,true)&&ci.tagName!="SPAN"){if(opt.indent){if(domUtils.findParentByTagName(ci,"li",true)){continue;}ci.style.textIndent=opt.indentValue;}if(opt.textAlign){ci.style.textAlign=opt.textAlign;}}if(opt.removeClass&&ci.className&&!remainClass[ci.className.toLowerCase()]){if(highlightCont&&highlightCont.contains(ci)){continue;}domUtils.removeAttributes(ci,["class"]);}if(opt.imageBlockLine&&ci.tagName.toLowerCase()=="img"&&!ci.getAttribute("emotion")){if(html){var img=ci;switch(opt.imageBlockLine){case"left":case"right":case"none":var pN=img.parentNode,tmpNode,pre,next;while(dtd.$inline[pN.tagName]||pN.tagName=="A"){pN=pN.parentNode;}tmpNode=pN;if(tmpNode.tagName=="P"&&domUtils.getStyle(tmpNode,"text-align")=="center"){if(!domUtils.isBody(tmpNode)&&domUtils.getChildCount(tmpNode,function(node){return !domUtils.isBr(node)&&!domUtils.isWhitespace(node);})==1){pre=tmpNode.previousSibling;next=tmpNode.nextSibling;if(pre&&next&&pre.nodeType==1&&next.nodeType==1&&pre.tagName==next.tagName&&domUtils.isBlockElm(pre)){pre.appendChild(tmpNode.firstChild);while(next.firstChild){pre.appendChild(next.firstChild);}domUtils.remove(tmpNode);domUtils.remove(next);}else{domUtils.setStyle(tmpNode,"text-align","");}}}domUtils.setStyle(img,"float",opt.imageBlockLine);break;case"center":if(me.queryCommandValue("imagefloat")!="center"){pN=img.parentNode;domUtils.setStyle(img,"float","none");tmpNode=img;while(pN&&domUtils.getChildCount(pN,function(node){return !domUtils.isBr(node)&&!domUtils.isWhitespace(node);})==1&&(dtd.$inline[pN.tagName]||pN.tagName=="A")){tmpNode=pN;pN=pN.parentNode;}var pNode=me.document.createElement("p");domUtils.setAttributes(pNode,{style:"text-align:center"});tmpNode.parentNode.insertBefore(pNode,tmpNode);pNode.appendChild(tmpNode);domUtils.setStyle(tmpNode,"float","");}}}else{var range=me.selection.getRange();range.selectNode(ci).select();me.execCommand("imagefloat",opt.imageBlockLine);}}if(opt.removeEmptyNode){if(opt.removeTagNames[ci.tagName.toLowerCase()]&&domUtils.hasNoAttributes(ci)&&domUtils.isEmptyBlock(ci)){domUtils.remove(ci);}}}if(html){html.html=cont.innerHTML;}}if(opt.pasteFilter){me.addListener("beforepaste",autotype);}me.commands["autotypeset"]={execCommand:function(){me.removeListener("beforepaste",autotype);if(opt.pasteFilter){me.addListener("beforepaste",autotype);}autotype.call(me);}};};function setIEMarginAuto(elem){var parent,_ele=elem;while(parent=_ele.parentElement){if(utils.indexOf(["td","th","caption","body"],parent.tagName.toLowerCase())!==-1){break;}_ele=parent;}var curStyle=parent.currentStyle,_width=parent.offsetWidth-parseInt(curStyle.marginLeft,10)-parseInt(curStyle.marginRight,10),padding=parseInt(curStyle.paddingLeft,10)+parseInt(curStyle.paddingRight,10),_left=Math.round((_width-elem.offsetWidth)/2);_left-=padding;if(_left){elem.style.cssText="float: none; display: block;  margin:0 auto 0 "+_left+"px;";}}UE.commands["imagefloat"]={execCommand:function(cmd,align){var me=this,align="center",range=me.selection.getRange();if(!range.collapsed){var img=range.getClosedNode();if(img&&img.tagName=="IMG"){switch(align){case"left":case"right":case"none":var pN=img.parentNode,tmpNode,pre,next;while(dtd.$inline[pN.tagName]||pN.tagName=="A"){pN=pN.parentNode;}tmpNode=pN;if(tmpNode.tagName=="P"&&domUtils.getStyle(tmpNode,"text-align")=="center"){if(!domUtils.isBody(tmpNode)&&domUtils.getChildCount(tmpNode,function(node){return !domUtils.isBr(node)&&!domUtils.isWhitespace(node);})==1){pre=tmpNode.previousSibling;next=tmpNode.nextSibling;if(pre&&next&&pre.nodeType==1&&next.nodeType==1&&pre.tagName==next.tagName&&domUtils.isBlockElm(pre)){pre.appendChild(tmpNode.firstChild);while(next.firstChild){pre.appendChild(next.firstChild);}domUtils.remove(tmpNode);domUtils.remove(next);}else{domUtils.setStyle(tmpNode,"text-align","");}}range.selectNode(img).select();}domUtils.setStyle(img,"float",align=="none"?"":align);if(align=="none"){domUtils.removeAttributes(img,"align");}break;case"center":if(me.queryCommandValue("imagefloat")!="center"){pN=img.parentNode;img.style.cssText="float: none; display: block; margin: 0px auto;";tmpNode=img;while(pN&&domUtils.getChildCount(pN,function(node){return !domUtils.isBr(node)&&!domUtils.isWhitespace(node);})==1&&(dtd.$inline[pN.tagName]||pN.tagName=="A")){tmpNode=pN;pN=pN.parentNode;}range.setStartBefore(tmpNode).setCursor(false);pN=me.document.createElement("div");pN.appendChild(tmpNode);domUtils.setStyle(tmpNode,"float","");me.execCommand("insertHtml",'<p id="_img_parent_tmp">'+pN.innerHTML+"</p>");tmpNode=me.document.getElementById("_img_parent_tmp");tmpNode.removeAttribute("id");tmpNode=tmpNode.firstChild;range.selectNode(tmpNode).select();next=tmpNode.parentNode.nextSibling;if(next&&domUtils.isEmptyNode(next)){domUtils.remove(next);}}break;}}}},queryCommandValue:function(){var range=this.selection.getRange(),startNode,floatStyle;if(range.collapsed){return"none";}startNode=range.getClosedNode();if(startNode&&startNode.nodeType==1&&startNode.tagName=="IMG"){floatStyle=startNode.getAttribute("align")||domUtils.getComputedStyle(startNode,"float");if(floatStyle=="none"){floatStyle=domUtils.getComputedStyle(startNode.parentNode,"text-align")=="center"?"center":floatStyle;}return{left:1,right:1,center:1}[floatStyle]?floatStyle:"none";}return"none";},queryCommandState:function(){var range=this.selection.getRange(),startNode;if(range.collapsed){return -1;}startNode=range.getClosedNode();if(startNode&&startNode.nodeType==1&&startNode.tagName=="IMG"){return 0;}return -1;}};UE.commands["insertimage"]={execCommand:function(cmd,opt){opt=utils.isArray(opt)?opt:[opt];if(!opt.length){return;}var me=this,range=me.selection.getRange(),img=range.getClosedNode();if(img&&/img/i.test(img.tagName)&&img.className!="edui-faked-video"&&!img.getAttribute("word_img")){var first=opt.shift();var floatStyle=first["floatStyle"]="center";delete first["floatStyle"];domUtils.setAttributes(img,first);me.execCommand("imagefloat",floatStyle);if(opt.length>0){range.setStartAfter(img).setCursor(false,true);me.execCommand("insertimage",opt);}}else{var html=[],str="",ci;ci=opt[0];ci["floatStyle"]="center";if(opt.length==1){str='<img style="float: none; display: block; margin: 0px auto;" src="'+ci.src+'" '+(ci._src?' _src="'+ci._src+'" ':"")+(ci.width?'width="'+ci.width+'" ':"")+(ci.height?' height="'+ci.height+'" ':"")+(ci.title&&ci.title!=""?' title="'+ci.title+'"':"")+(ci.border&&ci.border!="0"?' border="'+ci.border+'"':"")+(ci.alt&&ci.alt!=""?' alt="'+ci.alt+'"':"")+(ci.hspace&&ci.hspace!="0"?' hspace = "'+ci.hspace+'"':"")+(ci.vspace&&ci.vspace!="0"?' vspace = "'+ci.vspace+'"':"")+"/>";if(ci["floatStyle"]=="center"){str="<p >"+str+"</p>";}html.push(str);}else{for(var i=0;ci=opt[i++];){str='<p><img  src="'+ci.src+'" '+(ci.width?'width="'+ci.width+'" ':"")+(ci._src?' _src="'+ci._src+'" ':"")+(ci.height?' height="'+ci.height+'" ':"")+' style="float: none; display: block; margin: 0px auto;" '+(ci.title?' title="'+ci.title+'"':"")+" /></p>";html.push(str);}}me.execCommand("insertHtml",html.join(""));if(browser.ie){setTimeout(function(){var imgs=domUtils.getElementsByTagName(me.document,"img");utils.each(imgs,function(node){setIEMarginAuto(node);});},200);}}}};UE.plugins["selectall"]=function(){var me=this;me.commands["selectall"]={execCommand:function(){var me=this,body=me.body,range=me.selection.getRange();range.selectNodeContents(body);if(domUtils.isEmptyBlock(body)){if(browser.opera&&body.firstChild&&body.firstChild.nodeType==1){range.setStartAtFirst(body.firstChild);}range.collapse(true);}range.select(true);},notNeedUndo:1};function isBoundaryNode(node,dir){var tmp;while(!domUtils.isBody(node)){tmp=node;node=node.parentNode;if(tmp!==node[dir]){return false;}}return true;}me.addListener("keydown",function(type,evt){var rng=me.selection.getRange();if(!rng.collapsed&&!(evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)){var tmpNode=rng.startContainer;if(domUtils.isFillChar(tmpNode)){rng.setStartBefore(tmpNode);}tmpNode=rng.endContainer;if(domUtils.isFillChar(tmpNode)){rng.setEndAfter(tmpNode);}rng.txtToElmBoundary();if(rng.startOffset==0){tmpNode=rng.startContainer;if(isBoundaryNode(tmpNode,"firstChild")){tmpNode=rng.endContainer;if(rng.endOffset==rng.endContainer.childNodes.length&&isBoundaryNode(tmpNode,"lastChild")){me.fireEvent("saveScene");me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";rng.setStart(me.body.firstChild,0).setCursor(false,true);me.fireEvent("saveScene");browser.ie&&me._selectionChange();return;}}}}});me.addshortcutkey({"selectAll":"ctrl+65"});};(function(){var sourceEditors={textarea:function(editor,holder){var textarea=holder.ownerDocument.createElement("textarea");textarea.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;";if(browser.ie&&browser.version<8){textarea.style.width=holder.offsetWidth+"px";textarea.style.height=holder.offsetHeight+"px";holder.onresize=function(){textarea.style.width=holder.offsetWidth+"px";textarea.style.height=holder.offsetHeight+"px";};}holder.appendChild(textarea);return{setContent:function(content){textarea.value=content;},getContent:function(){return textarea.value;},select:function(){var range;if(browser.ie){range=textarea.createTextRange();range.collapse(true);range.select();}else{textarea.setSelectionRange(0,0);textarea.focus();}},dispose:function(){holder.removeChild(textarea);holder.onresize=null;textarea=null;holder=null;}};},codemirror:function(editor,holder){var codeEditor=window.CodeMirror(holder,{mode:"text/html",tabMode:"indent",lineNumbers:true,lineWrapping:true});var dom=codeEditor.getWrapperElement();dom.style.cssText='position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,"Courier new",monospace;font-size:13px;';codeEditor.getScrollerElement().style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;";codeEditor.refresh();return{getCodeMirror:function(){return codeEditor;},setContent:function(content){codeEditor.setValue(content);},getContent:function(){return codeEditor.getValue();},select:function(){codeEditor.focus();},dispose:function(){holder.removeChild(dom);dom=null;codeEditor=null;}};}};UE.plugins["source"]=function(){var me=this;var opt=this.options;var sourceMode=false;var sourceEditor;opt.sourceEditor=browser.ie?"textarea":(opt.sourceEditor||"codemirror");me.setOpt({sourceEditorFirst:false});function createSourceEditor(holder){return sourceEditors[opt.sourceEditor=="codemirror"&&window.CodeMirror?"codemirror":"textarea"](me,holder);}var bakCssText;var oldGetContent=me.getContent,bakAddress;me.commands["source"]={execCommand:function(){sourceMode=!sourceMode;if(sourceMode){bakAddress=me.selection.getRange().createAddress(false,true);me.undoManger&&me.undoManger.save(true);if(browser.gecko){me.body.contentEditable=false;}bakCssText=me.iframe.style.cssText;me.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;";var root=UE.htmlparser(me.getContent());var content=me.hasContents()?root.toHtml(true):"";sourceEditor=createSourceEditor(me.iframe.parentNode);sourceEditor.setContent(content);setTimeout(function(){sourceEditor.select();me.addListener("fullscreenchanged",function(){try{sourceEditor.getCodeMirror().refresh();}catch(e){}});});me.getContent=function(){return sourceEditor.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";};}else{me.iframe.style.cssText=bakCssText;var cont=sourceEditor.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";me.setContent(cont);sourceEditor.dispose();sourceEditor=null;me.getContent=oldGetContent;var first=me.body.firstChild;if(!first){me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";first=me.body.firstChild;}me.undoManger&&me.undoManger.save(true);if(browser.gecko){var input=document.createElement("input");input.style.cssText="position:absolute;left:0;top:-32768px";document.body.appendChild(input);me.body.contentEditable=false;setTimeout(function(){domUtils.setViewportOffset(input,{left:-32768,top:0});input.focus();setTimeout(function(){me.body.contentEditable=true;me.selection.getRange().moveToAddress(bakAddress).select();domUtils.remove(input);});});}else{try{me.selection.getRange().moveToAddress(bakAddress).select();}catch(e){}}}this.fireEvent("sourcemodechanged",sourceMode);},queryCommandState:function(){return sourceMode|0;},notNeedUndo:1};var oldQueryCommandState=me.queryCommandState;me.queryCommandState=function(cmdName){cmdName=cmdName.toLowerCase();if(sourceMode){return cmdName in {"source":1,"fullscreen":1}?1:-1;}return oldQueryCommandState.apply(this,arguments);};if(opt.sourceEditor=="codemirror"){me.addListener("ready",function(){utils.loadFile(document,{src:opt.codeMirrorJsUrl||opt.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.js",tag:"script",type:"text/javascript",defer:"defer"},function(){if(opt.sourceEditorFirst){setTimeout(function(){me.execCommand("source");},0);}});utils.loadFile(document,{tag:"link",rel:"stylesheet",type:"text/css",href:opt.codeMirrorCssUrl||opt.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.css"});});}};})();UE.plugins["wordcount"]=function(){var me=this;me.addListener("contentchange",function(){me.fireEvent("wordcount");});var timer;me.addListener("ready",function(){var me=this;domUtils.on(me.body,"keyup",function(evt){var code=evt.keyCode||evt.which,ignores={"16":1,"18":1,"20":1,"37":1,"38":1,"39":1,"40":1};if(code in ignores){return;}clearTimeout(timer);timer=setTimeout(function(){me.fireEvent("wordcount");},200);});});};UE.plugins["undo"]=function(){var me=this,maxUndoCount=me.options.maxUndoCount||20,maxInputCount=me.options.maxInputCount||20,fillchar=new RegExp(domUtils.fillChar+"|</hr>","gi");function compareAddr(indexA,indexB){if(indexA.length!=indexB.length){return 0;}for(var i=0,l=indexA.length;i<l;i++){if(indexA[i]!=indexB[i]){return 0;}}return 1;}function compareRangeAddress(rngAddrA,rngAddrB){if(rngAddrA.collapsed!=rngAddrB.collapsed){return 0;}if(!compareAddr(rngAddrA.startAddress,rngAddrB.startAddress)||!compareAddr(rngAddrA.endAddress,rngAddrB.endAddress)){return 0;}return 1;}function adjustContent(cont){var specialAttr=/\b(?:href|src|name)="[^"]*?"/gi;return cont.replace(specialAttr,"").replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi,function(a,b,c){return b.toLowerCase()+"="+c.replace(/['"]/g,"").toLowerCase();}).replace(/(<[\w\-]+)|([\w\-]+>)/gi,function(a,b,c){return(b||c).toLowerCase();});}function UndoManager(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.undo=function(){if(this.hasUndo){var currentScene=this.getScene(),lastScene=this.list[this.index],lastContent=adjustContent(lastScene.content),currentContent=adjustContent(currentScene.content);if(lastContent!=currentContent){this.save();}if(!this.list[this.index-1]&&this.list.length==1){this.reset();return;}while(this.list[this.index].content==this.list[this.index-1].content){this.index--;if(this.index==0){return this.restore(0);}}this.restore(--this.index);}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content){this.index++;if(this.index==this.list.length-1){return this.restore(this.index);}}this.restore(++this.index);}};this.restore=function(){var scene=this.list[this.index];me.document.body.innerHTML=scene.content.replace(fillchar,"");if(browser.ie){utils.each(domUtils.getElementsByTagName(me.document,"td th caption p"),function(node){if(domUtils.isEmptyNode(node)){domUtils.fillNode(me.document,node);}});}new dom.Range(me.document).moveToAddress(scene.address).select();this.update();this.clearKey();me.fireEvent("reset",true);};this.getScene=function(notSetCursor){var rng=me.selection.getRange(),restoreAddress=rng.createAddress(),rngAddress=rng.createAddress(false,true);me.fireEvent("beforegetscene");var cont=me.body.innerHTML.replace(fillchar,"");browser.ie&&(cont=cont.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">"));me.fireEvent("aftergetscene");try{!notSetCursor&&rng.moveToAddress(restoreAddress).select(true);}catch(e){}return{address:rngAddress,content:cont};};this.save=function(notCompareRange,notSetCursor){var currentScene=this.getScene(notSetCursor),lastScene=this.list[this.index];if(lastScene&&lastScene.content==currentScene.content&&(notCompareRange?1:compareRangeAddress(lastScene.address,currentScene.address))){return;}this.list=this.list.slice(0,this.index+1);this.list.push(currentScene);if(this.list.length>maxUndoCount){this.list.shift();}this.index=this.list.length-1;this.clearKey();this.update();};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1];};this.reset=function(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.clearKey();};this.clearKey=function(){keycont=0;lastKeyCode=null;};}me.undoManger=new UndoManager();function saveScene(){this.undoManger.save();}me.addListener("saveScene",function(){me.undoManger.save();});me.addListener("beforeexeccommand",saveScene);me.addListener("afterexeccommand",saveScene);me.addListener("reset",function(type,exclude){if(!exclude){me.undoManger.reset();}});me.commands["redo"]=me.commands["undo"]={execCommand:function(cmdName){me.undoManger[cmdName]();},queryCommandState:function(cmdName){return me.undoManger["has"+(cmdName.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1;},notNeedUndo:1};var keys={16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},keycont=0,lastKeyCode;var inputType=false;me.addListener("ready",function(){domUtils.on(me.body,"compositionstart",function(){inputType=true;});domUtils.on(me.body,"compositionend",function(){inputType=false;});});me.addshortcutkey({"Undo":"ctrl+90","Redo":"ctrl+89"});me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which;if(!keys[keyCode]&&!evt.ctrlKey&&!evt.metaKey&&!evt.shiftKey&&!evt.altKey){if(inputType){return;}if(me.undoManger.list.length==0||((keyCode==8||keyCode==46)&&lastKeyCode!=keyCode)){me.fireEvent("contentchange");me.undoManger.save(true);lastKeyCode=keyCode;return;}if(me.undoManger.list.length==2&&me.undoManger.index==0&&keycont==0){me.undoManger.list.splice(1,1);me.undoManger.update();}lastKeyCode=keyCode;keycont++;if(keycont>=maxInputCount||me.undoManger.mousedown){if(me.selection.getRange().collapsed){me.fireEvent("contentchange");}me.undoManger.save(false,true);me.undoManger.mousedown=false;}}});me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(!keys[keyCode]&&!evt.ctrlKey&&!evt.metaKey&&!evt.shiftKey&&!evt.altKey){if(inputType){return;}if(me.undoManger.list.length==1){me.undoManger.save(true);}}});me.addListener("mousedown",function(){me.undoManger.mousedown=true;});};UE.plugins["paste"]=function(){function getClipboardData(callback){var doc=this.document;if(doc.getElementById("baidu_pastebin")){return;}var range=this.selection.getRange(),bk=range.createBookmark(),pastebin=doc.createElement("div");pastebin.id="baidu_pastebin";browser.webkit&&pastebin.appendChild(doc.createTextNode(domUtils.fillChar+domUtils.fillChar));doc.body.appendChild(pastebin);bk.start.style.display="";pastebin.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(bk.start).y+"px";range.selectNodeContents(pastebin).select(true);setTimeout(function(){if(browser.webkit){for(var i=0,pastebins=doc.querySelectorAll("#baidu_pastebin"),pi;pi=pastebins[i++];){if(domUtils.isEmptyNode(pi)){domUtils.remove(pi);}else{pastebin=pi;break;}}}try{pastebin.parentNode.removeChild(pastebin);}catch(e){}range.moveToBookmark(bk).select(true);callback(pastebin);},0);}var me=this;var txtContent,htmlContent,address;function filter(div){var html;if(div.firstChild){var nodes=domUtils.getElementsByTagName(div,"span");for(var i=0,ni;ni=nodes[i++];){if(ni.id=="_baidu_cut_start"||ni.id=="_baidu_cut_end"){domUtils.remove(ni);}}if(browser.webkit){var brs=div.querySelectorAll("div br");for(var i=0,bi;bi=brs[i++];){var pN=bi.parentNode;if(pN.tagName=="DIV"&&pN.childNodes.length==1){pN.innerHTML="<p><br/></p>";domUtils.remove(pN);}}var divs=div.querySelectorAll("#baidu_pastebin");for(var i=0,di;di=divs[i++];){var tmpP=me.document.createElement("p");di.parentNode.insertBefore(tmpP,di);while(di.firstChild){tmpP.appendChild(di.firstChild);}domUtils.remove(di);}var metas=div.querySelectorAll("meta");for(var i=0,ci;ci=metas[i++];){domUtils.remove(ci);}var brs=div.querySelectorAll("br");for(i=0;ci=brs[i++];){if(/^apple-/i.test(ci.className)){domUtils.remove(ci);}}}if(browser.gecko){var dirtyNodes=div.querySelectorAll("[_moz_dirty]");for(i=0;ci=dirtyNodes[i++];){ci.removeAttribute("_moz_dirty");}}if(!browser.ie){var spans=div.querySelectorAll("span.Apple-style-span");for(var i=0,ci;ci=spans[i++];){domUtils.remove(ci,true);}}html=div.innerHTML.replace(/>(?:(\s|&nbsp;)*?)</g,"><");html=UE.filterWord(html);var root=UE.htmlparser(html,true);if(me.options.filterRules){UE.filterNode(root,me.options.filterRules);}me.filterInputRule(root);if(browser.webkit){var br=root.lastChild();if(br&&br.type=="element"&&br.tagName=="br"){root.removeChild(br);}utils.each(me.body.querySelectorAll("div"),function(node){if(domUtils.isEmptyBlock(node)){domUtils.remove(node);}});}html={"html":root.toHtml()};me.fireEvent("beforepaste",html,root);root=UE.htmlparser(html.html);if(me.queryCommandState("pasteplain")){me.execCommand("insertHtml",UE.filterNode(root,me.options.filterTxtRules).toHtml(),true);}else{UE.filterNode(root,me.options.filterTxtRules);txtContent=root.toHtml();htmlContent=html.html;address=me.selection.getRange().createAddress(true);me.execCommand("insertHtml",htmlContent,true);}me.fireEvent("afterpaste",html);}}me.addListener("pasteTransfer",function(cmd,plainType){if(address&&txtContent&&htmlContent&&txtContent!=htmlContent){var range=me.selection.getRange();range.moveToAddress(address,true).deleteContents();range.select(true);me.__hasEnterExecCommand=true;var html=htmlContent;if(plainType===2){html=html.replace(/<(\/?)([\w\-]+)([^>]*)>/gi,function(a,b,tagName,attrs){tagName=tagName.toLowerCase();if({img:1}[tagName]){return a;}attrs=attrs.replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi,function(str,atr,val){if({"src":1,"href":1,"name":1}[atr.toLowerCase()]){return atr+"="+val+" ";}return"";});if({"span":1,"div":1}[tagName]){return"";}else{return"<"+b+tagName+" "+utils.trim(attrs)+">";}});}else{if(plainType){html=txtContent;}}me.execCommand("inserthtml",html,true);me.__hasEnterExecCommand=false;var tmpAddress=me.selection.getRange().createAddress(true);address.endAddress=tmpAddress.startAddress;}});me.addListener("ready",function(){domUtils.on(me.body,"cut",function(){var range=me.selection.getRange();if(!range.collapsed&&me.undoManger){me.undoManger.save();}});domUtils.on(me.body,browser.ie||browser.opera?"keydown":"paste",function(e){if((browser.ie||browser.opera)&&((!e.ctrlKey&&!e.metaKey)||e.keyCode!="86")){return;}getClipboardData.call(me,function(div){filter(div);});});});};UE.plugins["list"]=function(){var me=this,notExchange={"TD":1,"PRE":1,"BLOCKQUOTE":1};var customStyle={"decimal":"exp-ol-","disc":"exp-ul"};me.setOpt({"insertorderedlist":{"num":"","num1":"","num2":"","cn":"","cn1":"","cn2":"","decimal":"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},"insertunorderedlist":{"circle":"","disc":"","square":"","dash":"","dot":""},listDefaultPaddingLeft:"30",listiconpath:"http://bs.baidu.com/listicon/",maxListLevel:1});var liiconpath=me.options.listiconpath;for(var s in customStyle){if(!me.options.insertorderedlist.hasOwnProperty(s)&&!me.options.insertunorderedlist.hasOwnProperty(s)){delete customStyle[s];}}me.ready(function(){var customCss=[];for(var p in customStyle){if(p=="dash"||p=="dot"){customCss.push("li.list-"+customStyle[p]+"{background-image:url("+liiconpath+customStyle[p]+".gif)}");customCss.push("ul.custom_"+p+"{list-style:none;}ul.custom_"+p+" li{background-position:0 3px;background-repeat:no-repeat}");}else{if(p=="disc"){customCss.push("li.list-"+customStyle[p]+"{background-image:url(http://img.baidu.com/img/iknow/exp/global/unsortlist.png);background-repeat:no-repeat;background-position: 11px 8px;}");}else{if(p=="decimal"){for(var i=0;i<99;i++){customCss.push("li.list-"+customStyle[p]+i+"{background-image:url(http://img.baidu.com/img/iknow/exp/edit/edit-num"+i+".png)}");}customCss.push("ol.custom_"+p+"{list-style:none;}ol.custom_"+p+" li{background-position:0 3px;background-repeat:no-repeat}");}else{for(var i=0;i<99;i++){customCss.push("li.list-"+customStyle[p]+i+"{background-image:url("+liiconpath+"list-"+customStyle[p]+i+".gif)}");}customCss.push("ol.custom_"+p+"{list-style:none;}ol.custom_"+p+" li{background-position:0 3px;background-repeat:no-repeat}");}}}switch(p){case"cn":customCss.push("li.list-"+p+"-paddingleft-1{padding-left:25px}");customCss.push("li.list-"+p+"-paddingleft-2{padding-left:40px}");customCss.push("li.list-"+p+"-paddingleft-3{padding-left:55px}");break;case"cn1":customCss.push("li.list-"+p+"-paddingleft-1{padding-left:30px}");customCss.push("li.list-"+p+"-paddingleft-2{padding-left:40px}");customCss.push("li.list-"+p+"-paddingleft-3{padding-left:55px}");break;case"cn2":customCss.push("li.list-"+p+"-paddingleft-1{padding-left:40px}");customCss.push("li.list-"+p+"-paddingleft-2{padding-left:55px}");customCss.push("li.list-"+p+"-paddingleft-3{padding-left:68px}");break;case"num":case"num1":customCss.push("li.list-"+p+"-paddingleft-1{padding-left:25px}");break;case"num2":customCss.push("li.list-"+p+"-paddingleft-1{padding-left:35px}");customCss.push("li.list-"+p+"-paddingleft-2{padding-left:40px}");break;case"dash":customCss.push("li.list-"+p+"-paddingleft{padding-left:35px}");break;case"dot":customCss.push("li.list-"+p+"-paddingleft{padding-left:20px}");break;case"decimal":customCss.push("li.list-"+p+"-paddingleft-1{padding:9px 0 9px 42px;+padding-bottom:1px;}");break;case"disc":customCss.push("li.list-"+p+"-paddingleft{padding-left:41px}");}}customCss.push(".list-paddingleft-1{padding-left:0}");customCss.push(".list-paddingleft-2{padding-left:"+me.options.listDefaultPaddingLeft+"px}");customCss.push(".list-paddingleft-3{padding-left:"+me.options.listDefaultPaddingLeft*2+"px}");utils.cssRule("list","ol,ul{margin:0;pading:0;"+(browser.ie?"":"width:95%")+"}li{clear:both;}"+customCss.join("\n"),me.document);});function getStyle(node){var cls=node.className;if(domUtils.hasClass(node,/custom_/)){return cls.match(/custom_(\w+)/)[1];}return"";}me.addInputRule(function(root){utils.each(root.getNodesByTagName("li"),function(li){var tmpP=UE.uNode.createElement("p");for(var i=0,ci;ci=li.children[i];){if(ci.type=="text"||dtd.$inline[ci.tagName]){tmpP.appendChild(ci);}else{if(tmpP.firstChild()){li.insertBefore(tmpP,ci);tmpP=UE.uNode.createElement("p");i=i+2;}else{i++;}}}if(tmpP.firstChild()&&!tmpP.parentNode){li.appendChild(tmpP);}});});me.addListener("contentchange",function(){utils.each(domUtils.getElementsByTagName(me.document,"ol ul"),function(node){if(!domUtils.inDoc(node,me.document)){return;}var index=0,type=2,parent=node.parentNode;if(domUtils.hasClass(node,/custom_/)){if(!(/[ou]l/i.test(parent.tagName)&&domUtils.hasClass(parent,/custom_/))){type=1;}}else{if(/[ou]l/i.test(parent.tagName)&&domUtils.hasClass(parent,/custom_/)){type=3;}}style=domUtils.getStyle(node,"list-style-type");node.style.cssText=style?"list-style-type:"+style:"";node.className=utils.trim(node.className.replace(/list-paddingleft-\w+/,""))+" list-paddingleft-"+type;utils.each(domUtils.getElementsByTagName(node,"li"),function(li){li.style.cssText&&(li.style.cssText="");if(!li.firstChild){domUtils.remove(li);return;}if(li.parentNode!==node){return;}index++;if(domUtils.hasClass(node,/custom_/)){var paddingLeft=1,currentStyle=getStyle(node);if(node.tagName=="OL"){if(currentStyle){switch(currentStyle){case"cn":case"cn1":case"cn2":if(index>10&&(index%10==0||index>10&&index<20)){paddingLeft=2;}else{if(index>20){paddingLeft=3;}}break;case"num2":if(index>9){paddingLeft=2;}}}li.className="list-"+customStyle[currentStyle]+index+" "+"list-"+currentStyle+"-paddingleft-"+paddingLeft;}else{li.className="list-"+customStyle[currentStyle]+" "+"list-"+currentStyle+"-paddingleft";}}else{li.className=li.className.replace(/list-[\w\-]+/gi,"");}var className=li.getAttribute("class");if(className!==null&&!className.replace(/\s/g,"")){domUtils.removeAttributes(li,"class");}});adjustList(node,node.tagName.toLowerCase(),getStyle(node)||domUtils.getStyle(node,"list-style-type"),true);});});function adjustList(list,tag,style,ignoreEmpty){var nextList=list.nextSibling;if(nextList&&nextList.nodeType==1&&nextList.tagName.toLowerCase()==tag&&(getStyle(nextList)||domUtils.getStyle(nextList,"list-style-type")||(tag=="ol"?"decimal":"disc"))==style){domUtils.moveChild(nextList,list);if(nextList.childNodes.length==0){domUtils.remove(nextList);}}if(nextList&&domUtils.isFillChar(nextList)){domUtils.remove(nextList);}var preList=list.previousSibling;if(preList&&preList.nodeType==1&&preList.tagName.toLowerCase()==tag&&(getStyle(preList)||domUtils.getStyle(preList,"list-style-type")||(tag=="ol"?"decimal":"disc"))==style){domUtils.moveChild(list,preList);}if(preList&&domUtils.isFillChar(preList)){domUtils.remove(preList);}!ignoreEmpty&&domUtils.isEmptyBlock(list)&&domUtils.remove(list);}function setListStyle(list,style){if(customStyle[style]){list.className="custom_"+style;}if(style=="decimal"||style=="disc"){style="none";}try{domUtils.setStyle(list,"list-style-type",style);}catch(e){}}function clearEmptySibling(node){var tmpNode=node.previousSibling;if(tmpNode&&domUtils.isEmptyBlock(tmpNode)){domUtils.remove(tmpNode);}tmpNode=node.nextSibling;if(tmpNode&&domUtils.isEmptyBlock(tmpNode)){domUtils.remove(tmpNode);}}me.addListener("keydown",function(type,evt){function preventAndSave(){evt.preventDefault?evt.preventDefault():(evt.returnValue=false);me.fireEvent("contentchange");me.undoManger&&me.undoManger.save();}function findList(node,filterFn){while(node&&!domUtils.isBody(node)){if(filterFn(node)){return null;}if(node.nodeType==1&&/[ou]l/i.test(node.tagName)){return node;}node=node.parentNode;}return null;}var keyCode=evt.keyCode||evt.which;if(keyCode==13&&!evt.shiftKey){var range=me.selection.getRange(),start=findList(range.startContainer,function(node){return node.tagName=="TABLE";}),end=range.collapsed?start:findList(range.endContainer,function(node){return node.tagName=="TABLE";});if(start&&end&&start===end){if(!range.collapsed){start=domUtils.findParentByTagName(range.startContainer,"li",true);end=domUtils.findParentByTagName(range.endContainer,"li",true);if(start&&end&&start===end){range.deleteContents();li=domUtils.findParentByTagName(range.startContainer,"li",true);if(li&&domUtils.isEmptyBlock(li)){pre=li.previousSibling;next=li.nextSibling;p=me.document.createElement("p");domUtils.fillNode(me.document,p);parentList=li.parentNode;if(pre&&next){range.setStart(next,0).collapse(true).select(true);domUtils.remove(li);}else{if(!pre&&!next||!pre){parentList.parentNode.insertBefore(p,parentList);}else{li.parentNode.parentNode.insertBefore(p,parentList.nextSibling);}domUtils.remove(li);if(!parentList.firstChild){domUtils.remove(parentList);}range.setStart(p,0).setCursor();}preventAndSave();return;}}else{var tmpRange=range.cloneRange(),bk=tmpRange.collapse(false).createBookmark();range.deleteContents();tmpRange.moveToBookmark(bk);var li=domUtils.findParentByTagName(tmpRange.startContainer,"li",true);clearEmptySibling(li);tmpRange.select();preventAndSave();return;}}li=domUtils.findParentByTagName(range.startContainer,"li",true);if(li){if(domUtils.isEmptyBlock(li)){bk=range.createBookmark();var parentList=li.parentNode;if(li!==parentList.lastChild){domUtils.breakParent(li,parentList);clearEmptySibling(li);}else{parentList.parentNode.insertBefore(li,parentList.nextSibling);if(domUtils.isEmptyNode(parentList)){domUtils.remove(parentList);}}if(!dtd.$list[li.parentNode.tagName]){if(!domUtils.isBlockElm(li.firstChild)){p=me.document.createElement("p");li.parentNode.insertBefore(p,li);while(li.firstChild){p.appendChild(li.firstChild);}domUtils.remove(li);}else{domUtils.remove(li,true);}}range.moveToBookmark(bk).select();}else{var first=li.firstChild;if(!first||!domUtils.isBlockElm(first)){var p=me.document.createElement("p");!li.firstChild&&domUtils.fillNode(me.document,p);while(li.firstChild){p.appendChild(li.firstChild);}li.appendChild(p);first=p;}var span=me.document.createElement("span");range.insertNode(span);domUtils.breakParent(span,li);var nextLi=span.nextSibling;first=nextLi.firstChild;if(!first){p=me.document.createElement("p");domUtils.fillNode(me.document,p);nextLi.appendChild(p);first=p;}if(domUtils.isEmptyNode(first)){first.innerHTML="";domUtils.fillNode(me.document,first);}range.setStart(first,0).collapse(true).shrinkBoundary().select();domUtils.remove(span);var pre=nextLi.previousSibling;if(pre&&domUtils.isEmptyBlock(pre)){pre.innerHTML="<p></p>";domUtils.fillNode(me.document,pre.firstChild);}}preventAndSave();}}}if(keyCode==8){range=me.selection.getRange();if(range.collapsed&&domUtils.isStartInblock(range)){tmpRange=range.cloneRange().trimBoundary();li=domUtils.findParentByTagName(range.startContainer,"li",true);if(li&&domUtils.isStartInblock(tmpRange)){start=domUtils.findParentByTagName(range.startContainer,"p",true);if(start&&start!==li.firstChild){var parentList=domUtils.findParentByTagName(start,["ol","ul"]);domUtils.breakParent(start,parentList);clearEmptySibling(start);me.fireEvent("contentchange");range.setStart(start,0).setCursor(false,true);me.fireEvent("saveScene");domUtils.preventDefault(evt);return;}if(li&&(pre=li.previousSibling)){if(keyCode==46&&li.childNodes.length){return;}if(dtd.$list[pre.tagName]){pre=pre.lastChild;}me.undoManger&&me.undoManger.save();first=li.firstChild;if(domUtils.isBlockElm(first)){if(domUtils.isEmptyNode(first)){pre.appendChild(first);range.setStart(first,0).setCursor(false,true);while(li.firstChild){pre.appendChild(li.firstChild);}}else{span=me.document.createElement("span");range.insertNode(span);if(domUtils.isEmptyBlock(pre)){pre.innerHTML="";}domUtils.moveChild(li,pre);range.setStartBefore(span).collapse(true).select(true);domUtils.remove(span);}}else{if(domUtils.isEmptyNode(li)){var p=me.document.createElement("p");pre.appendChild(p);range.setStart(p,0).setCursor();}else{range.setEnd(pre,pre.childNodes.length).collapse().select(true);while(li.firstChild){pre.appendChild(li.firstChild);}}}domUtils.remove(li);me.fireEvent("contentchange");me.fireEvent("saveScene");domUtils.preventDefault(evt);return;}if(li&&!li.previousSibling){var parentList=li.parentNode;var bk=range.createBookmark();if(domUtils.isTagNode(parentList.parentNode,"ol ul")){parentList.parentNode.insertBefore(li,parentList);if(domUtils.isEmptyNode(parentList)){domUtils.remove(parentList);}}else{while(li.firstChild){parentList.parentNode.insertBefore(li.firstChild,parentList);}domUtils.remove(li);if(domUtils.isEmptyNode(parentList)){domUtils.remove(parentList);}}range.moveToBookmark(bk).setCursor(false,true);me.fireEvent("contentchange");me.fireEvent("saveScene");domUtils.preventDefault(evt);return;}}}}});me.addListener("tabkeydown",function(){function listToArray(list){var arr=[];for(var p in list){arr.push(p);}return arr;}var range=me.selection.getRange(),listStyle={"OL":listToArray(me.options.insertorderedlist),"UL":listToArray(me.options.insertunorderedlist)};function checkLevel(li){if(me.options.maxListLevel!=-1){var level=li.parentNode,levelNum=0;while(/[ou]l/i.test(level.tagName)){levelNum++;level=level.parentNode;}if(levelNum>=me.options.maxListLevel){return true;}}}var li=domUtils.findParentByTagName(range.startContainer,"li",true);if(li){var bk;if(range.collapsed){if(checkLevel(li)){return true;}var parentLi=li.parentNode,list=me.document.createElement(parentLi.tagName),index=utils.indexOf(listStyle[list.tagName],getStyle(parentLi)||domUtils.getComputedStyle(parentLi,"list-style-type"));index=index+1==listStyle[list.tagName].length?0:index+1;var currentStyle=listStyle[list.tagName][index];setListStyle(list,currentStyle);if(domUtils.isStartInblock(range)){me.fireEvent("saveScene");bk=range.createBookmark();parentLi.insertBefore(list,li);list.appendChild(li);adjustList(list,list.tagName.toLowerCase(),currentStyle);me.fireEvent("contentchange");range.moveToBookmark(bk).select(true);return true;}}else{me.fireEvent("saveScene");bk=range.createBookmark();for(var i=0,closeList,parents=domUtils.findParents(li),ci;ci=parents[i++];){if(domUtils.isTagNode(ci,"ol ul")){closeList=ci;break;}}var current=li;if(bk.end){while(current&&!(domUtils.getPosition(current,bk.end)&domUtils.POSITION_FOLLOWING)){if(checkLevel(current)){current=domUtils.getNextDomNode(current,false,null,function(node){return node!==closeList;});continue;}var parentLi=current.parentNode,list=me.document.createElement(parentLi.tagName),index=utils.indexOf(listStyle[list.tagName],getStyle(parentLi)||domUtils.getComputedStyle(parentLi,"list-style-type"));var currentIndex=index+1==listStyle[list.tagName].length?0:index+1;var currentStyle=listStyle[list.tagName][currentIndex];setListStyle(list,currentStyle);parentLi.insertBefore(list,current);while(current&&!(domUtils.getPosition(current,bk.end)&domUtils.POSITION_FOLLOWING)){li=current.nextSibling;list.appendChild(current);if(!li||domUtils.isTagNode(li,"ol ul")){if(li){while(li=li.firstChild){if(li.tagName=="LI"){break;}}}else{li=domUtils.getNextDomNode(current,false,null,function(node){return node!==closeList;});}break;}current=li;}adjustList(list,list.tagName.toLowerCase(),currentStyle);current=li;}}me.fireEvent("contentchange");range.moveToBookmark(bk).select();return true;}}});me.commands["insertorderedlist"]=me.commands["insertunorderedlist"]={execCommand:function(command,style){if(!style){style=command.toLowerCase()=="insertorderedlist"?"decimal":"disc";}var me=this,range=this.selection.getRange(),filterFn=function(node){return node.nodeType==1?node.tagName.toLowerCase()!="br":!domUtils.isWhitespace(node);},tag=command.toLowerCase()=="insertorderedlist"?"ol":"ul",frag=me.document.createDocumentFragment();range.adjustmentBoundary().shrinkBoundary();var bko=range.createBookmark(true),start=domUtils.findParentByTagName(me.document.getElementById(bko.start),"li"),modifyStart=0,end=domUtils.findParentByTagName(me.document.getElementById(bko.end),"li"),modifyEnd=0,startParent,endParent,list,tmp;if(start||end){start&&(startParent=start.parentNode);if(!bko.end){end=start;}end&&(endParent=end.parentNode);if(startParent===endParent){while(start!==end){tmp=start;start=start.nextSibling;if(!domUtils.isBlockElm(tmp.firstChild)){var p=me.document.createElement("p");while(tmp.firstChild){p.appendChild(tmp.firstChild);}tmp.appendChild(p);}frag.appendChild(tmp);}tmp=me.document.createElement("span");startParent.insertBefore(tmp,end);if(!domUtils.isBlockElm(end.firstChild)){p=me.document.createElement("p");while(end.firstChild){p.appendChild(end.firstChild);}end.appendChild(p);}frag.appendChild(end);domUtils.breakParent(tmp,startParent);if(domUtils.isEmptyNode(tmp.previousSibling)){domUtils.remove(tmp.previousSibling);}if(domUtils.isEmptyNode(tmp.nextSibling)){domUtils.remove(tmp.nextSibling);}var nodeStyle=getStyle(startParent)||domUtils.getComputedStyle(startParent,"list-style-type")||(command.toLowerCase()=="insertorderedlist"?"decimal":"disc");if(startParent.tagName.toLowerCase()==tag&&nodeStyle==style){for(var i=0,ci,tmpFrag=me.document.createDocumentFragment();ci=frag.childNodes[i++];){if(domUtils.isTagNode(ci,"ol ul")){utils.each(domUtils.getElementsByTagName(ci,"li"),function(li){while(li.firstChild){tmpFrag.appendChild(li.firstChild);}});}else{while(ci.firstChild){tmpFrag.appendChild(ci.firstChild);}}}tmp.parentNode.insertBefore(tmpFrag,tmp);}else{list=me.document.createElement(tag);setListStyle(list,style);list.appendChild(frag);tmp.parentNode.insertBefore(list,tmp);}domUtils.remove(tmp);list&&adjustList(list,tag,style);range.moveToBookmark(bko).select();return;}if(start){while(start){tmp=start.nextSibling;if(domUtils.isTagNode(start,"ol ul")){frag.appendChild(start);}else{var tmpfrag=me.document.createDocumentFragment(),hasBlock=0;while(start.firstChild){if(domUtils.isBlockElm(start.firstChild)){hasBlock=1;}tmpfrag.appendChild(start.firstChild);}if(!hasBlock){var tmpP=me.document.createElement("p");tmpP.appendChild(tmpfrag);frag.appendChild(tmpP);}else{frag.appendChild(tmpfrag);}domUtils.remove(start);}start=tmp;}startParent.parentNode.insertBefore(frag,startParent.nextSibling);if(domUtils.isEmptyNode(startParent)){range.setStartBefore(startParent);domUtils.remove(startParent);}else{range.setStartAfter(startParent);}modifyStart=1;}if(end&&domUtils.inDoc(endParent,me.document)){start=endParent.firstChild;while(start&&start!==end){tmp=start.nextSibling;if(domUtils.isTagNode(start,"ol ul")){frag.appendChild(start);}else{tmpfrag=me.document.createDocumentFragment();hasBlock=0;while(start.firstChild){if(domUtils.isBlockElm(start.firstChild)){hasBlock=1;}tmpfrag.appendChild(start.firstChild);}if(!hasBlock){tmpP=me.document.createElement("p");tmpP.appendChild(tmpfrag);frag.appendChild(tmpP);}else{frag.appendChild(tmpfrag);}domUtils.remove(start);}start=tmp;}var tmpDiv=domUtils.createElement(me.document,"div",{"tmpDiv":1});domUtils.moveChild(end,tmpDiv);frag.appendChild(tmpDiv);domUtils.remove(end);endParent.parentNode.insertBefore(frag,endParent);range.setEndBefore(endParent);if(domUtils.isEmptyNode(endParent)){domUtils.remove(endParent);}modifyEnd=1;}}if(!modifyStart){range.setStartBefore(me.document.getElementById(bko.start));}if(bko.end&&!modifyEnd){range.setEndAfter(me.document.getElementById(bko.end));}range.enlarge(true,function(node){return notExchange[node.tagName];});frag=me.document.createDocumentFragment();var bk=range.createBookmark(),current=domUtils.getNextDomNode(bk.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode,block=domUtils.isBlockElm;while(current&&current!==bk.end&&(domUtils.getPosition(current,bk.end)&domUtils.POSITION_PRECEDING)){if(current.nodeType==3||dtd.li[current.tagName]){if(current.nodeType==1&&dtd.$list[current.tagName]){while(current.firstChild){frag.appendChild(current.firstChild);}tmpNode=domUtils.getNextDomNode(current,false,filterFn);domUtils.remove(current);current=tmpNode;continue;}tmpNode=current;tmpRange.setStartBefore(current);while(current&&current!==bk.end&&(!block(current)||domUtils.isBookmarkNode(current))){tmpNode=current;current=domUtils.getNextDomNode(current,false,null,function(node){return !notExchange[node.tagName];});}if(current&&block(current)){tmp=domUtils.getNextDomNode(tmpNode,false,filterFn);if(tmp&&domUtils.isBookmarkNode(tmp)){current=domUtils.getNextDomNode(tmp,false,filterFn);tmpNode=tmp;}}tmpRange.setEndAfter(tmpNode);current=domUtils.getNextDomNode(tmpNode,false,filterFn);var li=range.document.createElement("li");li.appendChild(tmpRange.extractContents());if(domUtils.isEmptyNode(li)){var tmpNode=range.document.createElement("p");while(li.firstChild){tmpNode.appendChild(li.firstChild);}li.appendChild(tmpNode);}frag.appendChild(li);}else{current=domUtils.getNextDomNode(current,true,filterFn);}}range.moveToBookmark(bk).collapse(true);list=me.document.createElement(tag);setListStyle(list,style);list.appendChild(frag);range.insertNode(list);adjustList(list,tag,style,true);for(var i=0,ci,tmpDivs=domUtils.getElementsByTagName(list,"div");ci=tmpDivs[i++];){if(ci.getAttribute("tmpDiv")){domUtils.remove(ci,true);}}range.moveToBookmark(bko).select();},queryCommandState:function(command){var range=this.selection.getRange(),ps,tpl;if(range.collapsed){ps=domUtils.findParentByTagName(range.startContainer,"h2")||domUtils.findParentByTagName(range.endContainer,"h2");}else{ps=domUtils.findParentByTagName(range.startContainer,"h2");}if(ps){return -1;}if(!range.collapsed){tpl=domUtils.findTagNamesInSelection(range,["iframe"],function(node){return/-template/.test(node.className);});}if(tpl||this.graphictemplate.isSelect){return -1;}return domUtils.filterNodeList(this.selection.getStartElementPath(),command.toLowerCase()=="insertorderedlist"?"ol":"ul")?1:0;},queryCommandValue:function(command){var node=domUtils.filterNodeList(this.selection.getStartElementPath(),command.toLowerCase()=="insertorderedlist"?"ol":"ul");return node?getStyle(node)||domUtils.getComputedStyle(node,"list-style-type"):null;}};};UE.plugins["enterkey"]=function(){var hTag,me=this,tag=me.options.enterTag;me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(keyCode==13){var range=me.selection.getRange(),start=range.startContainer,doSave;if(!browser.ie){if(/h\d/i.test(hTag)){if(browser.gecko){var h=domUtils.findParentByTagName(start,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],true);if(!h){me.document.execCommand("formatBlock",false,"<p>");doSave=1;}}else{if(start.nodeType==1){var tmp=me.document.createTextNode(""),div;range.insertNode(tmp);div=domUtils.findParentByTagName(tmp,"div",true);if(div){var p=me.document.createElement("p");while(div.firstChild){p.appendChild(div.firstChild);}div.parentNode.insertBefore(p,div);domUtils.remove(div);range.setStartBefore(tmp).setCursor();doSave=1;}domUtils.remove(tmp);}}if(me.undoManger&&doSave){me.undoManger.save();}}browser.opera&&range.select();}setTimeout(function(){me.selection.getRange().scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0);},50);}});me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which;if(keyCode==13){if(me.undoManger){me.undoManger.save();}hTag="";var range=me.selection.getRange();if(!range.collapsed){var start=range.startContainer,end=range.endContainer,startTd=domUtils.findParentByTagName(start,"td",true),endTd=domUtils.findParentByTagName(end,"td",true);if(startTd&&endTd&&startTd!==endTd||!startTd&&endTd||startTd&&!endTd){evt.preventDefault?evt.preventDefault():(evt.returnValue=false);return;}}if(tag=="p"){if(!browser.ie){start=domUtils.findParentByTagName(range.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],true);if(!start&&!browser.opera){me.document.execCommand("formatBlock",false,"<p>");if(browser.gecko){range=me.selection.getRange();start=domUtils.findParentByTagName(range.startContainer,"p",true);start&&domUtils.removeDirtyAttr(start);}}else{hTag=start.tagName;start.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(start);}}}else{evt.preventDefault?evt.preventDefault():(evt.returnValue=false);if(!range.collapsed){range.deleteContents();start=range.startContainer;if(start.nodeType==1&&(start=start.childNodes[range.startOffset])){while(start.nodeType==1){if(dtd.$empty[start.tagName]){range.setStartBefore(start).setCursor();if(me.undoManger){me.undoManger.save();}return false;}if(!start.firstChild){var br=range.document.createElement("br");start.appendChild(br);range.setStart(start,0).setCursor();if(me.undoManger){me.undoManger.save();}return false;}start=start.firstChild;}if(start===range.startContainer.childNodes[range.startOffset]){br=range.document.createElement("br");range.insertNode(br).setCursor();}else{range.setStart(start,0).setCursor();}}else{br=range.document.createElement("br");range.insertNode(br).setStartAfter(br).setCursor();}}else{br=range.document.createElement("br");range.insertNode(br);var parent=br.parentNode;if(parent.lastChild===br){br.parentNode.insertBefore(br.cloneNode(true),br);range.setStartBefore(br);}else{range.setStartAfter(br);}range.setCursor();}}}});};UE.plugins["keystrokes"]=function(){var me=this;me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which,rng=me.selection.getRange();if(!rng.collapsed&&!(evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey||keyCode==9)){var tmpNode=rng.startContainer;if(domUtils.isFillChar(tmpNode)){rng.setStartBefore(tmpNode);}tmpNode=rng.endContainer;if(domUtils.isFillChar(tmpNode)){rng.setEndAfter(tmpNode);}rng.txtToElmBoundary();if(rng.endContainer&&rng.endContainer.nodeType==1){tmpNode=rng.endContainer.childNodes[rng.endOffset];if(tmpNode&&domUtils.isBr(tmpNode)){rng.setEndAfter(tmpNode);}}if(rng.startOffset==0){tmpNode=rng.startContainer;if(domUtils.isBoundaryNode(tmpNode,"firstChild")){tmpNode=rng.endContainer;if(rng.endOffset==(tmpNode.nodeType==3?tmpNode.nodeValue.length:tmpNode.childNodes.length)&&domUtils.isBoundaryNode(tmpNode,"lastChild")){me.fireEvent("saveScene");me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";rng.setStart(me.body.firstChild,0).setCursor(false,true);browser.ie&&me._selectionChange();domUtils.preventDefault(evt);return;}}}}if(keyCode==8){rng=me.selection.getRange();var start,end;if(rng.collapsed&&rng.inFillChar()){start=rng.startContainer;if(domUtils.isFillChar(start)){rng.setStartBefore(start).shrinkBoundary(true).collapse(true);domUtils.remove(start);}else{start.nodeValue=start.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"");rng.startOffset--;rng.collapse(true).select(true);}}if(start=rng.getClosedNode()){me.fireEvent("saveScene");rng.setStartBefore(start);domUtils.remove(start);rng.setCursor();me.fireEvent("saveScene");domUtils.preventDefault(evt);return;}if(!browser.ie){start=domUtils.findParentByTagName(rng.startContainer,"table",true);end=domUtils.findParentByTagName(rng.endContainer,"table",true);if(start&&!end||!start&&end||start!==end){evt.preventDefault();return;}}}if(keyCode==9){var excludeTagNameForTabKey={"ol":1,"ul":1,"table":1};if(me.fireEvent("tabkeydown")){domUtils.preventDefault(evt);return;}var range=me.selection.getRange();me.fireEvent("saveScene");for(var i=0,txt="",tabSize=me.options.tabSize||4,tabNode=me.options.tabNode||"&nbsp;";i<tabSize;i++){txt+=tabNode;}var span=me.document.createElement("span");span.innerHTML=txt+domUtils.fillChar;if(range.collapsed){range.insertNode(span.cloneNode(true).firstChild).setCursor(true);}else{start=domUtils.findParent(range.startContainer,filterFn);end=domUtils.findParent(range.endContainer,filterFn);if(start&&end&&start===end){range.deleteContents();range.insertNode(span.cloneNode(true).firstChild).setCursor(true);}else{var bookmark=range.createBookmark(),filterFn=function(node){return domUtils.isBlockElm(node)&&!excludeTagNameForTabKey[node.tagName.toLowerCase()];};range.enlarge(true);var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,false,filterFn);while(current&&!(domUtils.getPosition(current,bookmark2.end)&domUtils.POSITION_FOLLOWING)){current.insertBefore(span.cloneNode(true).firstChild,current.firstChild);current=domUtils.getNextDomNode(current,false,filterFn);}range.moveToBookmark(bookmark2).moveToBookmark(bookmark).select();}}domUtils.preventDefault(evt);}if(browser.gecko&&keyCode==46){range=me.selection.getRange();if(range.collapsed){start=range.startContainer;if(domUtils.isEmptyBlock(start)){var parent=start.parentNode;while(domUtils.getChildCount(parent)==1&&!domUtils.isBody(parent)){start=parent;parent=parent.parentNode;}if(start===parent.lastChild){evt.preventDefault();}return;}}}});me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which,rng;if(keyCode==8){rng=me.selection.getRange();if(rng.collapsed){var tmpNode,autoClearTagName=["h1","h2","h3","h4","h5","h6"];if(tmpNode=domUtils.findParentByTagName(rng.startContainer,autoClearTagName,true)){if(domUtils.isEmptyBlock(tmpNode)){var pre=tmpNode.previousSibling;if(pre&&pre.nodeName!="TABLE"){domUtils.remove(tmpNode);rng.setStartAtLast(pre).setCursor(false,true);return;}else{var next=tmpNode.nextSibling;if(next&&next.nodeName!="TABLE"){domUtils.remove(tmpNode);rng.setStartAtFirst(next).setCursor(false,true);return;}}}}if(domUtils.isBody(rng.startContainer)){var tmpNode=domUtils.createElement(me.document,"p",{"innerHTML":browser.ie?domUtils.fillChar:"<br/>"});rng.insertNode(tmpNode).setStart(tmpNode,0).setCursor(false,true);}}if((rng.startContainer.nodeType==3||rng.startContainer.nodeType==1&&domUtils.isEmptyBlock(rng.startContainer))){if(browser.ie){var span=rng.document.createElement("span");rng.insertNode(span).setStartBefore(span).collapse(true);rng.select();domUtils.remove(span);}else{rng.select();}}}});};UE.plugins["fiximgclick"]=function(){var me=this;if(browser.webkit){me.addListener("click",function(type,e){if(e.target.tagName=="IMG"){var range=new dom.Range(me.document);range.selectNode(e.target).select();}});}};UE.plugins["autoheight"]=function(){var me=this;me.autoHeightEnabled=me.options.autoHeightEnabled!==false;if(!me.autoHeightEnabled){return;}var bakOverflow,span,tmpNode,lastHeight=0,options=me.options,currentHeight,timer;function adjustHeight(){var me=this;clearTimeout(timer);if(isFullscreen){return;}timer=setTimeout(function(){if(me.queryCommandState&&me.queryCommandState("source")!=1){if(!span){span=me.document.createElement("span");span.style.cssText="display:block;width:0;height:0;margin:0;padding:0;border:0;clear:both;";span.innerHTML=".";}tmpNode=span.cloneNode(true);me.body.appendChild(tmpNode);currentHeight=Math.max(domUtils.getXY(tmpNode).y+tmpNode.offsetHeight,Math.max(options.minFrameHeight,options.initialFrameHeight));if(currentHeight!=lastHeight){me.setHeight(currentHeight);lastHeight=currentHeight;}domUtils.remove(tmpNode);}},0);}var isFullscreen;me.addListener("fullscreenchanged",function(cmd,f){isFullscreen=f;});me.addListener("destroy",function(){me.removeListener("contentchange",adjustHeight);me.removeListener("autoHeight",adjustHeight);me.removeListener("afterinserthtml",adjustHeight);me.removeListener("keyup",adjustHeight);me.removeListener("mouseup",adjustHeight);});me.enableAutoHeight=function(){if(!me.autoHeightEnabled){return;}var doc=me.document;me.autoHeightEnabled=true;bakOverflow=doc.body.style.overflowY;doc.body.style.overflowY="hidden";me.addListener("contentchange",adjustHeight);me.addListener("autoHeight",adjustHeight);me.addListener("afterinserthtml",adjustHeight);me.addListener("keyup",adjustHeight);me.addListener("mouseup",adjustHeight);setTimeout(function(){adjustHeight.call(this);},browser.gecko?100:0);me.fireEvent("autoheightchanged",me.autoHeightEnabled);};me.disableAutoHeight=function(){me.body.style.overflowY=bakOverflow||"";me.removeListener("contentchange",adjustHeight);me.removeListener("autoHeight",adjustHeight);me.removeListener("keyup",adjustHeight);me.removeListener("mouseup",adjustHeight);me.autoHeightEnabled=false;me.fireEvent("autoheightchanged",me.autoHeightEnabled);};me.addListener("ready",function(){me.enableAutoHeight();var timer;domUtils.on(browser.ie?me.body:me.document,browser.webkit?"dragover":"drop",function(){clearTimeout(timer);timer=setTimeout(function(){adjustHeight.call(this);},100);});});};UE.plugins["autofloat"]=function(){var me=this,lang=me.getLang();me.setOpt({topOffset:0});var optsAutoFloatEnabled=me.options.autoFloatEnabled!==false,topOffset=me.options.topOffset;if(!optsAutoFloatEnabled){return;}var uiUtils=UE.ui.uiUtils,LteIE6=browser.ie&&browser.version<=6,quirks=browser.quirks;function checkHasUI(editor){if(!editor.ui){alert(lang.autofloatMsg);return 0;}return 1;}function fixIE6FixedPos(){var docStyle=document.body.style;docStyle.backgroundImage='url("about:blank")';docStyle.backgroundAttachment="fixed";}var bakCssText,placeHolder=document.createElement("div"),toolbarBox,orgTop,getPosition,flag=true;function setFloating(){var toobarBoxPos=domUtils.getXY(toolbarBox),origalFloat=domUtils.getComputedStyle(toolbarBox,"position"),origalLeft=domUtils.getComputedStyle(toolbarBox,"left");toolbarBox.style.width=toolbarBox.offsetWidth+"px";toolbarBox.style.zIndex=me.options.zIndex*1+1;toolbarBox.parentNode.insertBefore(placeHolder,toolbarBox);if(LteIE6||(quirks&&browser.ie)){if(toolbarBox.style.position!="absolute"){toolbarBox.style.position="absolute";}toolbarBox.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-orgTop+topOffset+"px";}else{if(browser.ie7Compat&&flag){flag=false;toolbarBox.style.left=domUtils.getXY(toolbarBox).x-document.documentElement.getBoundingClientRect().left+2+"px";}if(toolbarBox.style.position!="fixed"){toolbarBox.style.position="fixed";toolbarBox.style.top=topOffset+"px";((origalFloat=="absolute"||origalFloat=="relative")&&parseFloat(origalLeft))&&(toolbarBox.style.left=toobarBoxPos.x+"px");}}}function unsetFloating(){flag=true;if(placeHolder.parentNode){placeHolder.parentNode.removeChild(placeHolder);}toolbarBox.style.cssText=bakCssText;}function updateFloating(){var rect3=getPosition(me.container);var offset=me.options.toolbarTopOffset||0;if(rect3.top<0&&rect3.bottom-toolbarBox.offsetHeight>offset){setFloating();me.fireEvent("setfloat");}else{unsetFloating();me.fireEvent("unsetfloat");}}var defer_updateFloating=utils.defer(function(){updateFloating();},browser.ie?200:100,true);me.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],updateFloating);me.removeListener("keydown",defer_updateFloating);});me.addListener("ready",function(){if(checkHasUI(me)){getPosition=uiUtils.getClientRect;toolbarBox=me.ui.getDom("toolbarbox");orgTop=getPosition(toolbarBox).top;bakCssText=toolbarBox.style.cssText;placeHolder.style.height=toolbarBox.offsetHeight+"px";if(LteIE6){fixIE6FixedPos();}domUtils.on(window,["scroll","resize"],updateFloating);me.addListener("keydown",defer_updateFloating);me.addListener("beforefullscreenchange",function(t,enabled){if(enabled){unsetFloating();}});me.addListener("fullscreenchanged",function(t,enabled){if(!enabled){updateFloating();}});me.addListener("sourcemodechanged",function(t,enabled){setTimeout(function(){updateFloating();},0);});me.addListener("clearDoc",function(){setTimeout(function(){updateFloating();},0);});}});};UE.plugins["pasteplain"]=function(){var me=this;me.setOpt({"pasteplain":false,"filterTxtRules":function(){function transP(node){node.tagName="p";node.setStyle();}return{"-":"script style object iframe embed input select","p":{$:{}},"br":{$:{}},div:function(node){var tmpNode,p=UE.uNode.createElement("p");while(tmpNode=node.firstChild()){if(tmpNode.type=="text"||!UE.dom.dtd.$block[tmpNode.tagName]){p.appendChild(tmpNode);}else{if(p.firstChild()){node.parentNode.insertBefore(p,node);p=UE.uNode.createElement("p");}else{node.parentNode.insertBefore(tmpNode,node);}}}if(p.firstChild()){node.parentNode.insertBefore(p,node);}node.parentNode.removeChild(node);},ol:function(node){node.parentNode.removeChild(node,true);},ul:function(node){node.parentNode.removeChild(node,true);},dl:function(node){node.parentNode.removeChild(node,true);},dt:function(node){node.parentNode.removeChild(node,true);},dd:function(node){node.parentNode.removeChild(node,true);},"li":function(node){node.parentNode.removeChild(node,true);},"caption":transP,"th":transP,"tr":transP,"h1":transP,"h2":transP,"h3":transP,"h4":transP,"h5":transP,"h6":transP,"img":function(node){var src=node.getAttr("src");var reg=/(http:)?\/\/hiphotos.baidu.com\/exp\/pic\/item\S*.jpg/ig;if(!reg.test(src)){node.parentNode.removeChild(node,true);}},"td":function(node){var txt=!!node.innerText();if(txt){node.parentNode.insertAfter(UE.uNode.createText(" &nbsp; &nbsp;"),node);}node.parentNode.removeChild(node,node.innerText());}};}()});var pasteplain=me.options.pasteplain;me.commands["pasteplain"]={queryCommandState:function(){return pasteplain;},execCommand:function(){pasteplain=!pasteplain|0;},notNeedUndo:1};};UE.plugins["video"]=function(){var me=this,div;function creatInsertStr(url,width,height,align,toEmbed,addParagraph){return !toEmbed?(addParagraph?("<p "+(align&&align!="none"?(align=="center"?' style="text-align:center;" ':' style="float:"'+align):"")+">"):"")+'<img align="'+align+'" width="'+width+'" height="'+height+'" _url="'+url+'" class="edui-faked-video"'+' src="'+me.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+me.options.UEDITOR_HOME_URL+'themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;" />'+(addParagraph?"</p>":""):'<embed type="application/x-shockwave-flash" class="edui-faked-video" pluginspage="http://www.macromedia.com/go/getflashplayer"'+' src="'+url+'" width="'+width+'" height="'+height+'" align="'+align+'"'+(align&&align!="none"?' style= "'+(align=="center"?"display:block;":" float: "+align)+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >';}function switchImgAndEmbed(root,img2embed){utils.each(root.getNodesByTagName(img2embed?"img":"embed"),function(node){if(node.getAttr("class")=="edui-faked-video"){var align=node.getStyle("float");align=align=="none"?(node.getAttr("align")||""):align;var html=creatInsertStr(img2embed?node.getAttr("_url"):node.getAttr("src"),node.getAttr("width"),node.getAttr("height"),align,img2embed);node.parentNode.replaceChild(UE.uNode.createElement(html),node);}});}me.addOutputRule(function(root){switchImgAndEmbed(root,true);});me.addInputRule(function(root){switchImgAndEmbed(root);});me.commands["insertvideo"]={execCommand:function(cmd,videoObjs){videoObjs=utils.isArray(videoObjs)?videoObjs:[videoObjs];var html=[];for(var i=0,vi,len=videoObjs.length;i<len;i++){vi=videoObjs[i];html.push(creatInsertStr(vi.url,vi.width||420,vi.height||280,"center",false,true));}me.execCommand("inserthtml",html.join(""),true);},queryCommandState:function(){var img=me.selection.getRange().getClosedNode(),flag=img&&(img.className=="edui-faked-video");return flag?1:0;}};};UE.plugins["basestyle"]=function(){var basestyles={"bold":["strong","b"],"italic":["em","i"],"subscript":["sub"],"superscript":["sup"]},getObj=function(editor,tagNames){return domUtils.filterNodeList(editor.selection.getStartElementPath(),tagNames);},me=this;me.addshortcutkey({"Bold":"ctrl+66","Italic":"ctrl+73","Underline":"ctrl+85"});me.addInputRule(function(root){utils.each(root.getNodesByTagName("b i"),function(node){switch(node.tagName){case"b":node.tagName="strong";break;case"i":node.tagName="em";}});});for(var style in basestyles){(function(cmd,tagNames){me.commands[cmd]={execCommand:function(cmdName){var range=me.selection.getRange(),obj=getObj(this,tagNames);if(range.collapsed){if(obj){var tmpText=me.document.createTextNode("");range.insertNode(tmpText).removeInlineStyle(tagNames);range.setStartBefore(tmpText);domUtils.remove(tmpText);}else{var tmpNode=range.document.createElement(tagNames[0]);if(cmdName=="superscript"||cmdName=="subscript"){tmpText=me.document.createTextNode("");range.insertNode(tmpText).removeInlineStyle(["sub","sup"]).setStartBefore(tmpText).collapse(true);}range.insertNode(tmpNode).setStart(tmpNode,0);}range.collapse(true);}else{if(cmdName=="superscript"||cmdName=="subscript"){if(!obj||obj.tagName.toLowerCase()!=cmdName){range.removeInlineStyle(["sub","sup"]);}}obj?range.removeInlineStyle(tagNames):range.applyInlineStyle(tagNames[0]);}range.select();},queryCommandState:function(){return getObj(this,["h2","iframe"])?-1:(getObj(this,tagNames)?1:0);}};})(style,basestyles[style]);}};var ueditor=baidu.editor||{},domUtils=baidu.editor.dom.domUtils,utils=baidu.editor.utils,browser=baidu.editor.browser;UE.plugins["heading"]=function(){var me=this;me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which,h;if(keyCode==13){var range=me.selection.getRange();if(range.collapsed&&(h=domUtils.findParentByTagName(range.startContainer,["h2","h3"],true))){var p=me.document.createElement("p");p.innerHTML=baidu.editor.browser.ie?"":"<br/>";if(h.nextSibling){h.parentNode.insertBefore(p,h.nextSibling);}else{h.parentNode.appendChild(p);}range.setStart(p,0).setCursor();evt.preventDefault?evt.preventDefault():(evt.returnValue=false);}}});me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(keyCode==13){var range=me.selection.getRange(),start=domUtils.isFillChar(range.startContainer)?range.startContainer.parentNode:range.startContainer,pre=start.previousSibling;if(pre&&pre.nodeType==1&&(pre.tagName=="H2"||pre.tagName=="H3")&&domUtils.isEmptyNode(pre)){domUtils.remove(pre);}evt.preventDefault?evt.preventDefault():(evt.returnValue=false);}});var tagMap={"heading1":"h2"};var maxLength=100;function showTextLimit(text){text=text.replace(/(^\s*)|(\s*$)/g,"").replace(new RegExp(domUtils.fillChar,"g"),"");return 1;}UE.commands["heading1"]=UE.commands["heading2"]={execCommand:function(cmd){var tag=tagMap[cmd];var oldH2Dtd=baidu.editor.dom.dtd[tag],me=this;baidu.editor.dom.dtd[tag]={"#":1,"SPAN":1,"span":1};var state=this.queryCommandState(cmd),range=this.selection.getRange(),bm=range.createBookmark(true),h2=domUtils.findTagNamesInSelection(range,["h2"]),h3=domUtils.findTagNamesInSelection(range,["h3"]);if(!range.collapsed){var text=this.selection.getText();if(!showTextLimit(text)){return false;}}if(h2&&!(cmd=="heading2"&&state)){remove(range,"h2");}if(h3&&!(cmd=="heading1"&&state)){remove(range,"h3");}if(state){range.select();return;}function remove(range,tag){range.enlarge(true);var bookmark2=range.createBookmark(true),filterFn=function(node){return node.nodeType==1&&node.tagName.toLowerCase()==tag;},current=domUtils.getNextDomNode(me.document.getElementById(bookmark2.start),false),end=me.document.getElementById(bookmark2.end);while(current&&!(domUtils.getPosition(current,end)&domUtils.POSITION_FOLLOWING)){if(current.nodeType==1&&current.tagName.toLowerCase()==tag){var p=me.document.createElement("p");while(current.firstChild){p.appendChild(current.firstChild);}current.parentNode.insertBefore(p,current);domUtils.remove(current);current=domUtils.getNextDomNode(p,false,filterFn);}else{current=domUtils.getNextDomNode(current,current.nodeType==3?false:true,filterFn);}}range.moveToBookmark(bookmark2);bookmark2=null;bm&&range.moveToBookmark(bm);bm=null;}if(!range.collapsed){range.select();this.execCommand("removeformat");range=this.selection.getRange();}if(range.collapsed){range.enlarge(true);var startElem=domUtils.findStartElement(range,function(e){return e.nodeName=="P";});}range.applyInlineStyle(tag);bm&&range.moveToBookmark(bm);var node=range.startContainer,collapsed=range.collapsed;range.collapse(false);bm=range.createBookmark(true);var hs=domUtils.getElementsByTagName(this.document,tag),start,end;start=me.document.getElementById(bm.start);if(bm.end){end=me.document.getElementById(bm.end);}for(var i=0,hi;hi=hs[i++];){if(!domUtils.isBody(hi.parentNode)&&hi.parentNode.tagName=="P"){domUtils.breakParent(hi,hi.parentNode);var pre=hi.previousSibling,next=hi.nextSibling;if(pre&&domUtils.isEmptyBlock(pre)){if(!(start&&start.parentNode===pre||end&&end.parentNode===pre)){domUtils.remove(pre);}}if(pre&&/^[\xa0\s\u3000]*$/.test(pre[browser.ie?"innerText":"textContent"])){domUtils.remove(pre);}if(next&&domUtils.isEmptyBlock(next)){if(!(start&&start.parentNode===next||end&&end.parentNode===next)){domUtils.remove(next);}}}var first=hi.firstChild;if(first&&domUtils.isBookmarkNode(first)){first=first.nextSibling;}while(first&&first.nodeType==3){if(!first.data.replace(/[\xa0\s\u3000]*/,"").length){var tmpNode=first.nextSibling;domUtils.remove(first);first=tmpNode;}else{first.data=first.data.replace(/^[\xa0\s\u3000]*/,"");break;}}var last=hi.lastChild;if(last&&domUtils.isBookmarkNode(last)){last=last.previousSibling;}while(last&&last.nodeType==3){if(!last.data.replace(/[\xa0\s\u3000]*/,"").length){tmpNode=last.previousSibling;domUtils.remove(last);last=tmpNode;}else{last.data=last.data.replace(/[\xa0\s\u3000]*$/,"");break;}}}if(bm.start){start=me.document.getElementById(bm.start);if(start&&domUtils.getChildCount(start,function(node){return !domUtils.isBr(node)&&!domUtils.isWhitespace(node)&&domUtils.isBookmarkNode(node);})==1){if(!domUtils.isBody(start.parentNode)){domUtils.remove(start.parentNode,true);}}}if(bm.end){end=me.document.getElementById(bm.end);if(end&&domUtils.getChildCount(end,function(node){return !domUtils.isBr(node)&&!domUtils.isWhitespace(node)&&domUtils.isBookmarkNode(node);})==1){if(!domUtils.isBody(end.parentNode)){domUtils.remove(end.parentNode,true);}}}range.moveToBookmark(bm).select(true);bm=null;if(domUtils.isEmptyBlock(range.startContainer)){range.startContainer.innerHTML=domUtils.fillChar;}utils.each(domUtils.getElementsByTagName(me.document,"h2"),function(node){utils.each(domUtils.getElementsByTagName(node,"span"),function(span){domUtils.remove(span);});});utils.each(domUtils.getElementsByTagName(me.document,"p"),function(node){if(node&&!node.childNodes.length){node.parentNode.removeChild(node);}});baidu.editor.dom.dtd[tag]=oldH2Dtd;},queryCommandState:function(cmd){var range=this.selection.getRange();var range2=range.cloneRange();if(range.collapsed&&range2.startContainer.nodeType==3){range2.setStart(range2.startContainer.parentNode,0);range2.setEndAfter(range2.startContainer);}var rs=domUtils.findTagNamesInSelection(range2,["li","img","iframe","sup","td","th","caption","em","i","strong","b"]);if(rs){return -1;}if(cmd=="heading1"&&me.selection.getStart().tagName=="H2"){return 1;}return 0;}};};UE.plugins["graphictemplate"]=function(){var me=this;me["graphictemplate"]={};var tpl=me["graphictemplate"];tpl.id="graphictemplate-0";tpl.dataList={};tpl.template="<p contenteditable='false'><iframe  width='678' height='300' align='center' scroling='no' frameborder='0'  "+"class='%%' "+"id='##' "+"src='$$' "+"></iframe></p>";me.commands["graphictemplate"]={execCommand:function(cmd,value){tpl.id=tpl.id.replace(/\d/g,function(id){id=parseInt(id)+1;return id;});var ifr=tpl.template.replace("%%",value+"-template").replace("##",tpl.id).replace("$$",me.options["graphictemplateUrlMap"][value]);me.execCommand("inserthtml",ifr);},queryCommandState:function(){var rng=this.selection.getRange().cloneRange();if(rng.collapsed&&rng.startContainer.nodeType==3){rng.trimBoundary();}var rs=domUtils.findTagNamesInSelection(rng,["li","img","iframe","sup","td","th","caption","em","i","strong","b"]);if(rs){return -1;}return 0;}};me.addOutputRule(function(root){utils.each(root.getNodesByTagName("iframe"),function(node){var val=node.getAttr("class");if(val&&/-template/.test(val)){var id=node.getAttr("id");var str=utils.stringify(me["graphictemplate"].dataList[id]);node.tagName="pre";var attrs={"class":node.getAttr("class"),"hasempty":node.getAttr("hasempty"),"id":id};node.setAttr();node.setAttr(attrs);node.children=[];node.appendChild(UE.uNode.createText(str));var parent=node.parentNode;parent.parentNode.replaceChild(node,parent);}});});me.addInputRule(function(root){var me=this,tpl=me.graphictemplate;utils.each(root.getNodesByTagName("pre"),function(pi){var val=pi.getAttr("class");if(val&&/-template/.test(val)){tpl.id=pi.getAttr("id");me.graphictemplate.dataList[tpl.id]=(new Function("return ("+pi.innerHTML()+")"))();var html=tpl.template.replace("%%",val).replace("##",tpl.id).replace("$$",me.options.graphictemplateUrlMap[val.replace("-template","")]);var node=UE.uNode.createElement(html);pi.parentNode.replaceChild(node,pi);}});});var attrs={heightStorage:[],hasemptyStorage:[]};me.addListener("beforegetscene",function(){attrs={heightStorage:[],hasemptyStorage:[]};var list=domUtils.getElementsByTagName(me.body,"iframe",function(node){return domUtils.hasClass(node,"-template");});utils.each(list,function(node){var tmp=node.getAttribute("height");attrs.heightStorage.push(tmp);tmp=node.getAttribute("hasempty");attrs.hasemptyStorage.push(tmp);node.setAttribute("height",300);node.removeAttribute("hasempty");});});me.addListener("aftergetscene",function(){if(attrs.heightStorage.length){var list=domUtils.getElementsByTagName(me.body,"iframe",function(node){return domUtils.hasClass(node,"-template");});utils.each(list,function(node,i){node.setAttribute("height",attrs.heightStorage[i]);node.setAttribute("hasempty",attrs.hasemptyStorage[i]);});}});tpl.isSelect=false;tpl.currentTemplate=null;tpl.templateAction=function(win){var doc=win.document;domUtils.on(doc,"click",function(e){var tgt=e.target||e.srcElement;tpl.currentTemplate=win.frameElement;switch(tgt.id){case"J_drag":doc.getElementById("J_mask").style.cssText="height:"+tpl.currentTemplate.height+"px;display:block;width:"+tpl.currentTemplate.width+"px";me.graphictemplate.isSelect=true;break;case"J_close":domUtils.remove(tpl.currentTemplate.parentNode);break;}});};me.addListener("click",function(){var ifr=tpl.currentTemplate;if(tpl.isSelect&&ifr){var rng=me.selection.getRange();var node=domUtils.findParentByTagName(rng.startContainer,"li");if(node){me.body.style.cursor="not-allowed";}else{me.execCommand("inserthtml",ifr.parentNode.outerHTML);domUtils.remove(ifr.parentNode);}tpl.isSelect=false;}else{me.body.style.cursor="default";}autoClearData();});tpl.iframeAutoHeight=function(frameElement){if(browser.ie&&browser.version<8){frameElement.height=frameElement.Document.body.scrollHeight;}else{frameElement.height=frameElement.contentDocument.body.scrollHeight;}me.fireEvent("autoHeight");};function autoClearData(){var dataList=tpl.dataList;var doc=me.document;for(var pro in dataList){var node=doc.getElementById(pro);if(!node){delete tpl.dataList[pro];}}}};var baidu=baidu||{};baidu.editor=baidu.editor||{};baidu.editor.ui={};(function(){var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils;var magic="$EDITORUI";var root=window[magic]={};var uidMagic="ID"+magic;var uidCount=0;var uiUtils=baidu.editor.ui.uiUtils={uid:function(obj){return(obj?obj[uidMagic]||(obj[uidMagic]=++uidCount):++uidCount);},hook:function(fn,callback){var dg;if(fn&&fn._callbacks){dg=fn;}else{dg=function(){var q;if(fn){q=fn.apply(this,arguments);}var callbacks=dg._callbacks;var k=callbacks.length;while(k--){var r=callbacks[k].apply(this,arguments);if(q===undefined){q=r;}}return q;};dg._callbacks=[];}dg._callbacks.push(callback);return dg;},createElementByHtml:function(html){var el=document.createElement("div");el.innerHTML=html;el=el.firstChild;el.parentNode.removeChild(el);return el;},getViewportElement:function(){return(browser.ie&&browser.quirks)?document.body:document.documentElement;},getClientRect:function(element){var bcr;try{bcr=element.getBoundingClientRect();}catch(e){bcr={left:0,top:0,height:0,width:0};}var rect={left:Math.round(bcr.left),top:Math.round(bcr.top),height:Math.round(bcr.bottom-bcr.top),width:Math.round(bcr.right-bcr.left)};var doc;while((doc=element.ownerDocument)!==document&&(element=domUtils.getWindow(doc).frameElement)){bcr=element.getBoundingClientRect();rect.left+=bcr.left;rect.top+=bcr.top;}rect.bottom=rect.top+rect.height;rect.right=rect.left+rect.width;return rect;},getViewportRect:function(){var viewportEl=uiUtils.getViewportElement();var width=(window.innerWidth||viewportEl.clientWidth)|0;var height=(window.innerHeight||viewportEl.clientHeight)|0;return{left:0,top:0,height:height,width:width,bottom:height,right:width};},setViewportOffset:function(element,offset){var rect;var fixedLayer=uiUtils.getFixedLayer();if(element.parentNode===fixedLayer){element.style.left=offset.left+"px";element.style.top=offset.top+"px";}else{domUtils.setViewportOffset(element,offset);}},getEventOffset:function(evt){var el=evt.target||evt.srcElement;var rect=uiUtils.getClientRect(el);var offset=uiUtils.getViewportOffsetByEvent(evt);return{left:offset.left-rect.left,top:offset.top-rect.top};},getViewportOffsetByEvent:function(evt){var el=evt.target||evt.srcElement;var frameEl=domUtils.getWindow(el).frameElement;var offset={left:evt.clientX,top:evt.clientY};if(frameEl&&el.ownerDocument!==document){var rect=uiUtils.getClientRect(frameEl);offset.left+=rect.left;offset.top+=rect.top;}return offset;},setGlobal:function(id,obj){root[id]=obj;return magic+'["'+id+'"]';},unsetGlobal:function(id){delete root[id];},copyAttributes:function(tgt,src){var attributes=src.attributes;var k=attributes.length;while(k--){var attrNode=attributes[k];if(attrNode.nodeName!="style"&&attrNode.nodeName!="class"&&(!browser.ie||attrNode.specified)){tgt.setAttribute(attrNode.nodeName,attrNode.nodeValue);}}if(src.className){domUtils.addClass(tgt,src.className);}if(src.style.cssText){tgt.style.cssText+=";"+src.style.cssText;}},removeStyle:function(el,styleName){if(el.style.removeProperty){el.style.removeProperty(styleName);}else{if(el.style.removeAttribute){el.style.removeAttribute(styleName);}else{throw"";}}},contains:function(elA,elB){return elA&&elB&&(elA===elB?false:(elA.contains?elA.contains(elB):elA.compareDocumentPosition(elB)&16));},startDrag:function(evt,callbacks,doc){var doc=doc||document;var startX=evt.clientX;var startY=evt.clientY;function handleMouseMove(evt){var x=evt.clientX-startX;var y=evt.clientY-startY;callbacks.ondragmove(x,y,evt);if(evt.stopPropagation){evt.stopPropagation();}else{evt.cancelBubble=true;}}if(doc.addEventListener){function handleMouseUp(evt){doc.removeEventListener("mousemove",handleMouseMove,true);doc.removeEventListener("mouseup",handleMouseUp,true);window.removeEventListener("mouseup",handleMouseUp,true);callbacks.ondragstop();}doc.addEventListener("mousemove",handleMouseMove,true);doc.addEventListener("mouseup",handleMouseUp,true);window.addEventListener("mouseup",handleMouseUp,true);evt.preventDefault();}else{var elm=evt.srcElement;elm.setCapture();function releaseCaptrue(){elm.releaseCapture();elm.detachEvent("onmousemove",handleMouseMove);elm.detachEvent("onmouseup",releaseCaptrue);elm.detachEvent("onlosecaptrue",releaseCaptrue);callbacks.ondragstop();}elm.attachEvent("onmousemove",handleMouseMove);elm.attachEvent("onmouseup",releaseCaptrue);elm.attachEvent("onlosecaptrue",releaseCaptrue);evt.returnValue=false;}callbacks.ondragstart();},getFixedLayer:function(){var layer=document.getElementById("edui_fixedlayer");if(layer==null){layer=document.createElement("div");layer.id="edui_fixedlayer";document.body.appendChild(layer);if(browser.ie&&browser.version<=8){layer.style.position="absolute";bindFixedLayer();setTimeout(updateFixedOffset);}else{layer.style.position="fixed";}layer.style.left="0";layer.style.top="0";layer.style.width="0";layer.style.height="0";}return layer;},makeUnselectable:function(element){if(browser.opera||(browser.ie&&browser.version<9)){element.unselectable="on";if(element.hasChildNodes()){for(var i=0;i<element.childNodes.length;i++){if(element.childNodes[i].nodeType==1){uiUtils.makeUnselectable(element.childNodes[i]);}}}}else{if(element.style.MozUserSelect!==undefined){element.style.MozUserSelect="none";}else{if(element.style.WebkitUserSelect!==undefined){element.style.WebkitUserSelect="none";}else{if(element.style.KhtmlUserSelect!==undefined){element.style.KhtmlUserSelect="none";}}}}}};function updateFixedOffset(){var layer=document.getElementById("edui_fixedlayer");uiUtils.setViewportOffset(layer,{left:0,top:0});}function bindFixedLayer(adjOffset){domUtils.on(window,"scroll",updateFixedOffset);domUtils.on(window,"resize",baidu.editor.utils.defer(updateFixedOffset,0,true));}})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,EventBase=baidu.editor.EventBase,UIBase=baidu.editor.ui.UIBase=function(){};UIBase.prototype={className:"",uiName:"",initOptions:function(options){var me=this;for(var k in options){me[k]=options[k];}this.id=this.id||"edui"+uiUtils.uid();},initUIBase:function(){this._globalKey=utils.unhtml(uiUtils.setGlobal(this.id,this));},render:function(holder){var html=this.renderHtml();var el=uiUtils.createElementByHtml(html);var list=domUtils.getElementsByTagName(el,"*");var theme="edui-"+(this.theme||this.editor.options.theme);var layer=document.getElementById("edui_fixedlayer");for(var i=0,node;node=list[i++];){domUtils.addClass(node,theme);}domUtils.addClass(el,theme);if(layer){layer.className="";domUtils.addClass(layer,theme);}var seatEl=this.getDom();if(seatEl!=null){seatEl.parentNode.replaceChild(el,seatEl);uiUtils.copyAttributes(el,seatEl);}else{if(typeof holder=="string"){holder=document.getElementById(holder);}holder=holder||uiUtils.getFixedLayer();domUtils.addClass(holder,theme);holder.appendChild(el);}this.postRender();},getDom:function(name){if(!name){return document.getElementById(this.id);}else{return document.getElementById(this.id+"_"+name);}},postRender:function(){this.fireEvent("postrender");},getHtmlTpl:function(){return"";},formatHtml:function(tpl){var prefix="edui-"+this.uiName;return(tpl.replace(/##/g,this.id).replace(/%%-/g,this.uiName?prefix+"-":"").replace(/%%/g,(this.uiName?prefix:"")+" "+this.className).replace(/\$\$/g,this._globalKey));},renderHtml:function(){return this.formatHtml(this.getHtmlTpl());},dispose:function(){var box=this.getDom();if(box){baidu.editor.dom.domUtils.remove(box);}uiUtils.unsetGlobal(this.id);}};utils.inherits(UIBase,EventBase);})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Separator=baidu.editor.ui.Separator=function(options){this.initOptions(options);this.initSeparator();};Separator.prototype={uiName:"separator",initSeparator:function(){this.initUIBase();},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"></div>';}};utils.inherits(Separator,UIBase);})();(function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,uiUtils=baidu.editor.ui.uiUtils;var Mask=baidu.editor.ui.Mask=function(options){this.initOptions(options);this.initUIBase();};Mask.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onmousedown="return $$._onMouseDown(event, this);"></div>';},postRender:function(){var me=this;domUtils.on(window,"resize",function(){setTimeout(function(){if(!me.isHidden()){me._fill();}});});},show:function(zIndex){this._fill();this.getDom().style.display="";this.getDom().style.zIndex=zIndex;},hide:function(){this.getDom().style.display="none";this.getDom().style.zIndex="";},isHidden:function(){return this.getDom().style.display=="none";},_onMouseDown:function(){return false;},_fill:function(){var el=this.getDom();var vpRect=uiUtils.getViewportRect();el.style.width=vpRect.width+"px";el.style.height=vpRect.height+"px";}};utils.inherits(Mask,UIBase);})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,Popup=baidu.editor.ui.Popup=function(options){this.initOptions(options);this.initPopup();};var allPopups=[];function closeAllPopup(evt,el){var newAll=[];for(var i=0;i<allPopups.length;i++){var pop=allPopups[i];if(!pop.isHidden()){if(pop.queryAutoHide(el)!==false){if(evt&&/scroll/ig.test(evt.type)&&pop.className=="edui-wordpastepop"){return;}pop.hide();}}}}Popup.postHide=closeAllPopup;var ANCHOR_CLASSES=["edui-anchor-topleft","edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];Popup.prototype={SHADOW_RADIUS:5,content:null,_hidden:false,autoRender:true,canSideLeft:true,canSideUp:true,initPopup:function(){this.initUIBase();allPopups.push(this);},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%">'+' <div id="##_body" class="edui-popup-body">'+' <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>'+' <div class="edui-shadow"></div>'+' <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  </div>"+" </div>"+"</div>";},getContentHtmlTpl:function(){if(this.content){if(typeof this.content=="string"){return this.content;}return this.content.renderHtml();}else{return"";}},_UIBase_postRender:UIBase.prototype.postRender,postRender:function(){if(this.content instanceof UIBase){this.content.postRender();}this.fireEvent("postRenderAfter");this.hide(true);this._UIBase_postRender();},_doAutoRender:function(){if(!this.getDom()&&this.autoRender){this.render();}},mesureSize:function(){var box=this.getDom("content");return uiUtils.getClientRect(box);},fitSize:function(){var popBodyEl=this.getDom("body");popBodyEl.style.width="";popBodyEl.style.height="";var size=this.mesureSize();popBodyEl.style.width=size.width+"px";popBodyEl.style.height=size.height+"px";return size;},showAnchor:function(element,hoz){this.showAnchorRect(uiUtils.getClientRect(element),hoz);},showAnchorRect:function(rect,hoz,adj){this._doAutoRender();var vpRect=uiUtils.getViewportRect();this._show();var popSize=this.fitSize();var sideLeft,sideUp,left,top;if(hoz){sideLeft=this.canSideLeft&&(rect.right+popSize.width>vpRect.right&&rect.left>popSize.width);sideUp=this.canSideUp&&(rect.top+popSize.height>vpRect.bottom&&rect.bottom>popSize.height);left=(sideLeft?rect.left-popSize.width:rect.right);top=(sideUp?rect.bottom-popSize.height:rect.top);}else{sideLeft=this.canSideLeft&&(rect.right+popSize.width>vpRect.right&&rect.left>popSize.width);sideUp=this.canSideUp&&(rect.top+popSize.height>vpRect.bottom&&rect.bottom>popSize.height);left=(sideLeft?rect.right-popSize.width:rect.left);top=(sideUp?rect.top-popSize.height:rect.bottom);}var popEl=this.getDom();uiUtils.setViewportOffset(popEl,{left:left,top:top});domUtils.removeClasses(popEl,ANCHOR_CLASSES);popEl.className+=" "+ANCHOR_CLASSES[(sideUp?1:0)*2+(sideLeft?1:0)];if(this.editor){popEl.style.zIndex=this.editor.container.style.zIndex*1+10;baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=popEl.style.zIndex-1;}},showAt:function(offset){var left=offset.left;var top=offset.top;var rect={left:left,top:top,right:left,bottom:top,height:0,width:0};this.showAnchorRect(rect,false,true);},_show:function(){if(this._hidden){var box=this.getDom();box.style.display="";this._hidden=false;this.fireEvent("show");}},isHidden:function(){return this._hidden;},show:function(){this._doAutoRender();this._show();},hide:function(notNofity){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;if(!notNofity){this.fireEvent("hide");}}},queryAutoHide:function(el){return !el||!uiUtils.contains(this.getDom(),el);}};utils.inherits(Popup,UIBase);domUtils.on(document,"mousedown",function(evt){var el=evt.target||evt.srcElement;closeAllPopup(evt,el);});domUtils.on(window,"scroll",function(evt,el){closeAllPopup(evt,el);});})();(function(){var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils;var TPL_STATEFUL='onmousedown="$$.Stateful_onMouseDown(event, this);"'+' onmouseup="$$.Stateful_onMouseUp(event, this);"'+(browser.ie?(' onmouseenter="$$.Stateful_onMouseEnter(event, this);"'+' onmouseleave="$$.Stateful_onMouseLeave(event, this);"'):(' onmouseover="$$.Stateful_onMouseOver(event, this);"'+' onmouseout="$$.Stateful_onMouseOut(event, this);"'));baidu.editor.ui.Stateful={alwalysHoverable:false,target:null,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl;this.getHtmlTpl=this.Stateful_getHtmlTpl;},Stateful_getHtmlTpl:function(){var tpl=this._Stateful_dGetHtmlTpl();return tpl.replace(/stateful/g,function(){return TPL_STATEFUL;});},Stateful_onMouseEnter:function(evt,el){this.target=el;if(!this.isDisabled()||this.alwalysHoverable){this.addState("hover");this.fireEvent("over");}},Stateful_onMouseLeave:function(evt,el){if(!this.isDisabled()||this.alwalysHoverable){this.removeState("hover");this.removeState("active");this.fireEvent("out");}},Stateful_onMouseOver:function(evt,el){var rel=evt.relatedTarget;if(!uiUtils.contains(el,rel)&&el!==rel){this.Stateful_onMouseEnter(evt,el);}},Stateful_onMouseOut:function(evt,el){var rel=evt.relatedTarget;if(!uiUtils.contains(el,rel)&&el!==rel){this.Stateful_onMouseLeave(evt,el);}},Stateful_onMouseDown:function(evt,el){if(!this.isDisabled()){this.addState("active");}},Stateful_onMouseUp:function(evt,el){if(!this.isDisabled()){this.removeState("active");}},Stateful_postRender:function(){if(this.disabled&&!this.hasState("disabled")){this.addState("disabled");}},hasState:function(state){return domUtils.hasClass(this.getStateDom(),"edui-state-"+state);},addState:function(state){if(!this.hasState(state)){this.getStateDom().className+=" edui-state-"+state;}},removeState:function(state){if(this.hasState(state)){domUtils.removeClasses(this.getStateDom(),["edui-state-"+state]);}},getStateDom:function(){return this.getDom("state");},isChecked:function(){return this.hasState("checked");},setChecked:function(checked){if(!this.isDisabled()&&checked){this.addState("checked");}else{this.removeState("checked");}},isDisabled:function(){return this.hasState("disabled");},setDisabled:function(disabled){if(disabled){this.removeState("hover");this.removeState("checked");this.removeState("active");this.addState("disabled");}else{this.removeState("disabled");}}};})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Stateful=baidu.editor.ui.Stateful,Button=baidu.editor.ui.Button=function(options){this.initOptions(options);this.initButton();};Button.prototype={uiName:"button",label:"",title:"",showIcon:true,showText:true,initButton:function(){this.initUIBase();this.Stateful_init();},getHtmlTpl:function(){return'<div id="##" class="edui-box %%">'+'<div id="##_state" stateful>'+'<div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onclick="return $$._onClick();">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div>"+"</div>"+"</div></div>";},postRender:function(){this.fireEvent("renderReady");this.Stateful_postRender();this.setDisabled(this.disabled);},_onClick:function(){if(!this.isDisabled()){this.fireEvent("click");}}};utils.inherits(Button,UIBase);utils.extend(Button.prototype,Stateful);})();(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,Stateful=baidu.editor.ui.Stateful,UIBase=baidu.editor.ui.UIBase;var GraphicTemplatePicker=baidu.editor.ui.GraphicTemplatePicker=function(options){this.initOptions(options);this.initGraphicTemplatePicker();};GraphicTemplatePicker.prototype={initGraphicTemplatePicker:function(){this.initUIBase();this.Stateful_init();},getHtmlTpl:function(){return'<div id="##" class="edui-graphictemplatepicker %%">'+'<div class="edui-graphictemplatepicker-body">'+'<div onclick="$$._onClick(event);"  class="edui-graphictemplatepicker-item" stateful>'+'<div class="edui-label" _type="food">美食食材</div>'+"</div>"+'<div onclick="$$._onClick(event);"  class="edui-graphictemplatepicker-item" stateful>'+'<div class="edui-label" _type="fitment">家居装修</div>'+"</div>"+'<div onclick="$$._onClick(event);" class="edui-graphictemplatepicker-item" stateful>'+'<div class="edui-label"  _type="soft">软件信息</div>'+"</div>"+"</div>"+"</div>";},getStateDom:function(){return this.target;},_onClick:function(e){var tgt=e.target||e.srcElement;this.editor.execCommand("graphictemplate",tgt.getAttribute("_type"));Popup.postHide(e);},_UIBase_render:UIBase.prototype.render};utils.inherits(GraphicTemplatePicker,UIBase);utils.extend(GraphicTemplatePicker.prototype,Stateful,true);})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,Toolbar=baidu.editor.ui.Toolbar=function(options){this.initOptions(options);this.initToolbar();};Toolbar.prototype={items:null,initToolbar:function(){this.items=this.items||[];this.initUIBase();},add:function(item){this.items.push(item);},getHtmlTpl:function(){var buff=[];for(var i=0;i<this.items.length;i++){buff[i]=this.items[i].renderHtml();}return'<div id="##" class="edui-toolbar %%" onselectstart="return false;" >'+buff.join("")+"</div>";},postRender:function(){var box=this.getDom();for(var i=0;i<this.items.length;i++){this.items[i].postRender();}},_onMouseDown:function(){return false;}};utils.inherits(Toolbar,UIBase);})();(function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,Mask=baidu.editor.ui.Mask,UIBase=baidu.editor.ui.UIBase,Button=baidu.editor.ui.Button,Dialog=baidu.editor.ui.Dialog=function(options){this.initOptions(utils.extend({autoReset:true,draggable:true,onok:function(){},oncancel:function(){},onclose:function(t,ok){return ok?this.onok():this.oncancel();}},options));this.initDialog();};var modalMask;var dragMask;Dialog.prototype={draggable:false,uiName:"dialog",initDialog:function(){var me=this,theme=this.editor.options.theme;this.initUIBase();this.modalMask=(modalMask||(modalMask=new Mask({className:"edui-dialog-modalmask",theme:theme})));this.dragMask=(dragMask||(dragMask=new Mask({className:"edui-dialog-dragmask",theme:theme})));this.closeButton=new Button({className:"edui-dialog-closebutton",title:me.closeDialog,theme:theme,onclick:function(){me.close(false);}});if(this.buttons){for(var i=0;i<this.buttons.length;i++){if(!(this.buttons[i] instanceof Button)){this.buttons[i]=new Button(this.buttons[i]);}}}},fitSize:function(){var popBodyEl=this.getDom("body");var size=this.mesureSize();popBodyEl.style.width=size.width+"px";popBodyEl.style.height=size.height+"px";return size;},safeSetOffset:function(offset){var me=this;var el=me.getDom();var vpRect=uiUtils.getViewportRect();var rect=uiUtils.getClientRect(el);var left=offset.left;if(left+rect.width>vpRect.right){left=vpRect.right-rect.width;}var top=offset.top;if(top+rect.height>vpRect.bottom){top=vpRect.bottom-rect.height;}el.style.left=Math.max(left,0)+"px";el.style.top=Math.max(top,0)+"px";},showAtCenter:function(){this.getDom().style.display="";var vpRect=uiUtils.getViewportRect();var popSize=this.fitSize();var titleHeight=this.getDom("titlebar").offsetHeight|0;var left=vpRect.width/2-popSize.width/2;var top=vpRect.height/2-(popSize.height-titleHeight)/2-titleHeight;var popEl=this.getDom();this.safeSetOffset({left:Math.max(left|0,0),top:Math.max(top|0,0)});if(!domUtils.hasClass(popEl,"edui-state-centered")){popEl.className+=" edui-state-centered";}this._show();},getContentHtml:function(){var contentHtml="";if(typeof this.content=="string"){contentHtml=this.content;}else{if(this.iframeUrl){contentHtml='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"></iframe>';}}return contentHtml;},getHtmlTpl:function(){var footHtml="";if(this.buttons){var buff=[];for(var i=0;i<this.buttons.length;i++){buff[i]=this.buttons[i].renderHtml();}footHtml='<div class="%%-foot">'+'<div id="##_buttons" class="%%-buttons">'+buff.join("")+"</div>"+"</div>";}return'<div id="##" class="%%"><div class="%%-wrap"><div id="##_body" class="%%-body">'+'<div class="%%-shadow"></div>'+'<div id="##_titlebar" class="%%-titlebar">'+'<div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);">'+'<span class="%%-caption">'+(this.title||"")+"</span>"+"</div>"+this.closeButton.renderHtml()+"</div>"+'<div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"</div>"+footHtml+"</div></div></div>";},postRender:function(){if(!this.modalMask.getDom()){this.modalMask.render();this.modalMask.hide();}if(!this.dragMask.getDom()){this.dragMask.render();this.dragMask.hide();}var me=this;this.addListener("show",function(){me.modalMask.show(this.getDom().style.zIndex-2);});this.addListener("hide",function(){me.modalMask.hide();});if(this.buttons){for(var i=0;i<this.buttons.length;i++){this.buttons[i].postRender();}}domUtils.on(window,"resize",function(){setTimeout(function(){if(!me.isHidden()){me.safeSetOffset(uiUtils.getClientRect(me.getDom()));}});});this._hide();},mesureSize:function(){var body=this.getDom("body");var width=uiUtils.getClientRect(this.getDom("content")).width;var dialogBodyStyle=body.style;dialogBodyStyle.width=width;return uiUtils.getClientRect(body);},_onTitlebarMouseDown:function(evt,el){if(this.draggable){var rect;var vpRect=uiUtils.getViewportRect();var me=this;uiUtils.startDrag(evt,{ondragstart:function(){rect=uiUtils.getClientRect(me.getDom());me.getDom("contmask").style.visibility="visible";me.dragMask.show(me.getDom().style.zIndex-1);},ondragmove:function(x,y){var left=rect.left+x;var top=rect.top+y;me.safeSetOffset({left:left,top:top});},ondragstop:function(){me.getDom("contmask").style.visibility="hidden";domUtils.removeClasses(me.getDom(),["edui-state-centered"]);me.dragMask.hide();}});}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml();},_show:function(){if(this._hidden){this.getDom().style.display="";this.editor.container.style.zIndex&&(this.getDom().style.zIndex=this.editor.container.style.zIndex*1+10);this._hidden=false;this.fireEvent("show");baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4;}},isHidden:function(){return this._hidden;},_hide:function(){if(!this._hidden){this.getDom().style.display="none";this.getDom().style.zIndex="";this._hidden=true;this.fireEvent("hide");}},open:function(){if(this.autoReset){try{this.reset();}catch(e){this.render();this.open();}}this.showAtCenter();if(this.iframeUrl){try{this.getDom("iframe").focus();}catch(ex){}}},_onCloseButtonClick:function(evt,el){this.close(false);},close:function(ok){if(this.fireEvent("close",ok)!==false){this._hide();}}};utils.inherits(Dialog,UIBase);})();(function(){var utils=baidu.editor.utils;var editorui=baidu.editor.ui;var _Dialog=editorui.Dialog;editorui.buttons={};editorui.Dialog=function(options){var dialog=new _Dialog(options);dialog.addListener("hide",function(){if(dialog.editor){var editor=dialog.editor;try{if(browser.gecko){var y=editor.window.scrollY,x=editor.window.scrollX;editor.body.focus();editor.window.scrollTo(x,y);}else{editor.focus();}}catch(ex){}}});return dialog;};var iframeUrlMap={"insertvideo":"~/dialogs/_video/video.html"};var btnCmds=["source","undo","redo","bold","italic","autotypeset","insertorderedlist","insertunorderedlist","heading1"];for(var i=0,ci;ci=btnCmds[i++];){ci=ci.toLowerCase();editorui[ci]=function(cmd){return function(editor){var ui=new editorui.Button({className:"edui-for-"+cmd,title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",onclick:function(){editor.execCommand(cmd);},theme:editor.options.theme,showText:false});editorui.buttons[cmd]=ui;editor.addListener("selectionchange",function(type,causeByUi,uiReady){var state=editor.queryCommandState(cmd);if(state==-1){ui.setDisabled(true);ui.setChecked(false);}else{if(!uiReady){ui.setDisabled(false);ui.setChecked(state);}}});return ui;};}(ci);}var dialogBtns={ok:["insertvideo"]};for(var p in dialogBtns){(function(type,vals){for(var i=0,ci;ci=vals[i++];){if(browser.opera&&ci==="searchreplace"){continue;}(function(cmd){editorui[cmd]=function(editor,iframeUrl,title){iframeUrl=iframeUrl||(editor.options.iframeUrlMap||{})[cmd]||iframeUrlMap[cmd];title=editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"";var dialog;if(iframeUrl){dialog=new editorui.Dialog(utils.extend({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:"edui-for-"+cmd,title:title,closeDialog:editor.getLang("closeDialog")},type=="ok"?{buttons:[{className:"edui-okbutton",label:editor.getLang("ok"),editor:editor,onclick:function(){dialog.close(true);}},{className:"edui-cancelbutton",label:editor.getLang("cancel"),editor:editor,onclick:function(){dialog.close(false);}}]}:{}));editor.ui._dialogs[cmd+"Dialog"]=dialog;}var ui=new editorui.Button({className:"edui-for-"+cmd,title:title,onclick:function(){if(dialog){switch(cmd){case"wordimage":editor.execCommand("wordimage","word_img");if(editor.word_img){dialog.render();dialog.open();}break;case"scrawl":if(editor.queryCommandState("scrawl")!=-1){dialog.render();dialog.open();}break;default:dialog.render();dialog.open();}}},theme:editor.options.theme,disabled:cmd=="scrawl"&&editor.queryCommandState("scrawl")==-1});editorui.buttons[cmd]=ui;editor.addListener("selectionchange",function(){var unNeedCheckState={"edittable":1};if(cmd in unNeedCheckState){return;}var state=editor.queryCommandState(cmd);if(ui.getDom()){ui.setDisabled(state==-1);ui.setChecked(state);}});return ui;};})(ci.toLowerCase());}})(p,dialogBtns[p]);}editorui["graphictemplate"]=function(editor){var cmd="graphictemplate",graphictemplatePop=new baidu.editor.ui.Popup({content:new baidu.editor.ui.GraphicTemplatePicker({editor:editor}),editor:editor,className:"edui-graphictemplatePop"});graphictemplatePop.render();var ui=new editorui.Button({className:"edui-for-"+cmd,title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",onclick:function(){graphictemplatePop.showAnchor(this.getDom());},theme:editor.options.theme,showText:false});editorui.buttons[cmd]=ui;editor.addListener("selectionchange",function(type,causeByUi,uiReady){var state=editor.queryCommandState(cmd);if(state==-1){ui.setDisabled(true);ui.setChecked(false);}else{if(!uiReady){ui.setDisabled(false);ui.setChecked(state);}}});return ui;};editorui["insertimage"]=function(editor){var cmd="insertimage";var ui=new editorui.Button({className:"edui-for-"+cmd,title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",getHtmlTpl:function(){return'<div id="##" class="edui-box %%">'+'<div id="##_state" stateful>'+'<div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return false;" onclick="return $$._onClick();">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div>"+"</div>"+"</div>"+'<div id="ue_containerId" class="ue_flash"></div>'+"</div>";},theme:editor.options.theme,showText:false});editorui.buttons[cmd]=ui;ui.addListener("renderReady",function(){domUtils.on(ui.getDom(),["mouseover","mouseout","mousedown","mouseup"],function(e){switch(e.type){case"mouseover":ui.addState("hover");break;case"mouseout":ui.removeState("hover");ui.removeState("active");break;case"mousedown":ui.addState("active");break;case"mouseup":ui.removeState("active");break;}});});editor.addListener("selectionchange",function(type,causeByUi,uiReady){var state=editor.queryCommandState(cmd);if(state==-1){ui.setDisabled(true);ui.setChecked(false);}else{if(!uiReady){ui.setDisabled(false);ui.setChecked(state);}}});return ui;};})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,domUtils=baidu.editor.dom.domUtils;var nodeStack=[];function EditorUI(options){this.initOptions(options);this.initEditorUI();}EditorUI.prototype={uiName:"editor",initEditorUI:function(){this.editor.ui=this;this._dialogs={};this.initUIBase();this._initToolbars();var editor=this.editor,me=this;editor.addListener("ready",function(){editor.getDialog=function(name){return editor.ui._dialogs[name+"Dialog"];};domUtils.on(editor.window,"scroll",function(evt){baidu.editor.ui.Popup.postHide(evt);});editor.ui._actualFrameWidth=editor.options.initialFrameWidth;if(editor.options.elementPathEnabled){editor.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+editor.getLang("elementPathTip")+":</div>";}if(editor.options.wordCount){function countFn(){setCount(editor,me);domUtils.un(editor.document,"click",arguments.callee);}domUtils.on(editor.document,"click",countFn);editor.ui.getDom("wordcount").innerHTML=editor.getLang("wordCountTip");}editor.ui._scale();if(editor.options.scaleEnabled){if(editor.autoHeightEnabled){editor.disableAutoHeight();}me.enableScale();}else{me.disableScale();}if(!editor.options.elementPathEnabled&&!editor.options.wordCount&&!editor.options.scaleEnabled){editor.ui.getDom("elementpath").style.display="none";editor.ui.getDom("wordcount").style.display="none";editor.ui.getDom("scale").style.display="none";}if(!editor.selection.isFocus()){return;}editor.fireEvent("selectionchange",false,true);});editor.addListener("mousedown",function(t,evt){var el=evt.target||evt.srcElement;baidu.editor.ui.Popup.postHide(evt,el);});editor.addListener("delcells",function(){if(UE.ui["edittip"]){new UE.ui["edittip"](editor);}editor.getDialog("edittip").open();});var pastePop,isPaste=false,timer;editor.addListener("afterpaste",function(){if(editor.queryCommandState("pasteplain")){return;}isPaste=true;});editor.addListener("afterinserthtml",function(){clearTimeout(timer);timer=setTimeout(function(){if(pastePop&&(isPaste||editor.ui._isTransfer)){var span=domUtils.createElement(editor.document,"span",{"style":"line-height:0px;","innerHTML":"\ufeff"}),range=editor.selection.getRange();range.insertNode(span);pastePop.showAnchor(span);domUtils.remove(span);delete editor.ui._isTransfer;isPaste=false;}},200);});editor.addListener("contextmenu",function(t,evt){baidu.editor.ui.Popup.postHide(evt);});editor.addListener("keydown",function(t,evt){if(pastePop){pastePop.dispose(evt);}var keyCode=evt.keyCode||evt.which;if(evt.altKey&&keyCode==90){UE.ui.buttons["fullscreen"].onclick();}});editor.addListener("wordcount",function(type){setCount(this,me);});function setCount(editor,ui){editor.setOpt({wordCount:true,maximumWords:10000,wordCountMsg:editor.options.wordCountMsg||editor.getLang("wordCountMsg"),wordOverFlowMsg:editor.options.wordOverFlowMsg||editor.getLang("wordOverFlowMsg")});var opt=editor.options,max=opt.maximumWords,msg=opt.wordCountMsg,errMsg=opt.wordOverFlowMsg,countDom=ui.getDom("wordcount");if(!opt.wordCount){return;}var count=editor.getContentLength(true);if(count>max){countDom.innerHTML=errMsg;editor.fireEvent("wordcountoverflow");}else{countDom.innerHTML=msg.replace("{#leave}",max-count).replace("{#count}",count);}}editor.addListener("selectionchange",function(){if(editor.options.elementPathEnabled){me[(editor.queryCommandState("elementpath")==-1?"dis":"en")+"ableElementPath"]();}if(editor.options.scaleEnabled){me[(editor.queryCommandState("scale")==-1?"dis":"en")+"ableScale"]();}});var popup=new baidu.editor.ui.Popup({editor:editor,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide();editor.ui._dialogs.linkDialog.open();},_onImgEditButtonClick:function(name){this.hide();editor.ui._dialogs[name]&&editor.ui._dialogs[name].open();},_onImgSetFloat:function(value){this.hide();editor.execCommand("imagefloat",value);},_setIframeAlign:function(value){var frame=popup.anchorEl;var newFrame=frame.cloneNode(true);switch(value){case -2:newFrame.setAttribute("align","");break;case -1:newFrame.setAttribute("align","left");break;case 1:newFrame.setAttribute("align","right");break;}frame.parentNode.insertBefore(newFrame,frame);domUtils.remove(frame);popup.anchorEl=newFrame;popup.showAnchor(popup.anchorEl);},_updateIframe:function(){editor._iframe=popup.anchorEl;editor.ui._dialogs.insertframeDialog.open();popup.hide();},_onRemoveButtonClick:function(cmdName){editor.execCommand(cmdName);this.hide();},queryAutoHide:function(el){if(el&&el.ownerDocument==editor.document){if(el.tagName.toLowerCase()=="img"||domUtils.findParentByTagName(el,"a",true)){return el!==popup.anchorEl;}}return baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,el);}});popup.render();if(editor.options.imagePopup){editor.addListener("mouseover",function(t,evt){evt=evt||window.event;var el=evt.target||evt.srcElement;if(editor.ui._dialogs.insertframeDialog&&/iframe/ig.test(el.tagName)){var html=popup.formatHtml("<nobr>"+editor.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+editor.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+editor.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+editor.getLang("justifyright")+"</span>&nbsp;&nbsp;"+' <span onclick="$$._updateIframe( this);" class="edui-clickable">'+editor.getLang("modify")+"</span></nobr>");if(html){popup.getDom("content").innerHTML=html;popup.anchorEl=el;popup.showAnchor(popup.anchorEl);}else{popup.hide();}}});editor.addListener("selectionchange",function(t,causeByUi){if(!causeByUi){return;}var html="",str="",img=editor.selection.getRange().getClosedNode(),dialogs=editor.ui._dialogs;if(editor.ui._dialogs.linkDialog){var link=editor.queryCommandValue("link");var url;if(link&&(url=(link.getAttribute("_href")||link.getAttribute("href",2)))){var txt=url;if(url.length>30){txt=url.substring(0,20)+"...";}if(html){html+='<div style="height:5px;"></div>';}html+=popup.formatHtml("<nobr>"+editor.getLang("anthorMsg")+': <a target="_blank" href="'+url+'" title="'+url+'" >'+txt+"</a>"+' <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+editor.getLang("modify")+"</span>"+' <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+editor.getLang("clear")+"</span></nobr>");popup.showAnchor(link);}}if(html){popup.getDom("content").innerHTML=html;popup.anchorEl=img||link;popup.showAnchor(popup.anchorEl);}else{popup.hide();}});}},_initToolbars:function(){var editor=this.editor;var toolbars=this.toolbars||[];var toolbarUis=[];for(var i=0;i<toolbars.length;i++){var toolbar=toolbars[i];var toolbarUi=new baidu.editor.ui.Toolbar({theme:editor.options.theme});for(var j=0;j<toolbar.length;j++){var toolbarItem=toolbar[j];var toolbarItemUi=null;if(typeof toolbarItem=="string"){toolbarItem=toolbarItem.toLowerCase();if(toolbarItem=="|"){toolbarItem="Separator";}if(baidu.editor.ui[toolbarItem]){toolbarItemUi=new baidu.editor.ui[toolbarItem](editor);}if(toolbarItem=="fullscreen"){if(toolbarUis&&toolbarUis[0]){toolbarUis[0].items.splice(0,0,toolbarItemUi);}else{toolbarItemUi&&toolbarUi.items.splice(0,0,toolbarItemUi);}continue;}}else{toolbarItemUi=toolbarItem;}if(toolbarItemUi&&toolbarItemUi.id){toolbarUi.add(toolbarItemUi);}}toolbarUis[i]=toolbarUi;}this.toolbars=toolbarUis;},getHtmlTpl:function(){return'<div id="##" class="%%">'+'<div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;">'+'<div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+"</div>"+'<div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div>'+'<div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div>'+'<div style="height:0;overflow:hidden;clear:both;"></div>'+"</div>"+"</div>"+'<div id="##_iframeholder" class="%%-iframeholder"></div>'+'<div id="##_bottombar" class="%%-bottomContainer"><table><tr>'+'<td id="##_elementpath" class="%%-bottombar"></td>'+'<td id="##_wordcount" class="%%-wordcount"></td>'+'<td id="##_scale" class="%%-scale"><div class="%%-icon"></div></td>'+"</tr></table></div>"+'<div id="##_scalelayer"></div>'+"</div>";},showWordImageDialog:function(){this.editor.execCommand("wordimage","word_img");this._dialogs["wordimageDialog"].open();},renderToolbarBoxHtml:function(){var buff=[];for(var i=0;i<this.toolbars.length;i++){buff.push(this.toolbars[i].renderHtml());}return buff.join("");},setFullScreen:function(fullscreen){var editor=this.editor,container=editor.container.parentNode.parentNode;if(this._fullscreen!=fullscreen){this._fullscreen=fullscreen;this.editor.fireEvent("beforefullscreenchange",fullscreen);if(baidu.editor.browser.gecko){var bk=editor.selection.getRange().createBookmark();}if(fullscreen){while(container.tagName!="BODY"){var position=baidu.editor.dom.domUtils.getComputedStyle(container,"position");nodeStack.push(position);container.style.position="static";container=container.parentNode;}this._bakHtmlOverflow=document.documentElement.style.overflow;this._bakBodyOverflow=document.body.style.overflow;this._bakAutoHeight=this.editor.autoHeightEnabled;this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop);if(this._bakAutoHeight){editor.autoHeightEnabled=false;this.editor.disableAutoHeight();}document.documentElement.style.overflow="hidden";document.body.style.overflow="hidden";this._bakCssText=this.getDom().style.cssText;this._bakCssText1=this.getDom("iframeholder").style.cssText;this._updateFullScreen();}else{while(container.tagName!="BODY"){container.style.position=nodeStack.shift();container=container.parentNode;}this.getDom().style.cssText=this._bakCssText;this.getDom("iframeholder").style.cssText=this._bakCssText1;if(this._bakAutoHeight){editor.autoHeightEnabled=true;this.editor.enableAutoHeight();}document.documentElement.style.overflow=this._bakHtmlOverflow;document.body.style.overflow=this._bakBodyOverflow;window.scrollTo(0,this._bakScrollTop);}if(baidu.editor.browser.gecko){var input=document.createElement("input");document.body.appendChild(input);editor.body.contentEditable=false;setTimeout(function(){input.focus();setTimeout(function(){editor.body.contentEditable=true;editor.selection.getRange().moveToBookmark(bk).select(true);baidu.editor.dom.domUtils.remove(input);fullscreen&&window.scroll(0,0);},0);},0);}this.editor.fireEvent("fullscreenchanged",fullscreen);this.triggerLayout();}},_updateFullScreen:function(){if(this._fullscreen){var vpRect=uiUtils.getViewportRect();this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+vpRect.width+"px;height:"+vpRect.height+"px;z-index:"+(this.getDom().style.zIndex*1+100);uiUtils.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0});this.editor.setHeight(vpRect.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0));}},_updateElementPath:function(){var bottom=this.getDom("elementpath"),list;if(this.elementPathEnabled&&(list=this.editor.queryCommandValue("elementpath"))){var buff=[];for(var i=0,ci;ci=list[i];i++){buff[i]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+i+'&quot;);">'+ci+"</span>");}bottom.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+buff.join(" &gt; ")+"</div>";}else{bottom.style.display="none";}},disableElementPath:function(){var bottom=this.getDom("elementpath");bottom.innerHTML="";bottom.style.display="none";this.elementPathEnabled=false;},enableElementPath:function(){var bottom=this.getDom("elementpath");bottom.style.display="";this.elementPathEnabled=true;this._updateElementPath();},_scale:function(){var doc=document,editor=this.editor,editorHolder=editor.container,editorDocument=editor.document,toolbarBox=this.getDom("toolbarbox"),bottombar=this.getDom("bottombar"),scale=this.getDom("scale"),scalelayer=this.getDom("scalelayer");var isMouseMove=false,position=null,minEditorHeight=0,minEditorWidth=editor.options.minFrameWidth,pageX=0,pageY=0,scaleWidth=0,scaleHeight=0;function down(){position=domUtils.getXY(editorHolder);if(!minEditorHeight){minEditorHeight=editor.options.minFrameHeight+toolbarBox.offsetHeight+bottombar.offsetHeight;}scalelayer.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+editorHolder.offsetWidth+"px;height:"+editorHolder.offsetHeight+"px;z-index:"+(editor.options.zIndex+1);domUtils.on(doc,"mousemove",move);domUtils.on(editorDocument,"mouseup",up);domUtils.on(doc,"mouseup",up);}var me=this;this.editor.addListener("fullscreenchanged",function(e,fullScreen){if(fullScreen){me.disableScale();}else{if(me.editor.options.scaleEnabled){me.enableScale();var tmpNode=me.editor.document.createElement("span");me.editor.body.appendChild(tmpNode);me.editor.body.style.height=Math.max(domUtils.getXY(tmpNode).y,me.editor.iframe.offsetHeight-20)+"px";domUtils.remove(tmpNode);}}});function move(event){clearSelection();var e=event||window.event;pageX=e.pageX||(doc.documentElement.scrollLeft+e.clientX);pageY=e.pageY||(doc.documentElement.scrollTop+e.clientY);scaleWidth=pageX-position.x;scaleHeight=pageY-position.y;if(scaleWidth>=minEditorWidth){isMouseMove=true;scalelayer.style.width=scaleWidth+"px";}if(scaleHeight>=minEditorHeight){isMouseMove=true;scalelayer.style.height=scaleHeight+"px";}}function up(){if(isMouseMove){isMouseMove=false;editor.ui._actualFrameWidth=scalelayer.offsetWidth-2;editorHolder.style.width=editor.ui._actualFrameWidth+"px";editor.setHeight(scalelayer.offsetHeight-bottombar.offsetHeight-toolbarBox.offsetHeight-2);}if(scalelayer){scalelayer.style.display="none";}clearSelection();domUtils.un(doc,"mousemove",move);domUtils.un(editorDocument,"mouseup",up);domUtils.un(doc,"mouseup",up);}function clearSelection(){if(browser.ie){doc.selection.clear();}else{window.getSelection().removeAllRanges();}}this.enableScale=function(){if(editor.queryCommandState("source")==1){return;}scale.style.display="";this.scaleEnabled=true;domUtils.on(scale,"mousedown",down);};this.disableScale=function(){scale.style.display="none";this.scaleEnabled=false;domUtils.un(scale,"mousedown",down);};},isFullScreen:function(){return this._fullscreen;},postRender:function(){UIBase.prototype.postRender.call(this);for(var i=0;i<this.toolbars.length;i++){this.toolbars[i].postRender();}var me=this;var timerId,domUtils=baidu.editor.dom.domUtils,updateFullScreenTime=function(){clearTimeout(timerId);timerId=setTimeout(function(){me._updateFullScreen();});};domUtils.on(window,"resize",updateFullScreenTime);me.addListener("destroy",function(){domUtils.un(window,"resize",updateFullScreenTime);clearTimeout(timerId);});},showToolbarMsg:function(msg,flag){this.getDom("toolbarmsg_label").innerHTML=msg;this.getDom("toolbarmsg").style.display="";if(!flag){var w=this.getDom("upload_dialog");w.style.display="none";}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none";},mapUrl:function(url){return url?url.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):"";},triggerLayout:function(){var dom=this.getDom();if(dom.style.zoom=="1"){dom.style.zoom="100%";}else{dom.style.zoom="1";}}};utils.inherits(EditorUI,baidu.editor.ui.UIBase);var instances={};UE.ui.Editor=function(options){var editor=new baidu.editor.Editor(options);editor.options.editor=editor;utils.loadFile(document,{href:editor.options.themePath+editor.options.theme+"/css/ueditor.css",tag:"link",type:"text/css",rel:"stylesheet"});var oldRender=editor.render;editor.render=function(holder){if(holder.constructor===String){editor.key=holder;instances[holder]=editor;}utils.domReady(function(){editor.langIsReady?renderUI():editor.addListener("langReady",renderUI);function renderUI(){editor.setOpt({labelMap:editor.options.labelMap||editor.getLang("labelMap")});new EditorUI(editor.options);if(holder){if(holder.constructor===String){holder=document.getElementById(holder);}holder&&holder.getAttribute("name")&&(editor.options.textarea=holder.getAttribute("name"));if(holder&&/script|textarea/ig.test(holder.tagName)){var newDiv=document.createElement("div");holder.parentNode.insertBefore(newDiv,holder);var cont=holder.value||holder.innerHTML;editor.options.initialContent=/^[\t\r\n ]*$/.test(cont)?editor.options.initialContent:cont.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><");holder.className&&(newDiv.className=holder.className);holder.style.cssText&&(newDiv.style.cssText=holder.style.cssText);if(/textarea/i.test(holder.tagName)){editor.textarea=holder;editor.textarea.style.display="none";}else{holder.parentNode.removeChild(holder);holder.id&&(newDiv.id=holder.id);}holder=newDiv;holder.innerHTML="";}}domUtils.addClass(holder,"edui-"+editor.options.theme);editor.ui.render(holder);var opt=editor.options;editor.container=editor.ui.getDom();if(opt.initialFrameWidth){opt.minFrameWidth=opt.initialFrameWidth;}else{opt.minFrameWidth=opt.initialFrameWidth=holder.offsetWidth;}if(opt.initialFrameHeight){opt.minFrameHeight=opt.initialFrameHeight;}else{opt.initialFrameHeight=opt.minFrameHeight=holder.offsetHeight;}if(holder.style.height){holder.style.height="";}editor.container.style.width=opt.initialFrameWidth+"px";editor.container.style.zIndex=opt.zIndex;oldRender.call(editor,editor.ui.getDom("iframeholder"));editor.fireEvent("afteruirender");}});};return editor;};UE.getEditor=function(id,opt){var editor=instances[id];if(!editor){editor=instances[id]=new UE.ui.Editor(opt);editor.render(id);}return editor;};UE.delEditor=function(id){var editor;if(editor=instances[id]){editor.key&&editor.destroy();delete instances[id];}};})();})();